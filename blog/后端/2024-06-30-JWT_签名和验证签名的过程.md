# JWT 签名和验证签名的过程



 **Link:** [https://zhuanlan.zhihu.com/p/706239003]

## 生成（签名）JWT  

**确定Header**：Header通常包含两部分信息：使用的算法（比如HS256表示HMAC SHA-256）和Token类型（通常是JWT）。

```
{
  "alg": "HS256",
  "typ": "JWT"
}
```

**构建Payload**：Payload包含claims，这些claims可以是注册的claims、公共的claims或私有的claims

```
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022
}
```

**签名**：使用Header中指定的算法和一个密钥对Header和Payload进行签名。签名的目的是验证Token在传输过程中未被篡改。

例如，如果使用HMAC SHA-256，签名过程将是

```
  HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```

**组合JWT**：将编码后的Header、Payload和签名组合成一个JWT。格式通常为`header.payload.signature`。

## JWT验证过程  

**分解JWT**：首先，从JWT字符串中分离出Base64编码的Header、Payload和Signature。JWT通常形如`header.payload.signature`。

**Base64解码**：将编码的Header和Payload解码回它们原始的JSON格式的字符串。

**重新生成签名**：使用相同的算法（Header中指定的，如HMAC SHA-256）和`secret`对解码后的Header和Payload重新生成签名。具体步骤如下：

1. 将解码后的Header和Payload重新转换成Base64编码的字符串。
2. 将这两个Base64字符串用点`.`连接起来形成一个新的字符串。
3. 使用`secret`作为密钥，对这个字符串进行HMAC SHA-256运算，生成新的签名。

**比较签名**：将重新生成的签名与JWT中原来包含的签名进行比较。如果两者相同，则认为JWT是有效的，没有被篡改，且是由掌握`secret`的实体发行的。

## Secret的作用  

在这个验证过程中，`secret`起到的是保证签名真实性和数据未被篡改的关键角色：

1. **签名的安全性**：只有知道`secret`的实体才能正确生成和验证签名。这意味着即使有人截获了JWT，但没有`secret`，他们也无法生成新的有效签名，从而无法伪造有效的JWT。
2. **数据的完整性**：通过比较重新生成的签名和JWT中的签名，可以确认数据在传输过程中未被修改。因为任何对Header或Payload的改动都会导致新生成的签名与原签名不匹配。

**检查Claims**：验证签名之后，还需要检查Payload中的claims，如`exp`（过期时间）来确定Token的有效性。

### 注意  

虽然JWT的Header和Payload是使用Base64编码的，这种编码是可逆的，因此任何人都可以看到内容。如果需要保密Payload中的数据，应考虑对Payload进行加密，这种情况下通常使用JWE（JSON Web Encryption）。

