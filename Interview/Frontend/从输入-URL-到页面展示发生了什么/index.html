<!doctype html><html lang=zh-CN dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Interview/Frontend/从输入-URL-到页面展示发生了什么" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>在浏览器里，从输入 URL 到页面展示，这中间发生了什么？ | Sumingcheng's Document Center</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://sumingcheng.github.io/docs-hub/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://sumingcheng.github.io/docs-hub/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://sumingcheng.github.io/docs-hub/Interview/Frontend/从输入-URL-到页面展示发生了什么><meta data-rh=true property=og:locale content=zh_CN><meta data-rh=true name=docusaurus_locale content=zh-CN><meta data-rh=true name=docsearch:language content=zh-CN><meta data-rh=true name=keywords content=素明诚,sumingcheng,技术文档,博客,前端开发,后端开发,Web开发,JavaScript,TypeScript,Vue,React,Go,Python,Java><meta data-rh=true name=author content="素明诚 (sumingcheng)"><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="在浏览器里，从输入 URL 到页面展示，这中间发生了什么？ | Sumingcheng's Document Center"><meta data-rh=true name=description content='"在浏览器里，从输入 URL 到页面展示，这中间发生了什么？" 这是一道经典的面试题，能够全面考察应聘者对网络、操作系统、Web 等一系列知识的掌握程度。今天，我将结合下图对这个过程进行分析。当然，实际过程比图示更加复杂。'><meta data-rh=true property=og:description content='"在浏览器里，从输入 URL 到页面展示，这中间发生了什么？" 这是一道经典的面试题，能够全面考察应聘者对网络、操作系统、Web 等一系列知识的掌握程度。今天，我将结合下图对这个过程进行分析。当然，实际过程比图示更加复杂。'><link data-rh=true rel=icon href=/docs-hub/img/favicon.ico><link data-rh=true rel=canonical href=https://sumingcheng.github.io/docs-hub/Interview/Frontend/从输入-URL-到页面展示发生了什么><link data-rh=true rel=alternate href=https://sumingcheng.github.io/docs-hub/Interview/Frontend/从输入-URL-到页面展示发生了什么 hreflang=zh-CN><link data-rh=true rel=alternate href=https://sumingcheng.github.io/docs-hub/Interview/Frontend/从输入-URL-到页面展示发生了什么 hreflang=x-default><link data-rh=true rel=preconnect href=https://P783BA7DL3-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/docs-hub/blog/rss.xml title="Sumingcheng's Document Center RSS Feed"><link rel=alternate type=application/atom+xml href=/docs-hub/blog/atom.xml title="Sumingcheng's Document Center Atom Feed"><link rel=search type=application/opensearchdescription+xml title="Sumingcheng's Document Center" href=/docs-hub/opensearch.xml><script src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js async crossorigin></script><link rel=stylesheet href=/docs-hub/assets/css/styles.e198aa72.css><script src=/docs-hub/assets/js/main.2c293031.js defer></script><script src=/docs-hub/assets/js/runtime~main.36249b4f.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/docs-hub/><div class=navbar__logo><img src=/docs-hub/img/smc.jpg alt="Sumingcheng Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/docs-hub/img/smc.jpg alt="Sumingcheng Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Sumingcheng</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Backend</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/category/基础>Go</a><li><a class=dropdown__link href=/docs-hub/category/基础-1>Python</a><li><a class=dropdown__link href=/docs-hub/category/基础-2>Java</a><li><a class=dropdown__link href=/docs-hub/Backend/Docker/Docker-基础命令>Docker</a><li><a class=dropdown__link href=/docs-hub/Backend/MySQL/常用SQL语句>MySQL</a><li><a class=dropdown__link href=/docs-hub/Backend/Redis/Redis-基础使用>Redis</a><li><a class=dropdown__link href=/docs-hub/Backend/Nginx/Nginx基础入门>Nginx</a><li><a class=dropdown__link href=/docs-hub/Backend/ElasticSearch/ElasticSearch-安装使用>ElasticSearch</a><li><a class=dropdown__link href=/docs-hub/Backend/MQ/Go-Kafka安装使用指南>MQ</a><li><a class=dropdown__link href=/docs-hub/Backend/MongoDB/MongoDB安装与使用>MongoDB</a><li><a class=dropdown__link href=/docs-hub/Backend/Git/Git-提交规范>Git</a><li><a class=dropdown__link href=/docs-hub/Backend/Regular/正则表达式基础>Regular</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Frontend</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/category/es3-es5>JavaScript</a><li><a class=dropdown__link href=/docs-hub/Frontend/TypeScript/TypeScript简介>TypeScript</a><li><a class=dropdown__link href=/docs-hub/Frontend/Node/NodeJS基本认知>Node</a><li><a class=dropdown__link href=/docs-hub/category/vue基础入门>Vue</a><li><a class=dropdown__link href=/docs-hub/Frontend/React/初识React>React</a><li><a class=dropdown__link href=/docs-hub/Frontend/Engineering/核心-Web-指标>Engineering</a><li><a class=dropdown__link href=/docs-hub/Frontend/HTML/DOCTYPE>HTML</a><li><a class=dropdown__link href=/docs-hub/Frontend/CSS/CSS-选择器-权重-匹配规则>CSS</a><li><a class=dropdown__link href=/docs-hub/Frontend/DOM/DOM初识-JS对象-XML-幻灯片案例展示>DOM</a><li><a class=dropdown__link href=/docs-hub/Frontend/BOM/深入理解BOM>BOM</a><li><a class=dropdown__link href=/docs-hub/Frontend/Electron/初识-基础>Electron</a><li><a class=dropdown__link href=/docs-hub/Frontend/Quasar/Quasar项目搭建>Quasar</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Interview</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/Interview/Backend/占位>Backend</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs-hub/Interview/Frontend/浏览器是如何渲染��页面的>Frontend</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Network</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/Network/AJAX/JSON基础与数据解析-JSON方法-AJAX初识>AJAX</a><li><a class=dropdown__link href=/docs-hub/Network/HTTP/URL-客户端-服务端-域名操作>HTTP</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Web3</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/Web3/IPFS/IPFS-Desktop-运行指南>IPFS</a><li><a class=dropdown__link href=/docs-hub/Web3/Learning/Web2如何转Web3>Learning</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Resource</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/Resource/Soft/Windows装机软件>Soft</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link>Other</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs-hub/Other/CookBook/柠檬酸辣无骨鸡爪>CookBook</a><li><a class=dropdown__link href=/docs-hub/Other/Notes/使用指南>Notes</a></ul></div><a class="navbar__item navbar__link" href=/docs-hub/blog>Blog</a><a href=https://github.com/sumingcheng target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub 仓库"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title=切换浅色/暗黑模式（当前为浅色模式） aria-label=切换浅色/暗�黑模式（当前为浅色模式） aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>搜索</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/浏览器是如何渲染页面的>浏览器是如何渲染页面的？</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current=page href=/docs-hub/Interview/Frontend/从输入-URL-到页面展示发生了什么>在浏览器里，从输入 URL 到页面展示，这中间发生了什么？</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/CSS-属性计算过程>CSS 属性计算过程</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/await-async>Async/Await</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/节流-防抖>防抖与节流详解</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/柯里化-高阶函数>柯里化与高阶函数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/递归中的-Memorize>递归中的记忆化应用</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/手写-Promise-周边方法>Promise 深入解析与手写实现</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/实现-EventHub>实现 EventHub 的面试要点与实践</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/实现字符串大数相加>大数相加</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/手写集合方法>手写实现常见的 JavaScript 函数和概念</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-hub/Interview/Frontend/完美的深拷贝应该怎么写>深度拷贝技术点</a></ul></nav><button type=button title=收起侧边栏 aria-label=收起侧边栏 class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/docs-hub/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>在浏览器里，从输入 URL 到页面展示，这中间发生了什么？</span><meta itemprop=position content=1></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>在浏览器里，从输入 URL 到页面展示，这中间发生了什么？</h1></header>
<p>"在浏览器里，从输入 URL 到页面展示，这中间发生了什么？" 这是一道经典的面试题，能够全面考察应聘者对网络、操作系统、Web 等一系列知识的掌握程度。今天，我将结合下图对这个过程进行分析。当然，实际过程比图示更加复杂。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=一用户输入>一、用户输入<a href=#一用户输入 class=hash-link aria-label=一、用户输入的直接链接 title=一、用户输入的直接链接>​</a></h2>
<p>用户在地址栏输入查询关键字后，浏览器会判断输入的是搜索内容还是请求的 URL。</p>
<p>如果是搜索内容，地址栏会使用浏览器默认的搜索引擎，合成带关键字的 URL。如果输入内容符合 URL 规则，浏览器会根据规则加上协议，合成完整的 URL。</p>
<p>用户输入关键字并按下回车后，当前页面将被替换为新页面。在此之前，浏览器会触发当前页面的 <code>beforeunload</code> 事件，允许页面执行数据清理操作或询问用户是否离开页面，例如处理未提交的表单等。如果当前页面未监听 <code>beforeunload</code> 事件或用户同意继续，浏览器进入加载状态。</p>
<p>简而言之，浏览器处理完 URL 后，会将 URL 请求发送给网络进程。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=二网络请求>二、网络请求<a href=#二网络请求 class=hash-link aria-label=二、网络请求的直接链接 title=二、网络请求的直接链接>​</a></h2>
<p>接下来进入页面资源请求过程。浏览器进程通过进程间通信（IPC）将 URL 请求发送至网络进程，网络进程接收到请求后，开始真正的 URL 请求流程。</p>
<p>首先，网络进程会检查本地缓存是否有资源。如果存在缓存资源：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-浏览器缓存>1. 浏览器缓存<a href=#1-浏览器缓存 class=hash-link aria-label="1. 浏览器缓存的直接链接" title="1. 浏览器缓存的直接链接">​</a></h3>
<p>涉及强缓存和协商缓存两个概念。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=服务端缓存控制>服务端缓存控制<a href=#服务端缓存控制 class=hash-link aria-label=服务端缓存控制的直接链接 title=服务端缓存控制的直接链接>​</a></h4>
<p>强缓存与服务端缓存控制相关，启用强缓存的情况包括：</p>
<p>存在 <code>Cache-Control</code> 属性，设置 <code>max-age</code> 并且不存在 <code>no-cache</code> 和 <code>no-store</code>；
不存在 <code>Cache-Control</code>，存在 <code>Expires</code> 字段。</p>
<p>服务端缓存控制状态：</p>
<ul>
<li><code>no-store</code>：不允许缓存，适用于变化频繁的数据，如秒杀页面。</li>
<li><code>no-cache</code>：允许缓存，但使用前必须向服务器验证是否过期或有新版本。</li>
<li><code>must-revalidate</code>：缓存未过期时可使用，过期后需向服务器验证。</li>
</ul>
<p>与缓存代理相关的属性：</p>
<ul>
<li><code>private</code>：缓存仅限客户端，不能通过代理服务器缓存。</li>
<li><code>public</code>：缓存完全开放，代理服务器可缓存和使用。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=客户端缓存控制>客户端缓存控制<a href=#客户端缓存控制 class=hash-link aria-label=客户端缓存控制的直接链接 title=客户端缓存控制的直接链接>​</a></h4>
<p>进入协商缓存前，需要经过 DNS 解析、建立 TCP/IP 连接，以及如果是 HTTPS 协议，还需建立 TLS 连接。</p>
<p>协商缓存由客户端发起（条件请求），如果未命中强缓存，则进入协商缓存阶段。条件请求常用的头字段有 <code>If-Modified-Since</code> 和 <code>If-None-Match</code>。这些字段需要第一次响应提供 <code>Last-Modified</code> 和 <code>ETag</code>，以验证资源是否最新。</p>
<p>如果资源未变化，服务器回应 <code>304 Not Modified</code>，表示缓存有效。</p>
<p>请求过程中可能遇到服务器返回状态码 <code>301</code> 或 <code>302</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=重定向>重定向<a href=#重定向 class=hash-link aria-label=重定向的直接链接 title=重定向的直接链接>​</a></h4>
<p>重定向由服务器发起，浏览器接收到 <code>301</code> 或 <code>302</code> 状态码后，会跳转到新的 URI。重定向需配合 <code>Location</code> 字段使用。</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Connection: keep-alive</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Content-Length: 151</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Content-Type: text/html</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Date: Sun, 21 Feb 2021 00:48:52 GMT</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Location: /index.html</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Referer: /18-1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Server: openresty/1.19.3.1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>Location</code> 字段指定新的 URI，浏览器根据此字段发起新的 HTTP 或 HTTPS 请求。URI 可为绝对或相对路径，站内跳转可用相对 URI，站外需用绝对 URI。重定向报文还可使用 <code>Refresh</code> 字段实现延时重定向。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-dns-解析>2. DNS 解析<a href=#2-dns-解析 class=hash-link aria-label="2. DNS 解析的直接链接" title="2. DNS 解析的直接链接">​</a></h3>
<p>若本地缓存不存在资源，需判断是否需要 DNS 解析。若 URI 是域名，则进行 DNS 解析获取服务器 IP 地址。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=dns-系统>DNS 系统<a href=#dns-系统 class=hash-link aria-label="DNS 系统的直接链接" title="DNS 系统的直接链接">​</a></h4>
<p>DNS 系统为三层树状分布式服务，对应域名结构：</p>
<ul>
<li>根域名服务器（Root DNS Server）：管理顶级域名服务器，返回顶级域名服务器的 IP 地址。</li>
<li>顶级域名服务器（Top-level DNS Server）：管理特定域名下的权威域名服务器，返回域名服务器的 IP 地址。</li>
<li>权威域名服务器（Authoritative DNS Server）：管理域名下主机的 IP 地址。</li>
</ul>
<p>通过树形结构查询域名，从右到左顺序查找，最终获得 IP 地址。核心系统外，DNS 解析还依赖两种缓存手段：</p>
<p>非权威域名服务器：大公司或网络运营商建立的 DNS 服务器，代替用户访问核心 DNS 系统。
操作系统缓存：操作系统缓存 DNS 解析结果，并查找主机映射文件（如 Linux 的 <code>/etc/hosts</code>，Windows 的 <code>C:\WINDOWS\system32\drivers\etc\hosts</code>）。
浏览器也有自己的 DNS 缓存，缓存策略依赖浏览器。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=dns-解析流程>DNS 解析流程<a href=#dns-解析流程 class=hash-link aria-label="DNS 解析流程的直接链接" title="DNS 解析流程的直接链接">​</a></h4>
<p>DNS 查询流程为：</p>
<p>浏览器缓存 → 操作系统缓存 → 本地 hosts 文件 → 非权威域名服务器 → 根域名服务器 → 顶级域名服务器 → 权威域名服务器。</p>
<p>在 Windows 10 中，启动时会缓存 hosts 文件条目，并动态更新操作系统缓存。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-建立-tcpip-连接>3. 建立 TCP/IP 连接<a href=#3-建立-tcpip-连接 class=hash-link aria-label="3. 建立 TCP/IP 连接的直接链接" title="3. 建立 TCP/IP 连接的直接链接">​</a></h3>
<p>获取服务器 IP 后，建立 TCP/IP 连接。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=网络分层模型>网络分层模型<a href=#网络分层模型 class=hash-link aria-label=网络分层模型的直接链接 title=网络分层模型的直接链接>​</a></h4>
<p>TCP/IP 协议分为四层：</p>
<p>链接层（Link Layer）：在以太网、WiFi 等底层数据上发送原始数据包，使用 MAC 地址标记设备。
网际层（Internet Layer）：IP 协议所在层。
传输层（Transport Layer）：保证数据在两点间可靠传输，TCP 和 UDP 协议位于此层。
应用层（Application Layer）：面向具体应用的协议，如 HTTP。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=三次握手>三次握手<a href=#三次握手 class=hash-link aria-label=三次握手的直接链接 title=三次握手的直接链接>​</a></h4>
<p>了解以下概念：</p>
<ul>
<li>ACK：确认字符。</li>
<li>SYN：同步序列编号。</li>
</ul>
<p>主要状态：</p>
<ul>
<li>LISTEN：监听 TCP 端口的连接请求。</li>
<li>SYN-SENT：发送连接请求后等待确认。</li>
<li>SYN-RECEIVED：收到连接请求后等待确认。</li>
<li>ESTABLISHED：连接已建立，可发送数据。</li>
</ul>
<p>三次握手流程：</p>
<ol>
<li>客户端发送 SYN 标志位（序号 J），进入 SYN-SENT 状态。</li>
<li>服务器收到 SYN J，发送 ACK（序号 J+1）和 SYN（序号 K），进入 SYN-RECEIVED 状态。</li>
<li>客户端发送 ACK（序号 K+1），服务器收到后进入 ESTABLISHED 状态，连接建立。</li>
</ol>
<p>序号 J 和 K 是初始序列号（ISN）。SYN 报文不携带数据，占用一个序号。客户端随机选择 ISN。</p>
<p>ACK 确认 SYN 段已接收，指定下次发送段的序号。建立连接后，浏览器立即发送请求报文。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-建立-tls-连接>4. 建立 TLS 连接<a href=#4-建立-tls-连接 class=hash-link aria-label="4. 建立 TLS 连接的直接链接" title="4. 建立 TLS 连接的直接链接">​</a></h3>
<p>建立 TCP/IP 连接后，如果协议是 HTTPS，还需建立 TLS 连接。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=https>HTTPS<a href=#https class=hash-link aria-label=HTTPS的直接链接 title=HTTPS的直接链接>​</a></h4>
<p>HTTP 不安全，HTTPS 增加了机密性、完整性、身份认证和不可否认性。它将 HTTP 的传输协议由 TCP/IP 换为 SSL/TLS，即 "HTTP over SSL/TLS"。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=ssltls>SSL/TLS<a href=#ssltls class=hash-link aria-label=SSL/TLS的直接链接 title=SSL/TLS的直接链接>​</a></h4>
<p>SSL（Secure Sockets Layer）由网景公司于 1994 年发明，发展到 v3 时被 IETF 改名为 TLS（Transport Layer Security），标准化为 TLS1.0。</p>
<p>当前主流是 TLS1.2，包含记录协议、握手协议、警告协议、变更密码规范协议、扩展协议等，综合使用对称加密、非对称加密、身份认证等技术。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=对称加密非对称加密>对称加密、非对称加密<a href=#对称加密非对称加密 class=hash-link aria-label=对称加密、非对称加密的直接链接 title=对称加密、非对称加密的直接链接>​</a></h4>
<p>对称加密使用相同密钥加密和解密，如 AES 和 ChaCha20。AES 是 DES 的替代，ChaCha20 性能优于 AES。</p>
<p>非对称加密使用公钥和私钥，如 RSA 和 ECC。公钥可公开，私钥需保密。公钥加密只能用私钥解密，解决密钥交换问题。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=混合加密>混合加密<a href=#混合加密 class=hash-link aria-label=混合加密的直接链接 title=混合加密的直接链接>​</a></h4>
<p>混合加密结合对称加密和非对称加密。初始通信使用非对称加密解决密钥交换，随后使用对称加密进行高效通信。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=数字签名与证书>数字签名与证书<a href=#数字签名与证书 class=hash-link aria-label=数字签名与证书的直接链接 title=数字签名与证书的直接链接>​</a></h4>
<p>摘要算法（如 SHA-2）保证数据完整性。数字签名结合私钥和摘要算法，实现身份认证和不可否认性。</p>
<p>数字证书由 CA 颁发，包含公钥和身份信息，构建信任链。浏览器和操作系统内置根证书，通过验证证书链确认公钥可信。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=ecdhe-握手过程>ECDHE 握手过程<a href=#ecdhe-握手过程 class=hash-link aria-label="ECDHE 握手过程的直接链接" title="ECDHE 握手过程的直接链接">​</a></h4>
<p>TLS 握手过程使用混合加密、摘要算法、数字签名和数字证书。ECDHE 握手流程如下：</p>
<ol>
<li>客户端发送 "Client Hello" 消息，包含版本号、支持的密码套件和随机数。</li>
<li>服务器回复 "Server Hello"，选择密码套件，发送证书和 "Server Key Exchange" 消息，包含椭圆曲线公钥和签名，最后发送 "Server Hello Done"。</li>
<li>客户端验证证书，发送 "Client Key Exchange" 消息，包含客户端公钥参数。</li>
<li>双方使用 ECDHE 算法生成 "Pre-Master Secret"，结合随机数通过 PRF 生成 "Master Secret"。</li>
<li>客户端发送 "Change Cipher Spec" 和 "Finished" 消息，服务器验证后也发送相同消息。</li>
<li>握手结束，开始加密通信。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=三处理响应数据>三、处理响应数据<a href=#三处理响应数据 class=hash-link aria-label=三、处理响应数据的直接链接 title=三、处理响应数据的直接链接>​</a></h2>
<p>HTTP 请求的数据类型通过 <code>Content-Type</code> 头字段区分。<code>Content-Type</code> 指示响应体的数据类型，浏览器根据其值决定如何处理。</p>
<p>如果 <code>Content-Type</code> 被判断为下载类型，浏览器会交由下载管理器处理，导航流程结束。如果是 HTML，浏览器继续导航流程，准备渲染进程。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=四准备渲染进程>四、准备渲染进程<a href=#四准备渲染进程 class=hash-link aria-label=四、准备渲染进程的直接链接 title=四、准备渲染进程的直接链接>​</a></h2>
<p>默认情况下，Chrome 为每个页面分配一个渲染进程。若多个页面属于同一站点，则复用渲染进程。</p>
<p>同一站点定义为相同根域名（如 geekbang.org）、协议（https:// 或 http://）、子域名和端口。例如：</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">https://time.geekbang.org</span><br></span><span class=token-line style=color:#393A34><span class="token plain">https://www.geekbang.org</span><br></span><span class=token-line style=color:#393A34><span class="token plain">https://www.geekbang.org:8080</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Chrome 的策略：</p>
<ul>
<li>通常为每个新页面创建独立渲染进程。</li>
<li>若新页面与父页面同属一站点，复用父页面的渲染进程。</li>
</ul>
<p>渲染进程准备好后，浏览器进程将网络进程接收到的 HTML 数据提交给渲染进程，进入提交文档阶段。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=五提交文档>五、提交文档<a href=#五提交文档 class=hash-link aria-label=五、提交文档的直接链接 title=五、提交文档的直接链接>​</a></h2>
<p>提交文档指浏览器进程将网络进程的 HTML 数据提交给渲染进程，流程如下：</p>
<ol>
<li>浏览器进程接收到响应头后，向渲染进程发送“提交文档”消息。</li>
<li>渲染进程与网络进程建立数据传输管道。</li>
<li>文档数据传输完成后，渲染进程返回“确认提交”消息。</li>
<li>浏览器进程收到确认消息，更新界面状态，包括安全状态、地址栏 URL、历史记录等。</li>
</ol>
<p>完成导航流程后，进入渲染阶段。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=六渲染阶段>六、渲染阶段<a href=#六渲染阶段 class=hash-link aria-label=六、渲染阶段的直接链接 title=六、渲染阶段的直接链接>​</a></h2>
<p>渲染模块执行多个子阶段，将 HTML 转换为像素，形成渲染流水线。主要子阶段包括构建 DOM 树、样式计算、布局、分层、绘制、分块、光栅化和合成。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-构建-dom-树>1. 构建 DOM 树<a href=#1-构建-dom-树 class=hash-link aria-label="1. 构建 DOM 树的直接链接" title="1. 构建 DOM 树的直接链接">​</a></h3>
<p>浏览器将 HTML 转换为 DOM 树，表示页面的结构。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-样式计算>2. 样式计算<a href=#2-样式计算 class=hash-link aria-label="2. 样式计算的直接链接" title="2. 样式计算的直接链接">​</a></h3>
<p>计算 DOM 树中每个元素的具体样式，分为以下步骤：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=转换-css-为浏览器理解的结构>转换 CSS 为浏览器理解的结构<a href=#转换-css-为浏览器理解的结构 class=hash-link aria-label="转换 CSS 为浏览器理解的结构的直接链接" title="转换 CSS 为浏览器理解的结构的直接链接">​</a></h4>
<p>CSS 样式来源：</p>
<ul>
<li>通过 <code>link</code> 引用的外部 CSS 文件。</li>
<li>元素的 <code>style</code> 属性内嵌的 CSS。</li>
</ul>
<p>浏览器将 CSS 文本转换为 <code>styleSheets</code> 结构，可在 Chrome 控制台中查看 <code>document.styleSheets</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=标准化样式属性值>标准化样式属性值<a href=#标准化样式属性值 class=hash-link aria-label=标准化样式属性值的直接链接 title=标准化样式属性值的直接链接>​</a></h4>
<p>将 CSS 属性值转换为渲染引擎理解的标准化值，如将 <code>2em</code>、<code>blue</code>、<code>bold</code> 转换为具体数值。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=计算具体样式>计算具体样式<a href=#计算具体样式 class=hash-link aria-label=计算具体样式的直接链接 title=计算具体样式的直接链接>​</a></h4>
<p>根据 CSS 继承和层叠规则，计算 DOM 树中每个节点的最终样式。例如：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-css codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token selector" style=color:#00009f>body</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>font-size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 20px</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token selector" style=color:#00009f>p</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>color</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> blue</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token selector" style=color:#00009f>span</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>display</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> none</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token selector" style=color:#00009f>div</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>font-weight</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> bold</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>color</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> red</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token selector" style=color:#00009f>div p</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>color</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> green</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>对应的 DOM 树样式：</p>
<p>子节点继承父节点样式，如 <code>body</code> 的 <code>font-size</code> 为 <code>20px</code>，其下所有节点的 <code>font-size</code> 亦为 <code>20px</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-布局阶段>3. 布局阶段<a href=#3-布局阶段 class=hash-link aria-label="3. 布局阶段的直接链接" title="3. 布局阶段的直接链接">​</a></h3>
<p>计算 DOM 树中可见元素的几何位置，包含创建布局树和布局计算。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=创建布局树>创建布局树<a href=#创建布局树 class=hash-link aria-label=创建布局树的直接链接 title=创建布局树的直接链接>​</a></h4>
<p>从 DOM 树中筛选可见节点，构建布局树。</p>
<p>不可见节点（如 <code>head</code> 标签、<code>display: none</code> 元素）不包含在布局树中。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=布局计算>布局计算<a href=#布局计算 class=hash-link aria-label=布局计算的直接链接 title=布局计算的直接链接>​</a></h4>
<p>计算布局树节点的坐标位置，渲染引擎将布局运算结果写回布局树。Chrome 正在重构布局系统，以更清晰地分离输入和输出。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-分层>4. 分层<a href=#4-分层 class=hash-link aria-label="4. 分层的直接链接" title="4. 分层的直接链接">​</a></h3>
<p>为特定节点生成图层，形成图层树（LayerTree）。</p>
<p>图层叠加形成最终页面图像：</p>
<p>布局树节点可能不对应独立图层，最终每个节点从属于某一图层。</p>
<p>创建图层的条件：</p>
<p>拥有层叠上下文属性的元素，如定位属性、透明属性、CSS 滤镜等。</p>
<p>需要剪裁的元素也会创建新图层。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=七绘制和光栅化>七、绘制和光栅化<a href=#七绘制和光栅化 class=hash-link aria-label=七、绘制和光栅化的直接链接 title=七、绘制和光栅化的直接链接>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-绘制>1. 绘制<a href=#1-绘制 class=hash-link aria-label="1. 绘制的直接链接" title="1. 绘制的直接链接">​</a></h3>
<p>绘制阶段会把一个图层的绘制拆分成很多小的绘制指令，然后再把这些指令按照顺序组成一个待绘制列表。</p>
<p>例如，一个图层包含文字和阴影，那么绘制过程会被拆分为：</p>
<ol>
<li>绘制阴影</li>
<li>绘制文字</li>
<li>绘制边框</li>
</ol>
<p>这些指令都会被记录在绘制列表中。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-光栅化>2. 光栅化<a href=#2-光栅化 class=hash-link aria-label="2. 光栅化的直接链接" title="2. 光栅化的直接链接">​</a></h3>
<p>光栅化是将绘制指令转换为屏幕上的像素点的过程。</p>
<p>由于一个页面通常很大，但用户只能看到其中的一部分，所以合成线程会将图层划分为图块（tile），然后优先光栅化视口附近的图块。</p>
<p>光栅化过程主要包括：</p>
<ol>
<li>图块划分：将图层分成多个小的图块</li>
<li>优先处理：优先处理视口附近的图块</li>
<li>GPU 加速：使用 GPU 进行光栅化，提高处理速度</li>
</ol>
<p><strong>最佳实践：</strong></p>
<ul>
<li>使用 <code>will-change</code> 属性提示浏览器哪些元素可能发生变化，让浏览器提前做好优化准备</li>
<li>合理使用图层，过多的图层会增加内存占用和合成时间</li>
<li>避免大面积重绘，可以通过分层来减少重绘范围</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=八合成>八、合成<a href=#八合成 class=hash-link aria-label=八、合成的直接链接 title=八、合成的直接链接>​</a></h2>
<p>合成是将光栅化后的图层合并成最终页面的过程。主要包含以下步骤：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-图层合成>1. 图层合成<a href=#1-图层合成 class=hash-link aria-label="1. 图层合成的直接链接" title="1. 图层合成的直接链接">​</a></h3>
<p>合成线程会按照图层的前后顺序，将所有图层叠加在一起。这个过程考虑:</p>
<ul>
<li>图层的层叠顺序(z-index)</li>
<li>透明度(opacity)</li>
<li>变形(transform)等属性</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-显示合成结果>2. 显示合成结果<a href=#2-显示合成结果 class=hash-link aria-label="2. 显示合成结果的直接链接" title="2. 显示合成结果的直接链接">​</a></h3>
<p>合成线程将最终的合成结果提交给 GPU 进程，由 GPU 进行最后的渲染，显示在屏幕上。</p>
<p>这个过程的特点是:</p>
<ul>
<li>在合成线程中进行，不会阻塞主线程</li>
<li>可以利用 GPU 硬件加速</li>
<li>不需要重新计算布局和绘制</li>
</ul>
<p><strong>最佳实践：</strong></p>
<ul>
<li>使用 CSS transform 进行动画，可以避免重排和重绘</li>
<li>合理使用 will-change 属性，提示浏览器提前创建独立图层</li>
<li>控制图层数量，避免过多图层导致内存占用过大</li>
<li>使用 requestAnimationFrame 来执行动画，保证动画流畅</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/sumingcheng/docs-hub/edit/main/docs/Interview/Frontend/30.从输入-URL-到页面展示发生了什么.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>最后<!-- -->由 <b>sumingcheng</b> <!-- -->于 <b><time datetime=2024-12-15T00:04:01.000Z itemprop=dateModified>2024年12月15日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/docs-hub/Interview/Frontend/浏览器是如何渲染页面的><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>浏览器是如何渲染页面的？</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs-hub/Interview/Frontend/CSS-属性计算过程><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>CSS 属性计算过程</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#一用户输入 class="table-of-contents__link toc-highlight">一、用户输入</a><li><a href=#二网络请求 class="table-of-contents__link toc-highlight">二、网络请求</a><ul><li><a href=#1-浏览器缓存 class="table-of-contents__link toc-highlight">1. 浏览器缓存</a><ul><li><a href=#服务端缓存控制 class="table-of-contents__link toc-highlight">服务端缓存控制</a><li><a href=#客户端缓存控制 class="table-of-contents__link toc-highlight">客户端缓存控制</a><li><a href=#重定向 class="table-of-contents__link toc-highlight">重定向</a></ul><li><a href=#2-dns-解析 class="table-of-contents__link toc-highlight">2. DNS 解析</a><ul><li><a href=#dns-系统 class="table-of-contents__link toc-highlight">DNS 系统</a><li><a href=#dns-解析流程 class="table-of-contents__link toc-highlight">DNS 解析流程</a></ul><li><a href=#3-建立-tcpip-连接 class="table-of-contents__link toc-highlight">3. 建立 TCP/IP 连接</a><ul><li><a href=#网络分层模型 class="table-of-contents__link toc-highlight">网络分层模型</a><li><a href=#三次握手 class="table-of-contents__link toc-highlight">三次握手</a></ul><li><a href=#4-建立-tls-连接 class="table-of-contents__link toc-highlight">4. 建立 TLS 连接</a><ul><li><a href=#https class="table-of-contents__link toc-highlight">HTTPS</a><li><a href=#ssltls class="table-of-contents__link toc-highlight">SSL/TLS</a><li><a href=#对称加密非对称加密 class="table-of-contents__link toc-highlight">对称加密、非对称加密</a><li><a href=#混合加密 class="table-of-contents__link toc-highlight">混合加密</a><li><a href=#数字签名与证书 class="table-of-contents__link toc-highlight">数字签名与证书</a><li><a href=#ecdhe-握手过程 class="table-of-contents__link toc-highlight">ECDHE 握手过程</a></ul></ul><li><a href=#三处理响应数据 class="table-of-contents__link toc-highlight">三、处理响应数据</a><li><a href=#四准备渲染进程 class="table-of-contents__link toc-highlight">四、准备渲染进程</a><li><a href=#五提交文档 class="table-of-contents__link toc-highlight">五、提交文档</a><li><a href=#六渲染阶段 class="table-of-contents__link toc-highlight">六、渲染阶段</a><ul><li><a href=#1-构建-dom-树 class="table-of-contents__link toc-highlight">1. 构建 DOM 树</a><li><a href=#2-样式计算 class="table-of-contents__link toc-highlight">2. 样式计算</a><ul><li><a href=#转换-css-为浏览器理解的结构 class="table-of-contents__link toc-highlight">转换 CSS 为浏览器理解的结构</a><li><a href=#标准化样式属性值 class="table-of-contents__link toc-highlight">标准化样式属性值</a><li><a href=#计算具体样式 class="table-of-contents__link toc-highlight">计算具体样式</a></ul><li><a href=#3-布局阶段 class="table-of-contents__link toc-highlight">3. 布局阶段</a><ul><li><a href=#创建布局树 class="table-of-contents__link toc-highlight">创建布局树</a><li><a href=#布局计算 class="table-of-contents__link toc-highlight">布局计算</a></ul><li><a href=#4-分层 class="table-of-contents__link toc-highlight">4. 分层</a></ul><li><a href=#七绘制和光栅化 class="table-of-contents__link toc-highlight">七、绘制和光栅化</a><ul><li><a href=#1-绘制 class="table-of-contents__link toc-highlight">1. 绘制</a><li><a href=#2-光栅化 class="table-of-contents__link toc-highlight">2. 光栅化</a></ul><li><a href=#八合成 class="table-of-contents__link toc-highlight">八、合成</a><ul><li><a href=#1-图层合成 class="table-of-contents__link toc-highlight">1. 图层合成</a><li><a href=#2-显示合成结果 class="table-of-contents__link toc-highlight">2. 显示合成结果</a></ul></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.yuque.com/sumingcheng target=_blank rel="noopener noreferrer" class=footer__link-item>语雀<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.zhihu.com/people/xiaolaodi.top target=_blank rel="noopener noreferrer" class=footer__link-item>知乎<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Acknowledgments</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://react.dev target=_blank rel="noopener noreferrer" class=footer__link-item>React<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://docusaurus.io target=_blank rel="noopener noreferrer" class=footer__link-item>Docusaurus<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://sumingcheng.cn target=_blank rel="noopener noreferrer" class=footer__link-item>Blog<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://github.com/sumingcheng target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2020-2024 Sumingcheng. All Rights Reserved.</div></div></div></footer></div>