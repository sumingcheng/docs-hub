"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["33870"],{24062:function(e,n,r){r.r(n),r.d(n,{default:()=>u,frontMatter:()=>c,metadata:()=>o,assets:()=>a,toc:()=>l,contentTitle:()=>i});var o=JSON.parse('{"id":"Backend/Go/Protobuf/grpc-\u6570\u7EC4\u548C-map","title":"\u4F7F\u7528 Protocol Buffers \u548C gRPC \u6784\u5EFA\u8BFE\u7A0B\u670D\u52A1","description":"\u5B9A\u4E49 .proto \u6587\u4EF6","source":"@site/docs/Backend/Go/Protobuf/40.grpc-\u6570\u7EC4\u548C-map.md","sourceDirName":"Backend/Go/Protobuf","slug":"/Backend/Go/Protobuf/grpc-\u6570\u7EC4\u548C-map","permalink":"/docs-hub/Backend/Go/Protobuf/grpc-\u6570\u7EC4\u548C-map","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/Go/Protobuf/40.grpc-\u6570\u7EC4\u548C-map.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1739167030000,"sidebarPosition":40,"frontMatter":{},"sidebar":"goSidebar","previous":{"title":"\u4F7F\u7528 Protocol Buffers \u5B9A\u4E49\u548C\u8BBF\u95EE\u5D4C\u5957\u6D88\u606F","permalink":"/docs-hub/Backend/Go/Protobuf/\u5D4C\u5957\u7684-message"},"next":{"title":"\u4F7F\u7528 Go \u5B9E\u73B0 gRPC \u670D\u52A1\u7AEF\u548C\u5BA2\u6237\u7AEF","permalink":"/docs-hub/Backend/Go/Protobuf/gRPC-\u5B9E\u73B0\u6D41\u7A0B"}}'),s=r("85893"),t=r("50065");let c={},i="\u4F7F\u7528 Protocol Buffers \u548C gRPC \u6784\u5EFA\u8BFE\u7A0B\u670D\u52A1",a={},l=[{value:"\u5B9A\u4E49 <code>.proto</code> \u6587\u4EF6",id:"\u5B9A\u4E49-proto-\u6587\u4EF6",level:2},{value:"\u7F16\u8BD1 <code>.proto</code> \u6587\u4EF6",id:"\u7F16\u8BD1-proto-\u6587\u4EF6",level:2},{value:"\u7F16\u5199\u6570\u636E\u6587\u4EF6",id:"\u7F16\u5199\u6570\u636E\u6587\u4EF6",level:2},{value:"\u5B9E\u73B0\u670D\u52A1\u7AEF",id:"\u5B9E\u73B0\u670D\u52A1\u7AEF",level:2},{value:"\u5B9E\u73B0\u5BA2\u6237\u7AEF",id:"\u5B9E\u73B0\u5BA2\u6237\u7AEF",level:2},{value:"\u9879\u76EE\u76EE\u5F55\u7ED3\u6784",id:"\u9879\u76EE\u76EE\u5F55\u7ED3\u6784",level:2},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:2},{value:"\u6700\u4F73\u5B9E\u8DF5",id:"\u6700\u4F73\u5B9E\u8DF5",level:2}];function d(e){let n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u4F7F\u7528-protocol-buffers-\u548C-grpc-\u6784\u5EFA\u8BFE\u7A0B\u670D\u52A1",children:"\u4F7F\u7528 Protocol Buffers \u548C gRPC \u6784\u5EFA\u8BFE\u7A0B\u670D\u52A1"})}),"\n",(0,s.jsxs)(n.h2,{id:"\u5B9A\u4E49-proto-\u6587\u4EF6",children:["\u5B9A\u4E49 ",(0,s.jsx)(n.code,{children:".proto"})," \u6587\u4EF6"]}),"\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\uFF0C\u6211\u7F16\u5199\u4E86\u4E00\u4E2A ",(0,s.jsx)(n.code,{children:"course.proto"})," \u6587\u4EF6\uFF0C\u5B9A\u4E49\u4E86\u8BFE\u7A0B\u4FE1\u606F\u7684\u6D88\u606F\u7C7B\u578B\u548C\u670D\u52A1\u63A5\u53E3\uFF1A"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-protobuf",children:'syntax = "proto3";\n\noption go_package = "./;proto";\n\nmessage CourseInfo {\n  int32 cid = 1;\n  string cname = 2;\n  string teacher = 3;\n}\n\nmessage CourseResponse {\n  int32 code = 1;\n  string msg = 2;\n  repeated CourseInfo data = 3;\n  map<string, string> extra = 4; // \u9644\u52A0\u4FE1\u606F\n}\n\nmessage CourseRequest {\n  string type = 1;\n}\n\nservice Course {\n  rpc GetCourseList (CourseRequest) returns (CourseResponse);\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"\u7F16\u8BD1-proto-\u6587\u4EF6",children:["\u7F16\u8BD1 ",(0,s.jsx)(n.code,{children:".proto"})," \u6587\u4EF6"]}),"\n",(0,s.jsx)(n.p,{children:"\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u7F16\u8BD1\u751F\u6210 Go \u4EE3\u7801\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"protoc -I . course.proto --go_out=. --go-grpc_out=.\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u7F16\u5199\u6570\u636E\u6587\u4EF6",children:"\u7F16\u5199\u6570\u636E\u6587\u4EF6"}),"\n",(0,s.jsxs)(n.p,{children:["\u521B\u5EFA\u4E00\u4E2A ",(0,s.jsx)(n.code,{children:"data.go"})," \u6587\u4EF6\uFF0C\u7528\u4E8E\u5B58\u50A8\u8BFE\u7A0B\u4FE1\u606F\uFF1A"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package data\n\nimport "your_project_path/proto"\n\nvar LanguageCourses = []*proto.CourseInfo{\n  {Cid: 1, Cname: "Go", Teacher: "\u5F20\u4E09"},\n  {Cid: 2, Cname: "Python", Teacher: "\u674E\u56DB"},\n  {Cid: 3, Cname: "Java", Teacher: "\u738B\u4E94"},\n}\n\nvar ComputerCourses = []*proto.CourseInfo{\n  {Cid: 4, Cname: "\u8BA1\u7B97\u673A\u57FA\u7840", Teacher: "\u8D75\u516D"},\n  {Cid: 5, Cname: "\u6570\u636E\u7ED3\u6784", Teacher: "\u5B59\u4E03"},\n  {Cid: 6, Cname: "\u7B97\u6CD5", Teacher: "\u5468\u516B"},\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u5B9E\u73B0\u670D\u52A1\u7AEF",children:"\u5B9E\u73B0\u670D\u52A1\u7AEF"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u670D\u52A1\u7AEF\u5B9E\u73B0 ",(0,s.jsx)(n.code,{children:"GetCourseList"})," \u65B9\u6CD5\uFF1A"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n  "context"\n  "your_project_path/data"\n  "your_project_path/proto"\n  "google.golang.org/grpc"\n  "net"\n)\n\ntype CourseService struct {\n  proto.UnimplementedCourseServer\n}\n\nfunc (s *CourseService) GetCourseList(ctx context.Context, req *proto.CourseRequest) (*proto.CourseResponse, error) {\n  switch req.Type {\n  case "language":\n    return &proto.CourseResponse{\n      Code: 0,\n      Msg:  "success",\n      Data: data.LanguageCourses,\n      Extra: map[string]string{\n        "note": "\u8BED\u8A00\u8BFE\u7A0B\u5217\u8868",\n      },\n    }, nil\n  case "computer":\n    return &proto.CourseResponse{\n      Code: 0,\n      Msg:  "success",\n      Data: data.ComputerCourses,\n    }, nil\n  default:\n    return &proto.CourseResponse{\n      Code: 1,\n      Msg:  "invalid course type",\n    }, nil\n  }\n}\n\nfunc main() {\n  server := grpc.NewServer()\n  proto.RegisterCourseServer(server, &CourseService{})\n  listener, err := net.Listen("tcp", ":8080")\n  if err != nil {\n    panic(err)\n  }\n  if err := server.Serve(listener); err != nil {\n    panic(err)\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u5B9E\u73B0\u5BA2\u6237\u7AEF",children:"\u5B9E\u73B0\u5BA2\u6237\u7AEF"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u5BA2\u6237\u7AEF\u8C03\u7528\u670D\u52A1\u7AEF\u7684 ",(0,s.jsx)(n.code,{children:"GetCourseList"})," \u65B9\u6CD5\uFF1A"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n  "context"\n  "encoding/json"\n  "fmt"\n  "your_project_path/proto"\n  "google.golang.org/grpc"\n  "google.golang.org/grpc/credentials/insecure"\n)\n\nfunc main() {\n  conn, err := grpc.Dial(":8080", grpc.WithTransportCredentials(insecure.NewCredentials()))\n  if err != nil {\n    panic(err)\n  }\n  defer conn.Close()\n\n  client := proto.NewCourseClient(conn)\n  response, err := client.GetCourseList(context.Background(), &proto.CourseRequest{\n    Type: "language",\n  })\n  if err != nil {\n    panic(err)\n  }\n\n  jsonData, err := json.Marshal(response)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Println(string(jsonData))\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u9879\u76EE\u76EE\u5F55\u7ED3\u6784",children:"\u9879\u76EE\u76EE\u5F55\u7ED3\u6784"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"\u9879\u76EE\u76EE\u5F55\u7ED3\u6784",src:r(64470).Z+"",width:"350",height:"339"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5305\u8DEF\u5F84\u66FF\u6362"}),"\uFF1A\u5728\u4EE3\u7801\u4E2D\uFF0C\u5C06 ",(0,s.jsx)(n.code,{children:"your_project_path"})," \u66FF\u6362\u4E3A\u5B9E\u9645\u7684\u9879\u76EE\u8DEF\u5F84\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9519\u8BEF\u5904\u7406"}),"\uFF1A\u5728\u5B9E\u9645\u5E94\u7528\u4E2D\uFF0C\u5E94\u5B8C\u5584\u9519\u8BEF\u5904\u7406\u903B\u8F91\uFF0C\u907F\u514D\u7A0B\u5E8F\u5D29\u6E83\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4F73\u5B9E\u8DF5",children:"\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u4EE3\u7801\u4F18\u5316"}),"\uFF1A\u4F7F\u7528\u6613\u8BFB\u7684\u53D8\u91CF\u540D\uFF0C\u5982\u5C06 ",(0,s.jsx)(n.code,{children:"Course"})," \u6539\u4E3A ",(0,s.jsx)(n.code,{children:"CourseService"}),"\uFF0C\u63D0\u9AD8\u4EE3\u7801\u53EF\u8BFB\u6027\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7248\u672C\u7BA1\u7406"}),"\uFF1A\u4F7F\u7528 Go Modules \u7BA1\u7406\u4F9D\u8D56\uFF0C\u786E\u4FDD\u5305\u7248\u672C\u7684\u7A33\u5B9A\u6027\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u534F\u8BAE\u7F16\u8BD1"}),"\uFF1A\u5EFA\u8BAE\u5C06\u7F16\u8BD1\u547D\u4EE4\u5199\u5165\u811A\u672C\u6216 Makefile\uFF0C\u65B9\u4FBF\u540E\u7EED\u7EF4\u62A4\u3002"]}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},64470:function(e,n,r){r.d(n,{Z:function(){return o}});let o=r.p+"assets/images/ce1aff9a2ec262a8d2bb632e3c478a81-0d5de889eb0470368a11f954f1819a54.png"},50065:function(e,n,r){r.d(n,{Z:function(){return i},a:function(){return c}});var o=r(67294);let s={},t=o.createContext(s);function c(e){let n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);