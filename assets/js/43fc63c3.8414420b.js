"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["23276"],{79381:function(n,e,t){t.r(e),t.d(e,{assets:function(){return c},contentTitle:function(){return a},default:function(){return p},frontMatter:function(){return i},metadata:function(){return o},toc:function(){return l}});var o=t(77278),s=t(85893),r=t(50065);let i={slug:"express-\u4E2D\u4F7F\u7528-winston-\u8BB0\u5F55\u65E5\u5FD7",title:"Express \u4E2D\u4F7F\u7528 Winston \u8BB0\u5F55\u65E5\u5FD7",authors:["sumingcheng"],tags:["backend"],date:new Date("2024-06-27T00:00:00.000Z")},a="Express \u4E2D\u4F7F\u7528 Winston \u8BB0\u5F55\u65E5\u5FD7",c={authorsImageUrls:[void 0]},l=[{value:"\u793A\u4F8B\uFF1A\u7F16\u5199\u4E00\u4E2A logger \u5B9E\u4F8B\u5BFC\u51FA\u4F7F\u7528",id:"\u793A\u4F8B\u7F16\u5199\u4E00\u4E2A-logger-\u5B9E\u4F8B\u5BFC\u51FA\u4F7F\u7528",level:2},{value:"\u7F16\u5199\u4E2D\u95F4\u4EF6",id:"\u7F16\u5199\u4E2D\u95F4\u4EF6",level:2},{value:"\u6CE8\u518C\u4E2D\u95F4\u4EF6",id:"\u6CE8\u518C\u4E2D\u95F4\u4EF6",level:2},{value:"\u6548\u679C",id:"\u6548\u679C",level:2}];function u(n){let e={a:"a",br:"br",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:["\u9996\u5148\uFF0C\u4F60\u9700\u8981\u5728\u4F60\u7684 Node.js \u9879\u76EE\u4E2D\u5B89\u88C5 Winston \u548C winston-daily-rotate-file\uFF08",(0,s.jsx)(e.strong,{children:"\u5B9E\u73B0\u65E5\u5FD7\u6EDA\u52A8"}),"\uFF09"]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"npm install winston\nnpm install winston-daily-rotate-file\n\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u793A\u4F8B\u7F16\u5199\u4E00\u4E2A-logger-\u5B9E\u4F8B\u5BFC\u51FA\u4F7F\u7528",children:"\u793A\u4F8B\uFF1A\u7F16\u5199\u4E00\u4E2A logger \u5B9E\u4F8B\u5BFC\u51FA\u4F7F\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"import winston from 'winston';\nimport DailyRotateFile from 'winston-daily-rotate-file';\nimport fs from 'fs';\nimport path from 'path';\n\nfunction ensureLogDirectory() {\n  const logDirectory = path.join(process.cwd(), 'logs');\n  if (!fs.existsSync(logDirectory)) {\n    fs.mkdirSync(logDirectory, {recursive: true});\n  }\n  return logDirectory;\n}\n\n// \u521B\u5EFA\u65E5\u5FD7\u6587\u4EF6\u4F20\u8F93\u914D\u7F6E\nfunction createFileTransport(logDirectory) {\n  return new DailyRotateFile({\n    filename: path.join(logDirectory, 'admin-%DATE%.log'),\n    datePattern: 'YYYY-MM-DD',\n    zippedArchive: true,\n    maxSize: '20m',\n    maxFiles: '14d',\n    format: winston.format.combine(\n      winston.format.colorize(),\n      winston.format.timestamp({format: 'YYYY-MM-DD HH:mm:ss'}),\n      winston.format.printf(info => `${info.timestamp} ${info.level}: ${info.message}`)\n    ),\n  });\n}\n\n// \u521B\u5EFA\u63A7\u5236\u53F0\u4F20\u8F93\u914D\u7F6E\nfunction createConsoleTransport() {\n  return new winston.transports.Console({\n    level: 'debug',\n    format: winston.format.combine(\n      winston.format.colorize(),\n      winston.format.simple()\n    )\n  });\n}\n\nconst logDirectory = ensureLogDirectory();\nconst transport = createFileTransport(logDirectory);\nconst consoleTransport = createConsoleTransport();\n\n// \u521D\u59CB\u5316\u5E76\u5BFC\u51FAlogger\nexport const logger = winston.createLogger({\n  transports: [\n    transport,\n    consoleTransport\n  ]\n});\n\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u7F16\u5199\u4E2D\u95F4\u4EF6",children:"\u7F16\u5199\u4E2D\u95F4\u4EF6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"export const logMiddleware = (req, res, next) => {\n  const start = Date.now();\n  res.on('finish', () => {\n    const duration = Date.now() - start;\n    const logLevel = res.statusCode >= 400 ? 'error' : 'info';\n    const message = `${req.method} ${req.url} - Status Code: ${res.statusCode} - ${duration}ms `;\n    logger[logLevel](message);\n  });\n  next();\n};\n\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6CE8\u518C\u4E2D\u95F4\u4EF6",children:"\u6CE8\u518C\u4E2D\u95F4\u4EF6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"const app = express();\napp.use(cors());\napp.use(express.json());\napp.use(express.static('dist'));\napp.use(logMiddleware); // \u8FD9\u91CC\n\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6548\u679C",children:"\u6548\u679C"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.img,{alt:"ca9b705e4e51a672c2938357f93fd824",src:t(54660).Z+"",width:"1128",height:"681"}),"## \u9879\u76EE\u5730\u5740",(0,s.jsx)(e.br,{}),"\n",(0,s.jsx)(e.a,{href:"https://github.com/winstonjs/winston",children:"https://github.com/winstonjs/winston"})]})]})}function p(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(u,{...n})}):u(n)}},54660:function(n,e,t){t.d(e,{Z:function(){return o}});let o=t.p+"assets/images/ca9b705e4e51a672c2938357f93fd824-d2a9c83c12b6fc9f9f04213774b6ce13.jpg"},50065:function(n,e,t){t.d(e,{Z:function(){return a},a:function(){return i}});var o=t(67294);let s={},r=o.createContext(s);function i(n){let e=o.useContext(r);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),o.createElement(r.Provider,{value:e},n.children)}},77278:function(n){n.exports=JSON.parse('{"permalink":"/docs-hub/blog/express-\u4E2D\u4F7F\u7528-winston-\u8BB0\u5F55\u65E5\u5FD7","editUrl":"https://github.com/sumingcheng/docs-hub/blog/\u540E\u7AEF/2024-06-27-Express_\u4E2D\u4F7F\u7528_Winston_\u8BB0\u5F55\u65E5\u5FD7.md","source":"@site/blog/\u540E\u7AEF/2024-06-27-Express_\u4E2D\u4F7F\u7528_Winston_\u8BB0\u5F55\u65E5\u5FD7.md","title":"Express \u4E2D\u4F7F\u7528 Winston \u8BB0\u5F55\u65E5\u5FD7","description":"\u9996\u5148\uFF0C\u4F60\u9700\u8981\u5728\u4F60\u7684 Node.js \u9879\u76EE\u4E2D\u5B89\u88C5 Winston \u548C winston-daily-rotate-file\uFF08\u5B9E\u73B0\u65E5\u5FD7\u6EDA\u52A8\uFF09","date":"2024-06-27T00:00:00.000Z","tags":[{"inline":false,"label":"\u540E\u7AEF","permalink":"/docs-hub/blog/tags/backend","description":"\u540E\u7AEF\u5F00\u53D1\u6280\u672F\u6587\u7AE0"}],"readingTime":0.8633333333333333,"hasTruncateMarker":false,"authors":[{"name":"\u7D20\u660E\u8BDA","title":"Full stack development","url":"https://github.com/sumingcheng","page":{"permalink":"/docs-hub/blog/authors/sumingcheng"},"socials":{"x":"https://x.com/sumingcheng","github":"https://github.com/sumingcheng"},"imageURL":"https://github.com/user-attachments/assets/9a06bd55-094a-4efc-91c3-d1b92236822f","key":"sumingcheng"}],"frontMatter":{"slug":"express-\u4E2D\u4F7F\u7528-winston-\u8BB0\u5F55\u65E5\u5FD7","title":"Express \u4E2D\u4F7F\u7528 Winston \u8BB0\u5F55\u65E5\u5FD7","authors":["sumingcheng"],"tags":["backend"],"date":"2024-06-27T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Zsh \u8BBE\u7F6E\u5386\u53F2\u8BB0\u5F55\u7684\u6700\u5927\u6761\u6570","permalink":"/docs-hub/blog/zsh-\u8BBE\u7F6E\u5386\u53F2\u8BB0\u5F55\u7684\u6700\u5927\u6761\u6570"},"nextItem":{"title":"docker \u67E5\u770B volume \u4F4D\u7F6E","permalink":"/docs-hub/blog/docker-\u67E5\u770B-volume-\u4F4D\u7F6E"}}')}}]);