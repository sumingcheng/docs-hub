"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([[46299],{25635:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>t,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>c,toc:()=>l});const c=JSON.parse('{"id":"Backend/Go/\u5e76\u53d1/\u8bfb\u5199\u9501","title":"Go \u8bfb\u5199\u9501\uff08sync.RWMutex\uff09\u8be6\u89e3","description":"\u7279\u70b9","source":"@site/docs/Backend/Go/\u5e76\u53d1/2.\u8bfb\u5199\u9501.md","sourceDirName":"Backend/Go/\u5e76\u53d1","slug":"/Backend/Go/\u5e76\u53d1/\u8bfb\u5199\u9501","permalink":"/docs-hub/docs/Backend/Go/\u5e76\u53d1/\u8bfb\u5199\u9501","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/Go/\u5e76\u53d1/2.\u8bfb\u5199\u9501.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1733823104000,"sidebarPosition":2,"frontMatter":{},"sidebar":"goSidebar","previous":{"title":"Go \u901a\u9053\uff08Channel\uff09\u963b\u585e\u8be6\u89e3","permalink":"/docs-hub/docs/Backend/Go/\u5e76\u53d1/Channel"},"next":{"title":"Go \u4e0a\u4e0b\u6587\uff08context\uff09\u8be6\u89e3","permalink":"/docs-hub/docs/Backend/Go/\u5e76\u53d1/Context"}}');var o=r(74848),i=r(28453);const d={},s="Go \u8bfb\u5199\u9501\uff08sync.RWMutex\uff09\u8be6\u89e3",t={},l=[{value:"\u7279\u70b9",id:"\u7279\u70b9",level:2},{value:"\u4e3a\u4ec0\u4e48\u8981\u6709\u8bfb\u5199\u9501",id:"\u4e3a\u4ec0\u4e48\u8981\u6709\u8bfb\u5199\u9501",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"\u793a\u4f8b\u89e3\u6790",id:"\u793a\u4f8b\u89e3\u6790",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:3},{value:"\u793a\u4f8b\u6539\u8fdb",id:"\u793a\u4f8b\u6539\u8fdb",level:3},{value:"\u8f93\u51fa\u793a\u4f8b",id:"\u8f93\u51fa\u793a\u4f8b",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"go-\u8bfb\u5199\u9501syncrwmutex\u8be6\u89e3",children:"Go \u8bfb\u5199\u9501\uff08sync.RWMutex\uff09\u8be6\u89e3"})}),"\n",(0,o.jsx)(e.h2,{id:"\u7279\u70b9",children:"\u7279\u70b9"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u8bfb\u9501\u5b9a\uff08\u5171\u4eab\u9501\u5b9a\uff09"})}),"\n",(0,o.jsxs)(e.p,{children:["\u5f53\u4e00\u4e2a ",(0,o.jsx)(e.code,{children:"goroutine"})," \u83b7\u53d6\u8bfb\u9501\u5b9a\u65f6\uff0c\u5176\u4ed6 ",(0,o.jsx)(e.code,{children:"goroutine"})," \u53ef\u4ee5\u540c\u65f6\u83b7\u53d6\u8bfb\u9501\u5b9a\u3002\u4f46\u5982\u679c\u6709 ",(0,o.jsx)(e.code,{children:"goroutine"})," \u60f3\u83b7\u53d6\u5199\u9501\u5b9a\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u7684\u8bfb\u9501\u5b9a\u88ab\u91ca\u653e\u3002"]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u5199\u9501\u5b9a\uff08\u72ec\u5360\u9501\u5b9a\uff09"})}),"\n",(0,o.jsxs)(e.p,{children:["\u5f53\u4e00\u4e2a ",(0,o.jsx)(e.code,{children:"goroutine"})," \u83b7\u53d6\u5199\u9501\u5b9a\u65f6\uff0c\u5176\u4ed6\u4efb\u4f55 ",(0,o.jsx)(e.code,{children:"goroutine"}),"\uff08\u65e0\u8bba\u662f\u8bfb\u9501\u5b9a\u8fd8\u662f\u5199\u9501\u5b9a\uff09\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u5199\u9501\u5b9a\u88ab\u91ca\u653e\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u4e3a\u4ec0\u4e48\u8981\u6709\u8bfb\u5199\u9501",children:"\u4e3a\u4ec0\u4e48\u8981\u6709\u8bfb\u5199\u9501"}),"\n",(0,o.jsx)(e.p,{children:"\u8bfb\u5199\u9501\u5141\u8bb8\u591a\u4e2a\u8bfb\u53d6\u8005\u540c\u65f6\u8bbf\u95ee\u8d44\u6e90\uff0c\u4f46\u5199\u5165\u8005\u9700\u8981\u72ec\u5360\u8bbf\u95ee\u3002\u8fd9\u79cd\u673a\u5236\u975e\u5e38\u9002\u5408\u4e8e\u8bfb\u64cd\u4f5c\u8fdc\u591a\u4e8e\u5199\u64cd\u4f5c\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u63d0\u9ad8\u7a0b\u5e8f\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u6027\u80fd\u3002"}),"\n",(0,o.jsx)(e.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "sync"\n)\n\nvar (\n    rwLock     sync.RWMutex\n    sharedData int\n    waitGroup  sync.WaitGroup\n)\n\nfunc main() {\n    waitGroup.Add(2)\n\n    // \u542f\u52a8\u4e00\u4e2a\u5199\u64cd\u4f5c\u7684 goroutine\n    go func() {\n        defer waitGroup.Done()\n        writeData(10)\n    }()\n\n    // \u542f\u52a8\u4e00\u4e2a\u8bfb\u64cd\u4f5c\u7684 goroutine\n    go func() {\n        defer waitGroup.Done()\n        readData()\n    }()\n\n    waitGroup.Wait()\n    fmt.Println("\u6240\u6709 goroutine \u6267\u884c\u5b8c\u6bd5")\n}\n\nfunc readData() {\n    rwLock.RLock()            // \u83b7\u53d6\u8bfb\u9501\n    fmt.Println("\u8bfb\u53d6\u7684\u6570\u503c\u4e3a", sharedData)\n    rwLock.RUnlock()          // \u91ca\u653e\u8bfb\u9501\n}\n\nfunc writeData(value int) {\n    rwLock.Lock()             // \u83b7\u53d6\u5199\u9501\n    sharedData = value\n    fmt.Println("\u5199\u5165\u7684\u6570\u503c\u4e3a", value)\n    rwLock.Unlock()           // \u91ca\u653e\u5199\u9501\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u793a\u4f8b\u89e3\u6790",children:"\u793a\u4f8b\u89e3\u6790"}),"\n",(0,o.jsxs)(e.p,{children:["\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf ",(0,o.jsx)(e.code,{children:"sharedData"}),"\uff0c\u4ee5\u53ca\u4e00\u4e2a\u8bfb\u5199\u9501 ",(0,o.jsx)(e.code,{children:"rwLock"}),"\u3002\u901a\u8fc7 ",(0,o.jsx)(e.code,{children:"waitGroup"})," \u6765\u7b49\u5f85\u6240\u6709\u7684 goroutine \u6267\u884c\u5b8c\u6bd5\u3002"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u5199\u64cd\u4f5c"})}),"\n",(0,o.jsxs)(e.p,{children:["\u5728 ",(0,o.jsx)(e.code,{children:"writeData"})," \u51fd\u6570\u4e2d\uff0c\u9996\u5148\u8c03\u7528 ",(0,o.jsx)(e.code,{children:"rwLock.Lock()"})," \u83b7\u53d6\u5199\u9501\uff0c\u8fd9\u4f1a\u963b\u585e\u5176\u4ed6\u7684\u8bfb\u548c\u5199\u64cd\u4f5c\u3002\u5199\u5165\u5b8c\u6210\u540e\uff0c\u8c03\u7528 ",(0,o.jsx)(e.code,{children:"rwLock.Unlock()"})," \u91ca\u653e\u5199\u9501\u3002"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u8bfb\u64cd\u4f5c"})}),"\n",(0,o.jsxs)(e.p,{children:["\u5728 ",(0,o.jsx)(e.code,{children:"readData"})," \u51fd\u6570\u4e2d\uff0c\u9996\u5148\u8c03\u7528 ",(0,o.jsx)(e.code,{children:"rwLock.RLock()"})," \u83b7\u53d6\u8bfb\u9501\u3002\u591a\u4e2a\u8bfb\u64cd\u4f5c\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\uff0c\u4f46\u5982\u679c\u6709\u5199\u9501\u5b58\u5728\uff0c\u8bfb\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e\u3002\u8bfb\u53d6\u5b8c\u6210\u540e\uff0c\u8c03\u7528 ",(0,o.jsx)(e.code,{children:"rwLock.RUnlock()"})," \u91ca\u653e\u8bfb\u9501\u3002"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u6b63\u786e\u5339\u914d\u9501\u548c\u89e3\u9501"})}),"\n",(0,o.jsxs)(e.p,{children:["\u6bcf\u6b21\u83b7\u53d6\u9501\u540e\uff0c\u52a1\u5fc5\u786e\u4fdd\u5728\u51fd\u6570\u7ed3\u675f\u524d\u91ca\u653e\u9501\u3002\u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(e.code,{children:"defer"})," \u8bed\u53e5\u6765\u4fdd\u8bc1\u9501\u7684\u91ca\u653e\uff0c\u907f\u514d\u9057\u6f0f\u3002"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u907f\u514d\u6b7b\u9501"})}),"\n",(0,o.jsx)(e.p,{children:"\u907f\u514d\u5728\u83b7\u53d6\u9501\u540e\u51fa\u73b0\u963b\u585e\u5bfc\u81f4\u65e0\u6cd5\u91ca\u653e\u9501\u7684\u60c5\u51b5\uff0c\u6ce8\u610f\u9501\u7684\u83b7\u53d6\u987a\u5e8f\u548c\u903b\u8f91\uff0c\u9632\u6b62\u6b7b\u9501\u53d1\u751f\u3002"}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f"})}),"\n",(0,o.jsxs)(e.p,{children:["\u8bfb\u5199\u9501\u9002\u7528\u4e8e\u8bfb\u64cd\u4f5c\u8fdc\u591a\u4e8e\u5199\u64cd\u4f5c\u7684\u60c5\u51b5\u3002\u5982\u679c\u5199\u64cd\u4f5c\u9891\u7e41\uff0c\u8bfb\u5199\u9501\u53ef\u80fd\u4f1a\u964d\u4f4e\u6027\u80fd\uff0c\u6b64\u65f6\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u4e92\u65a5\u9501 ",(0,o.jsx)(e.code,{children:"sync.Mutex"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"\u793a\u4f8b\u6539\u8fdb",children:"\u793a\u4f8b\u6539\u8fdb"}),"\n",(0,o.jsx)(e.p,{children:"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u542f\u52a8\u591a\u4e2a\u8bfb\u5199 goroutine\uff0c\u6a21\u62df\u66f4\u590d\u6742\u7684\u5e76\u53d1\u573a\u666f\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func main() {\n    for i := 0; i < 5; i++ {\n        waitGroup.Add(1)\n        go func() {\n            defer waitGroup.Done()\n            readData()\n        }()\n    }\n\n    for i := 0; i < 2; i++ {\n        waitGroup.Add(1)\n        go func(value int) {\n            defer waitGroup.Done()\n            writeData(value)\n        }(i * 10)\n    }\n\n    waitGroup.Wait()\n    fmt.Println("\u6240\u6709 goroutine \u6267\u884c\u5b8c\u6bd5")\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u8f93\u51fa\u793a\u4f8b",children:"\u8f93\u51fa\u793a\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"\u5199\u5165\u7684\u6570\u503c\u4e3a 0\n\u8bfb\u53d6\u7684\u6570\u503c\u4e3a 0\n\u8bfb\u53d6\u7684\u6570\u503c\u4e3a 0\n\u8bfb\u53d6\u7684\u6570\u503c\u4e3a 0\n\u5199\u5165\u7684\u6570\u503c\u4e3a 10\n\u8bfb\u53d6\u7684\u6570\u503c\u4e3a 10\n\u8bfb\u53d6\u7684\u6570\u503c\u4e3a 10\n\u6240\u6709 goroutine \u6267\u884c\u5b8c\u6bd5\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"\u63d0\u793a"})," \u8bfb\u5199\u9501\u5728\u9700\u8981\u9ad8\u5e76\u53d1\u8bfb\u3001\u4f4e\u5e76\u53d1\u5199\u7684\u573a\u666f\u4e0b\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u6027\u80fd\u3002\u6b63\u786e\u5730\u4f7f\u7528\u8bfb\u5199\u9501\uff0c\u53ef\u4ee5\u8ba9\u7a0b\u5e8f\u65e2\u4fdd\u8bc1\u6570\u636e\u7684\u5b89\u5168\u6027\uff0c\u53c8\u63d0\u9ad8\u5e76\u53d1\u6267\u884c\u6548\u7387\u3002"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(a,{...n})}):a(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>d,x:()=>s});var c=r(96540);const o={},i=c.createContext(o);function d(n){const e=c.useContext(i);return c.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:d(n.components),c.createElement(i.Provider,{value:e},n.children)}}}]);