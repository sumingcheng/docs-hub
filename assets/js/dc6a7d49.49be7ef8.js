"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["48852"],{7207:function(n,e,r){r.r(e),r.d(e,{default:()=>h,frontMatter:()=>d,metadata:()=>i,assets:()=>s,toc:()=>l,contentTitle:()=>t});var i=JSON.parse('{"id":"Backend/Go/\u5E76\u53D1/\u8BFB\u5199\u9501","title":"Go \u8BFB\u5199\u9501\uFF08sync.RWMutex\uFF09\u8BE6\u89E3","description":"\u7279\u70B9","source":"@site/docs/Backend/Go/\u5E76\u53D1/2.\u8BFB\u5199\u9501.md","sourceDirName":"Backend/Go/\u5E76\u53D1","slug":"/Backend/Go/\u5E76\u53D1/\u8BFB\u5199\u9501","permalink":"/docs-hub/Backend/Go/\u5E76\u53D1/\u8BFB\u5199\u9501","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/Go/\u5E76\u53D1/2.\u8BFB\u5199\u9501.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1734262986000,"sidebarPosition":2,"frontMatter":{},"sidebar":"goSidebar","previous":{"title":"Go \u901A\u9053\uFF08Channel\uFF09\u963B\u585E\u8BE6\u89E3","permalink":"/docs-hub/Backend/Go/\u5E76\u53D1/Channel"},"next":{"title":"Go \u4E0A\u4E0B\u6587\uFF08context\uFF09\u8BE6\u89E3","permalink":"/docs-hub/Backend/Go/\u5E76\u53D1/Context"}}'),c=r("85893"),o=r("50065");let d={},t="Go \u8BFB\u5199\u9501\uFF08sync.RWMutex\uFF09\u8BE6\u89E3",s={},l=[{value:"\u7279\u70B9",id:"\u7279\u70B9",level:2},{value:"\u4E3A\u4EC0\u4E48\u8981\u6709\u8BFB\u5199\u9501",id:"\u4E3A\u4EC0\u4E48\u8981\u6709\u8BFB\u5199\u9501",level:2},{value:"\u4F7F\u7528\u65B9\u6CD5",id:"\u4F7F\u7528\u65B9\u6CD5",level:2},{value:"\u793A\u4F8B\u89E3\u6790",id:"\u793A\u4F8B\u89E3\u6790",level:3},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:3},{value:"\u793A\u4F8B\u6539\u8FDB",id:"\u793A\u4F8B\u6539\u8FDB",level:3},{value:"\u8F93\u51FA\u793A\u4F8B",id:"\u8F93\u51FA\u793A\u4F8B",level:3}];function a(n){let e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"go-\u8BFB\u5199\u9501syncrwmutex\u8BE6\u89E3",children:"Go \u8BFB\u5199\u9501\uFF08sync.RWMutex\uFF09\u8BE6\u89E3"})}),"\n",(0,c.jsx)(e.h2,{id:"\u7279\u70B9",children:"\u7279\u70B9"}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u8BFB\u9501\u5B9A\uFF08\u5171\u4EAB\u9501\u5B9A\uFF09"})}),"\n",(0,c.jsxs)(e.p,{children:["\u5F53\u4E00\u4E2A ",(0,c.jsx)(e.code,{children:"goroutine"})," \u83B7\u53D6\u8BFB\u9501\u5B9A\u65F6\uFF0C\u5176\u4ED6 ",(0,c.jsx)(e.code,{children:"goroutine"})," \u53EF\u4EE5\u540C\u65F6\u83B7\u53D6\u8BFB\u9501\u5B9A\u3002\u4F46\u5982\u679C\u6709 ",(0,c.jsx)(e.code,{children:"goroutine"})," \u60F3\u83B7\u53D6\u5199\u9501\u5B9A\uFF0C\u5C31\u4F1A\u88AB\u963B\u585E\uFF0C\u76F4\u5230\u6240\u6709\u7684\u8BFB\u9501\u5B9A\u88AB\u91CA\u653E\u3002"]}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u5199\u9501\u5B9A\uFF08\u72EC\u5360\u9501\u5B9A\uFF09"})}),"\n",(0,c.jsxs)(e.p,{children:["\u5F53\u4E00\u4E2A ",(0,c.jsx)(e.code,{children:"goroutine"})," \u83B7\u53D6\u5199\u9501\u5B9A\u65F6\uFF0C\u5176\u4ED6\u4EFB\u4F55 ",(0,c.jsx)(e.code,{children:"goroutine"}),"\uFF08\u65E0\u8BBA\u662F\u8BFB\u9501\u5B9A\u8FD8\u662F\u5199\u9501\u5B9A\uFF09\u90FD\u4F1A\u88AB\u963B\u585E\uFF0C\u76F4\u5230\u5199\u9501\u5B9A\u88AB\u91CA\u653E\u3002"]}),"\n",(0,c.jsx)(e.h2,{id:"\u4E3A\u4EC0\u4E48\u8981\u6709\u8BFB\u5199\u9501",children:"\u4E3A\u4EC0\u4E48\u8981\u6709\u8BFB\u5199\u9501"}),"\n",(0,c.jsx)(e.p,{children:"\u8BFB\u5199\u9501\u5141\u8BB8\u591A\u4E2A\u8BFB\u53D6\u8005\u540C\u65F6\u8BBF\u95EE\u8D44\u6E90\uFF0C\u4F46\u5199\u5165\u8005\u9700\u8981\u72EC\u5360\u8BBF\u95EE\u3002\u8FD9\u79CD\u673A\u5236\u975E\u5E38\u9002\u5408\u4E8E\u8BFB\u64CD\u4F5C\u8FDC\u591A\u4E8E\u5199\u64CD\u4F5C\u7684\u60C5\u51B5\uFF0C\u53EF\u4EE5\u63D0\u9AD8\u7A0B\u5E8F\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\u7684\u6027\u80FD\u3002"}),"\n",(0,c.jsx)(e.h2,{id:"\u4F7F\u7528\u65B9\u6CD5",children:"\u4F7F\u7528\u65B9\u6CD5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "sync"\n)\n\nvar (\n    rwLock     sync.RWMutex\n    sharedData int\n    waitGroup  sync.WaitGroup\n)\n\nfunc main() {\n    waitGroup.Add(2)\n\n    // \u542F\u52A8\u4E00\u4E2A\u5199\u64CD\u4F5C\u7684 goroutine\n    go func() {\n        defer waitGroup.Done()\n        writeData(10)\n    }()\n\n    // \u542F\u52A8\u4E00\u4E2A\u8BFB\u64CD\u4F5C\u7684 goroutine\n    go func() {\n        defer waitGroup.Done()\n        readData()\n    }()\n\n    waitGroup.Wait()\n    fmt.Println("\u6240\u6709 goroutine \u6267\u884C\u5B8C\u6BD5")\n}\n\nfunc readData() {\n    rwLock.RLock()            // \u83B7\u53D6\u8BFB\u9501\n    fmt.Println("\u8BFB\u53D6\u7684\u6570\u503C\u4E3A", sharedData)\n    rwLock.RUnlock()          // \u91CA\u653E\u8BFB\u9501\n}\n\nfunc writeData(value int) {\n    rwLock.Lock()             // \u83B7\u53D6\u5199\u9501\n    sharedData = value\n    fmt.Println("\u5199\u5165\u7684\u6570\u503C\u4E3A", value)\n    rwLock.Unlock()           // \u91CA\u653E\u5199\u9501\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u793A\u4F8B\u89E3\u6790",children:"\u793A\u4F8B\u89E3\u6790"}),"\n",(0,c.jsxs)(e.p,{children:["\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u5B9A\u4E49\u4E86\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF ",(0,c.jsx)(e.code,{children:"sharedData"}),"\uFF0C\u4EE5\u53CA\u4E00\u4E2A\u8BFB\u5199\u9501 ",(0,c.jsx)(e.code,{children:"rwLock"}),"\u3002\u901A\u8FC7 ",(0,c.jsx)(e.code,{children:"waitGroup"})," \u6765\u7B49\u5F85\u6240\u6709\u7684 goroutine \u6267\u884C\u5B8C\u6BD5\u3002"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u5199\u64CD\u4F5C"})}),"\n",(0,c.jsxs)(e.p,{children:["\u5728 ",(0,c.jsx)(e.code,{children:"writeData"})," \u51FD\u6570\u4E2D\uFF0C\u9996\u5148\u8C03\u7528 ",(0,c.jsx)(e.code,{children:"rwLock.Lock()"})," \u83B7\u53D6\u5199\u9501\uFF0C\u8FD9\u4F1A\u963B\u585E\u5176\u4ED6\u7684\u8BFB\u548C\u5199\u64CD\u4F5C\u3002\u5199\u5165\u5B8C\u6210\u540E\uFF0C\u8C03\u7528 ",(0,c.jsx)(e.code,{children:"rwLock.Unlock()"})," \u91CA\u653E\u5199\u9501\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u8BFB\u64CD\u4F5C"})}),"\n",(0,c.jsxs)(e.p,{children:["\u5728 ",(0,c.jsx)(e.code,{children:"readData"})," \u51FD\u6570\u4E2D\uFF0C\u9996\u5148\u8C03\u7528 ",(0,c.jsx)(e.code,{children:"rwLock.RLock()"})," \u83B7\u53D6\u8BFB\u9501\u3002\u591A\u4E2A\u8BFB\u64CD\u4F5C\u53EF\u4EE5\u540C\u65F6\u8FDB\u884C\uFF0C\u4F46\u5982\u679C\u6709\u5199\u9501\u5B58\u5728\uFF0C\u8BFB\u64CD\u4F5C\u4F1A\u88AB\u963B\u585E\u3002\u8BFB\u53D6\u5B8C\u6210\u540E\uFF0C\u8C03\u7528 ",(0,c.jsx)(e.code,{children:"rwLock.RUnlock()"})," \u91CA\u653E\u8BFB\u9501\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u6B63\u786E\u5339\u914D\u9501\u548C\u89E3\u9501"})}),"\n",(0,c.jsxs)(e.p,{children:["\u6BCF\u6B21\u83B7\u53D6\u9501\u540E\uFF0C\u52A1\u5FC5\u786E\u4FDD\u5728\u51FD\u6570\u7ED3\u675F\u524D\u91CA\u653E\u9501\u3002\u53EF\u4EE5\u4F7F\u7528 ",(0,c.jsx)(e.code,{children:"defer"})," \u8BED\u53E5\u6765\u4FDD\u8BC1\u9501\u7684\u91CA\u653E\uFF0C\u907F\u514D\u9057\u6F0F\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u907F\u514D\u6B7B\u9501"})}),"\n",(0,c.jsx)(e.p,{children:"\u907F\u514D\u5728\u83B7\u53D6\u9501\u540E\u51FA\u73B0\u963B\u585E\u5BFC\u81F4\u65E0\u6CD5\u91CA\u653E\u9501\u7684\u60C5\u51B5\uFF0C\u6CE8\u610F\u9501\u7684\u83B7\u53D6\u987A\u5E8F\u548C\u903B\u8F91\uFF0C\u9632\u6B62\u6B7B\u9501\u53D1\u751F\u3002"}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u8BFB\u591A\u5199\u5C11\u7684\u573A\u666F"})}),"\n",(0,c.jsxs)(e.p,{children:["\u8BFB\u5199\u9501\u9002\u7528\u4E8E\u8BFB\u64CD\u4F5C\u8FDC\u591A\u4E8E\u5199\u64CD\u4F5C\u7684\u60C5\u51B5\u3002\u5982\u679C\u5199\u64CD\u4F5C\u9891\u7E41\uFF0C\u8BFB\u5199\u9501\u53EF\u80FD\u4F1A\u964D\u4F4E\u6027\u80FD\uFF0C\u6B64\u65F6\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u4E92\u65A5\u9501 ",(0,c.jsx)(e.code,{children:"sync.Mutex"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u793A\u4F8B\u6539\u8FDB",children:"\u793A\u4F8B\u6539\u8FDB"}),"\n",(0,c.jsx)(e.p,{children:"\u5728\u5B9E\u9645\u5E94\u7528\u4E2D\uFF0C\u53EF\u4EE5\u6839\u636E\u9700\u8981\u542F\u52A8\u591A\u4E2A\u8BFB\u5199 goroutine\uFF0C\u6A21\u62DF\u66F4\u590D\u6742\u7684\u5E76\u53D1\u573A\u666F\u3002"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    for i := 0; i < 5; i++ {\n        waitGroup.Add(1)\n        go func() {\n            defer waitGroup.Done()\n            readData()\n        }()\n    }\n\n    for i := 0; i < 2; i++ {\n        waitGroup.Add(1)\n        go func(value int) {\n            defer waitGroup.Done()\n            writeData(value)\n        }(i * 10)\n    }\n\n    waitGroup.Wait()\n    fmt.Println("\u6240\u6709 goroutine \u6267\u884C\u5B8C\u6BD5")\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u8F93\u51FA\u793A\u4F8B",children:"\u8F93\u51FA\u793A\u4F8B"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"\u5199\u5165\u7684\u6570\u503C\u4E3A 0\n\u8BFB\u53D6\u7684\u6570\u503C\u4E3A 0\n\u8BFB\u53D6\u7684\u6570\u503C\u4E3A 0\n\u8BFB\u53D6\u7684\u6570\u503C\u4E3A 0\n\u5199\u5165\u7684\u6570\u503C\u4E3A 10\n\u8BFB\u53D6\u7684\u6570\u503C\u4E3A 10\n\u8BFB\u53D6\u7684\u6570\u503C\u4E3A 10\n\u6240\u6709 goroutine \u6267\u884C\u5B8C\u6BD5\n"})}),"\n",(0,c.jsxs)(e.p,{children:[(0,c.jsx)(e.strong,{children:"\u63D0\u793A"})," \u8BFB\u5199\u9501\u5728\u9700\u8981\u9AD8\u5E76\u53D1\u8BFB\u3001\u4F4E\u5E76\u53D1\u5199\u7684\u573A\u666F\u4E0B\u53EF\u4EE5\u663E\u8457\u63D0\u9AD8\u6027\u80FD\u3002\u6B63\u786E\u5730\u4F7F\u7528\u8BFB\u5199\u9501\uFF0C\u53EF\u4EE5\u8BA9\u7A0B\u5E8F\u65E2\u4FDD\u8BC1\u6570\u636E\u7684\u5B89\u5168\u6027\uFF0C\u53C8\u63D0\u9AD8\u5E76\u53D1\u6267\u884C\u6548\u7387\u3002"]})]})}function h(n={}){let{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(a,{...n})}):a(n)}},50065:function(n,e,r){r.d(e,{Z:function(){return t},a:function(){return d}});var i=r(67294);let c={},o=i.createContext(c);function d(n){let e=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:d(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);