"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["33759"],{85391:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>c,metadata:()=>o,assets:()=>d,toc:()=>l,contentTitle:()=>r});var o=JSON.parse('{"id":"Frontend/Node/WebSocket-\u4E0EHTTP\u7684\u4E0D\u540C-\u804A\u5929\u5BA4","title":"WebSocket \u4E0E HTTP \u7684\u4E0D\u540C - \u804A\u5929\u5BA4\u5B9E\u6218","description":"WebSocket \u662F\u4E00\u79CD\u5728\u5355\u4E2A TCP \u8FDE\u63A5\u4E0A\u8FDB\u884C\u5168\u53CC\u5DE5\u901A\u4FE1\u7684\u534F\u8BAE\u3002\u5B83\u4E0E HTTP \u6709\u7740\u672C\u8D28\u7684\u4E0D\u540C,\u4E0B\u9762\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u804A\u5929\u5BA4\u7684\u5B9E\u6218\u6765\u4F53\u9A8C WebSocket \u7684\u9B45\u529B\u3002","source":"@site/docs/Frontend/Node/70.WebSocket-\u4E0EHTTP\u7684\u4E0D\u540C-\u804A\u5929\u5BA4.md","sourceDirName":"Frontend/Node","slug":"/Frontend/Node/WebSocket-\u4E0EHTTP\u7684\u4E0D\u540C-\u804A\u5929\u5BA4","permalink":"/docs-hub/Frontend/Node/WebSocket-\u4E0EHTTP\u7684\u4E0D\u540C-\u804A\u5929\u5BA4","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Frontend/Node/70.WebSocket-\u4E0EHTTP\u7684\u4E0D\u540C-\u804A\u5929\u5BA4.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1734261593000,"sidebarPosition":70,"frontMatter":{},"sidebar":"nodeSidebar","previous":{"title":"Express \u642D\u5EFA\u7B80\u5355 Web \u670D\u52A1","permalink":"/docs-hub/Frontend/Node/express-\u642D\u5EFA\u7B80\u5355-Web-\u670D\u52A1"},"next":{"title":"package.json \u6587\u4EF6\u914D\u7F6E\u8BE6\u89E3","permalink":"/docs-hub/Frontend/Node/package.json"}}'),t=s("85893"),i=s("50065");let c={},r="WebSocket \u4E0E HTTP \u7684\u4E0D\u540C - \u804A\u5929\u5BA4\u5B9E\u6218",d={},l=[{value:"\u521D\u59CB\u5316\u9879\u76EE",id:"\u521D\u59CB\u5316\u9879\u76EE",level:2},{value:"\u5B89\u88C5 Express",id:"\u5B89\u88C5-express",level:2},{value:"\u5B89\u88C5 nodemon",id:"\u5B89\u88C5-nodemon",level:2},{value:"\u5B89\u88C5 socket.io",id:"\u5B89\u88C5-socketio",level:2},{value:"\u914D\u7F6E package.json",id:"\u914D\u7F6E-packagejson",level:2},{value:"\u804A\u5929\u5BA4\u5B9E\u73B0",id:"\u804A\u5929\u5BA4\u5B9E\u73B0",level:2},{value:"\u670D\u52A1\u7AEF",id:"\u670D\u52A1\u7AEF",level:3},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF",level:3},{value:"\u603B\u7ED3",id:"\u603B\u7ED3",level:2},{value:"\u804A\u5929\u5BA4 Demo",id:"\u804A\u5929\u5BA4-demo",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"websocket-\u4E0E-http-\u7684\u4E0D\u540C---\u804A\u5929\u5BA4\u5B9E\u6218",children:"WebSocket \u4E0E HTTP \u7684\u4E0D\u540C - \u804A\u5929\u5BA4\u5B9E\u6218"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://zh.javascript.info/websocket",children:"WebSocket"})," \u662F\u4E00\u79CD\u5728\u5355\u4E2A TCP \u8FDE\u63A5\u4E0A\u8FDB\u884C\u5168\u53CC\u5DE5\u901A\u4FE1\u7684\u534F\u8BAE\u3002\u5B83\u4E0E HTTP \u6709\u7740\u672C\u8D28\u7684\u4E0D\u540C,\u4E0B\u9762\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u804A\u5929\u5BA4\u7684\u5B9E\u6218\u6765\u4F53\u9A8C WebSocket \u7684\u9B45\u529B\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u521D\u59CB\u5316\u9879\u76EE",children:"\u521D\u59CB\u5316\u9879\u76EE"}),"\n",(0,t.jsxs)(n.p,{children:["\u9996\u5148,\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u76EE\u5F55,\u5E76\u5728\u8BE5\u76EE\u5F55\u4E0B\u8FD0\u884C ",(0,t.jsx)(n.code,{children:"npm init"})," \u547D\u4EE4\u521D\u59CB\u5316\u9879\u76EE:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm init\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5B89\u88C5-express",children:"\u5B89\u88C5 Express"}),"\n",(0,t.jsx)(n.p,{children:"Express \u662F\u4E00\u4E2A\u57FA\u4E8E Node.js \u7684 Web \u5E94\u7528\u5F00\u53D1\u6846\u67B6,\u4F7F\u7528\u4E0B\u9762\u7684\u547D\u4EE4\u5B89\u88C5:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install express --save\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"--save"})," \u53C2\u6570\u8868\u793A Express \u4F1A\u4F5C\u4E3A\u751F\u4EA7\u4F9D\u8D56\u88AB\u5B89\u88C5,\u5373\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u4E5F\u4F1A\u4F7F\u7528\u5230\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5B89\u88C5-nodemon",children:"\u5B89\u88C5 nodemon"}),"\n",(0,t.jsx)(n.p,{children:"nodemon \u662F\u4E00\u4E2A\u5B9E\u7528\u5DE5\u5177,\u5B83\u4F1A\u76D1\u89C6\u9879\u76EE\u4E2D\u7684\u6587\u4EF6,\u5982\u679C\u4EE3\u7801\u53D1\u751F\u53D8\u5316,\u4F1A\u81EA\u52A8\u91CD\u542F\u5E94\u7528\u3002\u4F7F\u7528\u4E0B\u9762\u7684\u547D\u4EE4\u5B89\u88C5:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install nodemon --save-dev\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"--save-dev"})," \u53C2\u6570\u8868\u793A nodemon \u4F1A\u4F5C\u4E3A\u5F00\u53D1\u4F9D\u8D56\u88AB\u5B89\u88C5,\u53EA\u5728\u5F00\u53D1\u73AF\u5883\u4E2D\u4F7F\u7528\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5B89\u88C5-socketio",children:"\u5B89\u88C5 socket.io"}),"\n",(0,t.jsx)(n.p,{children:"socket.io \u662F\u4E00\u4E2A\u57FA\u4E8E WebSocket \u7684\u5B9E\u65F6\u5E94\u7528\u6846\u67B6,\u5B83\u5305\u62EC\u4E86\u5BA2\u6237\u7AEF\u7684 JavaScript \u548C\u670D\u52A1\u5668\u7AEF\u7684 Node.js\u3002\u4F7F\u7528\u4E0B\u9762\u7684\u547D\u4EE4\u5B89\u88C5:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install socket.io --save\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u914D\u7F6E-packagejson",children:"\u914D\u7F6E package.json"}),"\n",(0,t.jsx)(n.p,{children:"\u4E3A\u4E86\u65B9\u4FBF\u542F\u52A8\u5E94\u7528,\u6211\u4EEC\u53EF\u4EE5\u5728 package.json \u4E2D\u6DFB\u52A0\u4E00\u4E2A npm \u811A\u672C:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "name": "websocket-chat",\n  "version": "1.0.0",\n  "description": "A chat room using WebSocket",\n  "main": "index.js",\n  "scripts": {\n    "start": "nodemon index.js",\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "author": "",\n  "license": "ISC",\n  "dependencies": {\n    "express": "^4.17.3",\n    "socket.io": "^4.4.1"\n  },\n  "devDependencies": {\n    "nodemon": "^2.0.15"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u73B0\u5728,\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 ",(0,t.jsx)(n.code,{children:"npm start"})," \u547D\u4EE4\u6765\u542F\u52A8\u5E94\u7528\u4E86\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u804A\u5929\u5BA4\u5B9E\u73B0",children:"\u804A\u5929\u5BA4\u5B9E\u73B0"}),"\n",(0,t.jsx)(n.h3,{id:"\u670D\u52A1\u7AEF",children:"\u670D\u52A1\u7AEF"}),"\n",(0,t.jsxs)(n.p,{children:["\u9996\u5148,\u521B\u5EFA ",(0,t.jsx)(n.code,{children:"index.js"})," \u6587\u4EF6\u4F5C\u4E3A\u670D\u52A1\u7AEF\u5165\u53E3:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst app = express();\nconst http = require('http');\nconst server = http.createServer(app);\nconst { Server } = require('socket.io');\nconst io = new Server(server);\n\napp.get('/', (req, res) => {\n  res.sendFile(__dirname + '/index.html');\n});\n\nio.on('connection', (socket) => {\n  console.log('a user connected');\n  socket.on('disconnect', () => {\n    console.log('user disconnected');\n  });\n  socket.on('chat message', (msg) => {\n    io.emit('chat message', msg);\n  });\n});\n\nserver.listen(3000, () => {\n  console.log('listening on *:3000');\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8FD9\u6BB5\u4EE3\u7801\u7684\u4E3B\u8981\u529F\u80FD:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u521B\u5EFA\u4E00\u4E2A Express \u5E94\u7528,\u5E76\u5C06\u5176\u4F20\u9012\u7ED9 HTTP \u670D\u52A1\u5668"}),"\n",(0,t.jsx)(n.li,{children:"\u521B\u5EFA\u4E00\u4E2A Socket.IO \u670D\u52A1\u5668,\u5E76\u5C06\u5176\u9644\u52A0\u5230 HTTP \u670D\u52A1\u5668\u4E0A"}),"\n",(0,t.jsxs)(n.li,{children:["\u4E3A\u6839\u8DEF\u5F84 ",(0,t.jsx)(n.code,{children:"/"})," \u63D0\u4F9B\u670D\u52A1,\u8FD4\u56DE ",(0,t.jsx)(n.code,{children:"index.html"})," \u6587\u4EF6"]}),"\n",(0,t.jsxs)(n.li,{children:["\u76D1\u542C\u5BA2\u6237\u7AEF\u8FDE\u63A5\u4E8B\u4EF6 ",(0,t.jsx)(n.code,{children:"connection"}),",\u5F53\u6709\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65F6\u8F93\u51FA\u65E5\u5FD7"]}),"\n",(0,t.jsxs)(n.li,{children:["\u76D1\u542C\u5BA2\u6237\u7AEF\u65AD\u5F00\u8FDE\u63A5\u4E8B\u4EF6 ",(0,t.jsx)(n.code,{children:"disconnect"}),",\u5F53\u6709\u5BA2\u6237\u7AEF\u65AD\u5F00\u65F6\u8F93\u51FA\u65E5\u5FD7"]}),"\n",(0,t.jsxs)(n.li,{children:["\u76D1\u542C\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u804A\u5929\u6D88\u606F\u4E8B\u4EF6 ",(0,t.jsx)(n.code,{children:"chat message"}),",\u5C06\u6536\u5230\u7684\u6D88\u606F\u5E7F\u64AD\u7ED9\u6240\u6709\u8FDE\u63A5\u7684\u5BA2\u6237\u7AEF"]}),"\n",(0,t.jsx)(n.li,{children:"\u542F\u52A8 HTTP \u670D\u52A1\u5668,\u76D1\u542C 3000 \u7AEF\u53E3"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u5BA2\u6237\u7AEF",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,t.jsxs)(n.p,{children:["\u63A5\u4E0B\u6765,\u521B\u5EFA ",(0,t.jsx)(n.code,{children:"index.html"})," \u6587\u4EF6\u4F5C\u4E3A\u5BA2\u6237\u7AEF\u9875\u9762:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:"<!DOCTYPE html>\n<html>\n  <head>\n    <title>Socket.IO chat</title>\n    <style>\n      body {\n        margin: 0;\n        padding-bottom: 3rem;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n      }\n\n      #form {\n        background: rgba(0, 0, 0, 0.15);\n        padding: 0.25rem;\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        display: flex;\n        height: 3rem;\n        box-sizing: border-box;\n        backdrop-filter: blur(10px);\n      }\n      #input {\n        border: none;\n        padding: 0 1rem;\n        flex-grow: 1;\n        border-radius: 2rem;\n        margin: 0.25rem;\n      }\n      #input:focus {\n        outline: none;\n      }\n      #form > button {\n        background: #333;\n        border: none;\n        padding: 0 1rem;\n        margin: 0.25rem;\n        border-radius: 3px;\n        outline: none;\n        color: #fff;\n      }\n\n      #messages {\n        list-style-type: none;\n        margin: 0;\n        padding: 0;\n      }\n      #messages > li {\n        padding: 0.5rem 1rem;\n      }\n      #messages > li:nth-child(odd) {\n        background: #efefef;\n      }\n    </style>\n  </head>\n  <body>\n    <ul id=\"messages\"></ul>\n    <form id=\"form\" action=\"\"><input id=\"input\" autocomplete=\"off\" /><button>Send</button></form>\n    <script src=\"/socket.io/socket.io.js\"><\/script>\n    <script>\n      var socket = io();\n\n      var messages = document.getElementById('messages');\n      var form = document.getElementById('form');\n      var input = document.getElementById('input');\n\n      form.addEventListener('submit', function (e) {\n        e.preventDefault();\n        if (input.value) {\n          socket.emit('chat message', input.value);\n          input.value = '';\n        }\n      });\n\n      socket.on('chat message', function (msg) {\n        var item = document.createElement('li');\n        item.textContent = msg;\n        messages.appendChild(item);\n        window.scrollTo(0, document.body.scrollHeight);\n      });\n    <\/script>\n  </body>\n</html>\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8FD9\u6BB5\u4EE3\u7801\u7684\u4E3B\u8981\u529F\u80FD:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u5F15\u5165 Socket.IO \u5BA2\u6237\u7AEF\u5E93"}),"\n",(0,t.jsx)(n.li,{children:"\u521B\u5EFA\u4E00\u4E2A Socket.IO \u5BA2\u6237\u7AEF\u5B9E\u4F8B,\u8FDE\u63A5\u5230\u670D\u52A1\u5668"}),"\n",(0,t.jsx)(n.li,{children:"\u83B7\u53D6\u6D88\u606F\u5217\u8868\u5143\u7D20\u3001\u8868\u5355\u5143\u7D20\u548C\u8F93\u5165\u6846\u5143\u7D20\u7684\u5F15\u7528"}),"\n",(0,t.jsx)(n.li,{children:"\u76D1\u542C\u8868\u5355\u7684\u63D0\u4EA4\u4E8B\u4EF6,\u963B\u6B62\u9ED8\u8BA4\u884C\u4E3A,\u5C06\u8F93\u5165\u6846\u7684\u5185\u5BB9\u53D1\u9001\u7ED9\u670D\u52A1\u5668,\u5E76\u6E05\u7A7A\u8F93\u5165\u6846"}),"\n",(0,t.jsxs)(n.li,{children:["\u76D1\u542C\u670D\u52A1\u5668\u5E7F\u64AD\u7684\u804A\u5929\u6D88\u606F\u4E8B\u4EF6 ",(0,t.jsx)(n.code,{children:"chat message"}),",\u5C06\u6536\u5230\u7684\u6D88\u606F\u6DFB\u52A0\u5230\u6D88\u606F\u5217\u8868\u4E2D,\u5E76\u6EDA\u52A8\u5230\u5E95\u90E8"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u73B0\u5728,\u6211\u4EEC\u53EF\u4EE5\u8FD0\u884C ",(0,t.jsx)(n.code,{children:"npm start"})," \u542F\u52A8\u670D\u52A1\u5668,\u7136\u540E\u5728\u6D4F\u89C8\u5668\u4E2D\u8BBF\u95EE ",(0,t.jsx)(n.code,{children:"http://localhost:3000"}),",\u5C31\u53EF\u4EE5\u770B\u5230\u804A\u5929\u5BA4\u9875\u9762\u4E86\u3002\u6253\u5F00\u591A\u4E2A\u9875\u9762,\u5C31\u53EF\u4EE5\u4E92\u76F8\u53D1\u9001\u6D88\u606F\u4E86\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u603B\u7ED3",children:"\u603B\u7ED3"}),"\n",(0,t.jsx)(n.p,{children:"\u901A\u8FC7\u8FD9\u4E2A\u7B80\u5355\u7684\u804A\u5929\u5BA4\u5B9E\u6218,\u6211\u4EEC\u53EF\u4EE5\u770B\u5230 WebSocket \u4E0E HTTP \u7684\u4E0D\u540C\u4E4B\u5904:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"WebSocket \u662F\u53CC\u5411\u901A\u4FE1,\u670D\u52A1\u5668\u53EF\u4EE5\u4E3B\u52A8\u5411\u5BA2\u6237\u7AEF\u53D1\u9001\u6D88\u606F,\u800C HTTP \u662F\u5355\u5411\u7684,\u53EA\u80FD\u7531\u5BA2\u6237\u7AEF\u53D1\u8D77\u8BF7\u6C42"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket \u662F\u957F\u8FDE\u63A5,\u5EFA\u7ACB\u8FDE\u63A5\u540E\u53EF\u4EE5\u4FDD\u6301\u901A\u4FE1,\u800C HTTP \u662F\u77ED\u8FDE\u63A5,\u6BCF\u6B21\u8BF7\u6C42\u90FD\u9700\u8981\u91CD\u65B0\u5EFA\u7ACB\u8FDE\u63A5"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket \u66F4\u52A0\u5B9E\u65F6,\u5EF6\u8FDF\u66F4\u4F4E,\u800C HTTP \u6709\u4E00\u5B9A\u7684\u5EF6\u8FDF"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket \u66F4\u52A0\u8282\u7701\u8D44\u6E90,\u4E0D\u9700\u8981\u6BCF\u6B21\u90FD\u4F20\u9012\u5B8C\u6574\u7684 HTTP \u5934"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5F53\u7136,WebSocket \u4E5F\u6709\u4E00\u4E9B\u5C40\u9650\u6027,\u6BD4\u5982\u4E0D\u652F\u6301 HTTP \u7684\u4E00\u4E9B\u7279\u6027,\u5982 Cookie\u3001HTTP \u8BA4\u8BC1\u7B49\u3002\u5728\u5B9E\u9645\u5E94\u7528\u4E2D,\u9700\u8981\u6839\u636E\u5177\u4F53\u9700\u6C42\u9009\u62E9\u5408\u9002\u7684\u6280\u672F\u65B9\u6848\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u5E0C\u671B\u901A\u8FC7\u8FD9\u4E2A\u5B9E\u6218,\u80FD\u591F\u5E2E\u52A9\u4F60\u66F4\u597D\u5730\u7406\u89E3 WebSocket \u7684\u5DE5\u4F5C\u539F\u7406\u548C\u4F7F\u7528\u65B9\u6CD5\u3002\u5982\u679C\u6709\u4EFB\u4F55\u95EE\u9898,\u6B22\u8FCE\u968F\u65F6\u4EA4\u6D41\u63A2\u8BA8\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u804A\u5929\u5BA4-demo",children:"\u804A\u5929\u5BA4 Demo"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/sumingcheng/NodeChat",children:"GitHub - sumingcheng/NodeChat: NodeChat"})})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},50065:function(e,n,s){s.d(n,{Z:function(){return r},a:function(){return c}});var o=s(67294);let t={},i=o.createContext(t);function c(e){let n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);