"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([[2153],{10714:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"Frontend/Node/WebSocket-\u4e0eHTTP\u7684\u4e0d\u540c-\u804a\u5929\u5ba4","title":"WebSocket \u4e0e HTTP \u7684\u4e0d\u540c - \u804a\u5929\u5ba4\u5b9e\u6218","description":"WebSocket \u662f\u4e00\u79cd\u5728\u5355\u4e2a TCP \u8fde\u63a5\u4e0a\u8fdb\u884c\u5168\u53cc\u5de5\u901a\u4fe1\u7684\u534f\u8bae\u3002\u5b83\u4e0e HTTP \u6709\u7740\u672c\u8d28\u7684\u4e0d\u540c,\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u804a\u5929\u5ba4\u7684\u5b9e\u6218\u6765\u4f53\u9a8c WebSocket \u7684\u9b45\u529b\u3002","source":"@site/docs/Frontend/Node/70.WebSocket-\u4e0eHTTP\u7684\u4e0d\u540c-\u804a\u5929\u5ba4.md","sourceDirName":"Frontend/Node","slug":"/Frontend/Node/WebSocket-\u4e0eHTTP\u7684\u4e0d\u540c-\u804a\u5929\u5ba4","permalink":"/docs-hub/Frontend/Node/WebSocket-\u4e0eHTTP\u7684\u4e0d\u540c-\u804a\u5929\u5ba4","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Frontend/Node/70.WebSocket-\u4e0eHTTP\u7684\u4e0d\u540c-\u804a\u5929\u5ba4.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1733919630000,"sidebarPosition":70,"frontMatter":{},"sidebar":"nodeSidebar","previous":{"title":"Express \u642d\u5efa\u7b80\u5355 Web \u670d\u52a1","permalink":"/docs-hub/Frontend/Node/express-\u642d\u5efa\u7b80\u5355-Web-\u670d\u52a1"},"next":{"title":"package.json \u6587\u4ef6\u914d\u7f6e\u8be6\u89e3","permalink":"/docs-hub/Frontend/Node/package.json"}}');var t=s(74848),i=s(28453);const c={},d="WebSocket \u4e0e HTTP \u7684\u4e0d\u540c - \u804a\u5929\u5ba4\u5b9e\u6218",r={},l=[{value:"\u521d\u59cb\u5316\u9879\u76ee",id:"\u521d\u59cb\u5316\u9879\u76ee",level:2},{value:"\u5b89\u88c5 Express",id:"\u5b89\u88c5-express",level:2},{value:"\u5b89\u88c5 nodemon",id:"\u5b89\u88c5-nodemon",level:2},{value:"\u5b89\u88c5 socket.io",id:"\u5b89\u88c5-socketio",level:2},{value:"\u914d\u7f6e package.json",id:"\u914d\u7f6e-packagejson",level:2},{value:"\u804a\u5929\u5ba4\u5b9e\u73b0",id:"\u804a\u5929\u5ba4\u5b9e\u73b0",level:2},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:3},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u804a\u5929\u5ba4 Demo",id:"\u804a\u5929\u5ba4-demo",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"websocket-\u4e0e-http-\u7684\u4e0d\u540c---\u804a\u5929\u5ba4\u5b9e\u6218",children:"WebSocket \u4e0e HTTP \u7684\u4e0d\u540c - \u804a\u5929\u5ba4\u5b9e\u6218"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://zh.javascript.info/websocket",children:"WebSocket"})," \u662f\u4e00\u79cd\u5728\u5355\u4e2a TCP \u8fde\u63a5\u4e0a\u8fdb\u884c\u5168\u53cc\u5de5\u901a\u4fe1\u7684\u534f\u8bae\u3002\u5b83\u4e0e HTTP \u6709\u7740\u672c\u8d28\u7684\u4e0d\u540c,\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u804a\u5929\u5ba4\u7684\u5b9e\u6218\u6765\u4f53\u9a8c WebSocket \u7684\u9b45\u529b\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u521d\u59cb\u5316\u9879\u76ee",children:"\u521d\u59cb\u5316\u9879\u76ee"}),"\n",(0,t.jsxs)(n.p,{children:["\u9996\u5148,\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u76ee\u5f55,\u5e76\u5728\u8be5\u76ee\u5f55\u4e0b\u8fd0\u884c ",(0,t.jsx)(n.code,{children:"npm init"})," \u547d\u4ee4\u521d\u59cb\u5316\u9879\u76ee:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm init\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5b89\u88c5-express",children:"\u5b89\u88c5 Express"}),"\n",(0,t.jsx)(n.p,{children:"Express \u662f\u4e00\u4e2a\u57fa\u4e8e Node.js \u7684 Web \u5e94\u7528\u5f00\u53d1\u6846\u67b6,\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install express --save\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"--save"})," \u53c2\u6570\u8868\u793a Express \u4f1a\u4f5c\u4e3a\u751f\u4ea7\u4f9d\u8d56\u88ab\u5b89\u88c5,\u5373\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4e5f\u4f1a\u4f7f\u7528\u5230\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5b89\u88c5-nodemon",children:"\u5b89\u88c5 nodemon"}),"\n",(0,t.jsx)(n.p,{children:"nodemon \u662f\u4e00\u4e2a\u5b9e\u7528\u5de5\u5177,\u5b83\u4f1a\u76d1\u89c6\u9879\u76ee\u4e2d\u7684\u6587\u4ef6,\u5982\u679c\u4ee3\u7801\u53d1\u751f\u53d8\u5316,\u4f1a\u81ea\u52a8\u91cd\u542f\u5e94\u7528\u3002\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install nodemon --save-dev\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"--save-dev"})," \u53c2\u6570\u8868\u793a nodemon \u4f1a\u4f5c\u4e3a\u5f00\u53d1\u4f9d\u8d56\u88ab\u5b89\u88c5,\u53ea\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4f7f\u7528\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5b89\u88c5-socketio",children:"\u5b89\u88c5 socket.io"}),"\n",(0,t.jsx)(n.p,{children:"socket.io \u662f\u4e00\u4e2a\u57fa\u4e8e WebSocket \u7684\u5b9e\u65f6\u5e94\u7528\u6846\u67b6,\u5b83\u5305\u62ec\u4e86\u5ba2\u6237\u7aef\u7684 JavaScript \u548c\u670d\u52a1\u5668\u7aef\u7684 Node.js\u3002\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install socket.io --save\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u914d\u7f6e-packagejson",children:"\u914d\u7f6e package.json"}),"\n",(0,t.jsx)(n.p,{children:"\u4e3a\u4e86\u65b9\u4fbf\u542f\u52a8\u5e94\u7528,\u6211\u4eec\u53ef\u4ee5\u5728 package.json \u4e2d\u6dfb\u52a0\u4e00\u4e2a npm \u811a\u672c:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "name": "websocket-chat",\n  "version": "1.0.0",\n  "description": "A chat room using WebSocket",\n  "main": "index.js",\n  "scripts": {\n    "start": "nodemon index.js",\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "author": "",\n  "license": "ISC",\n  "dependencies": {\n    "express": "^4.17.3",\n    "socket.io": "^4.4.1"\n  },\n  "devDependencies": {\n    "nodemon": "^2.0.15"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u73b0\u5728,\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"npm start"})," \u547d\u4ee4\u6765\u542f\u52a8\u5e94\u7528\u4e86\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u804a\u5929\u5ba4\u5b9e\u73b0",children:"\u804a\u5929\u5ba4\u5b9e\u73b0"}),"\n",(0,t.jsx)(n.h3,{id:"\u670d\u52a1\u7aef",children:"\u670d\u52a1\u7aef"}),"\n",(0,t.jsxs)(n.p,{children:["\u9996\u5148,\u521b\u5efa ",(0,t.jsx)(n.code,{children:"index.js"})," \u6587\u4ef6\u4f5c\u4e3a\u670d\u52a1\u7aef\u5165\u53e3:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst app = express();\nconst http = require('http');\nconst server = http.createServer(app);\nconst { Server } = require('socket.io');\nconst io = new Server(server);\n\napp.get('/', (req, res) => {\n  res.sendFile(__dirname + '/index.html');\n});\n\nio.on('connection', (socket) => {\n  console.log('a user connected');\n  socket.on('disconnect', () => {\n    console.log('user disconnected');\n  });\n  socket.on('chat message', (msg) => {\n    io.emit('chat message', msg);\n  });\n});\n\nserver.listen(3000, () => {\n  console.log('listening on *:3000');\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8fd9\u6bb5\u4ee3\u7801\u7684\u4e3b\u8981\u529f\u80fd:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2a Express \u5e94\u7528,\u5e76\u5c06\u5176\u4f20\u9012\u7ed9 HTTP \u670d\u52a1\u5668"}),"\n",(0,t.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2a Socket.IO \u670d\u52a1\u5668,\u5e76\u5c06\u5176\u9644\u52a0\u5230 HTTP \u670d\u52a1\u5668\u4e0a"}),"\n",(0,t.jsxs)(n.li,{children:["\u4e3a\u6839\u8def\u5f84 ",(0,t.jsx)(n.code,{children:"/"})," \u63d0\u4f9b\u670d\u52a1,\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"index.html"})," \u6587\u4ef6"]}),"\n",(0,t.jsxs)(n.li,{children:["\u76d1\u542c\u5ba2\u6237\u7aef\u8fde\u63a5\u4e8b\u4ef6 ",(0,t.jsx)(n.code,{children:"connection"}),",\u5f53\u6709\u5ba2\u6237\u7aef\u8fde\u63a5\u65f6\u8f93\u51fa\u65e5\u5fd7"]}),"\n",(0,t.jsxs)(n.li,{children:["\u76d1\u542c\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u4e8b\u4ef6 ",(0,t.jsx)(n.code,{children:"disconnect"}),",\u5f53\u6709\u5ba2\u6237\u7aef\u65ad\u5f00\u65f6\u8f93\u51fa\u65e5\u5fd7"]}),"\n",(0,t.jsxs)(n.li,{children:["\u76d1\u542c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u804a\u5929\u6d88\u606f\u4e8b\u4ef6 ",(0,t.jsx)(n.code,{children:"chat message"}),",\u5c06\u6536\u5230\u7684\u6d88\u606f\u5e7f\u64ad\u7ed9\u6240\u6709\u8fde\u63a5\u7684\u5ba2\u6237\u7aef"]}),"\n",(0,t.jsx)(n.li,{children:"\u542f\u52a8 HTTP \u670d\u52a1\u5668,\u76d1\u542c 3000 \u7aef\u53e3"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef",children:"\u5ba2\u6237\u7aef"}),"\n",(0,t.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765,\u521b\u5efa ",(0,t.jsx)(n.code,{children:"index.html"})," \u6587\u4ef6\u4f5c\u4e3a\u5ba2\u6237\u7aef\u9875\u9762:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:"<!DOCTYPE html>\n<html>\n  <head>\n    <title>Socket.IO chat</title>\n    <style>\n      body {\n        margin: 0;\n        padding-bottom: 3rem;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n      }\n\n      #form {\n        background: rgba(0, 0, 0, 0.15);\n        padding: 0.25rem;\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        display: flex;\n        height: 3rem;\n        box-sizing: border-box;\n        backdrop-filter: blur(10px);\n      }\n      #input {\n        border: none;\n        padding: 0 1rem;\n        flex-grow: 1;\n        border-radius: 2rem;\n        margin: 0.25rem;\n      }\n      #input:focus {\n        outline: none;\n      }\n      #form > button {\n        background: #333;\n        border: none;\n        padding: 0 1rem;\n        margin: 0.25rem;\n        border-radius: 3px;\n        outline: none;\n        color: #fff;\n      }\n\n      #messages {\n        list-style-type: none;\n        margin: 0;\n        padding: 0;\n      }\n      #messages > li {\n        padding: 0.5rem 1rem;\n      }\n      #messages > li:nth-child(odd) {\n        background: #efefef;\n      }\n    </style>\n  </head>\n  <body>\n    <ul id=\"messages\"></ul>\n    <form id=\"form\" action=\"\"><input id=\"input\" autocomplete=\"off\" /><button>Send</button></form>\n    <script src=\"/socket.io/socket.io.js\"><\/script>\n    <script>\n      var socket = io();\n\n      var messages = document.getElementById('messages');\n      var form = document.getElementById('form');\n      var input = document.getElementById('input');\n\n      form.addEventListener('submit', function (e) {\n        e.preventDefault();\n        if (input.value) {\n          socket.emit('chat message', input.value);\n          input.value = '';\n        }\n      });\n\n      socket.on('chat message', function (msg) {\n        var item = document.createElement('li');\n        item.textContent = msg;\n        messages.appendChild(item);\n        window.scrollTo(0, document.body.scrollHeight);\n      });\n    <\/script>\n  </body>\n</html>\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8fd9\u6bb5\u4ee3\u7801\u7684\u4e3b\u8981\u529f\u80fd:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u5f15\u5165 Socket.IO \u5ba2\u6237\u7aef\u5e93"}),"\n",(0,t.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2a Socket.IO \u5ba2\u6237\u7aef\u5b9e\u4f8b,\u8fde\u63a5\u5230\u670d\u52a1\u5668"}),"\n",(0,t.jsx)(n.li,{children:"\u83b7\u53d6\u6d88\u606f\u5217\u8868\u5143\u7d20\u3001\u8868\u5355\u5143\u7d20\u548c\u8f93\u5165\u6846\u5143\u7d20\u7684\u5f15\u7528"}),"\n",(0,t.jsx)(n.li,{children:"\u76d1\u542c\u8868\u5355\u7684\u63d0\u4ea4\u4e8b\u4ef6,\u963b\u6b62\u9ed8\u8ba4\u884c\u4e3a,\u5c06\u8f93\u5165\u6846\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u670d\u52a1\u5668,\u5e76\u6e05\u7a7a\u8f93\u5165\u6846"}),"\n",(0,t.jsxs)(n.li,{children:["\u76d1\u542c\u670d\u52a1\u5668\u5e7f\u64ad\u7684\u804a\u5929\u6d88\u606f\u4e8b\u4ef6 ",(0,t.jsx)(n.code,{children:"chat message"}),",\u5c06\u6536\u5230\u7684\u6d88\u606f\u6dfb\u52a0\u5230\u6d88\u606f\u5217\u8868\u4e2d,\u5e76\u6eda\u52a8\u5230\u5e95\u90e8"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u73b0\u5728,\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c ",(0,t.jsx)(n.code,{children:"npm start"})," \u542f\u52a8\u670d\u52a1\u5668,\u7136\u540e\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee ",(0,t.jsx)(n.code,{children:"http://localhost:3000"}),",\u5c31\u53ef\u4ee5\u770b\u5230\u804a\u5929\u5ba4\u9875\u9762\u4e86\u3002\u6253\u5f00\u591a\u4e2a\u9875\u9762,\u5c31\u53ef\u4ee5\u4e92\u76f8\u53d1\u9001\u6d88\u606f\u4e86\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,t.jsx)(n.p,{children:"\u901a\u8fc7\u8fd9\u4e2a\u7b80\u5355\u7684\u804a\u5929\u5ba4\u5b9e\u6218,\u6211\u4eec\u53ef\u4ee5\u770b\u5230 WebSocket \u4e0e HTTP \u7684\u4e0d\u540c\u4e4b\u5904:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"WebSocket \u662f\u53cc\u5411\u901a\u4fe1,\u670d\u52a1\u5668\u53ef\u4ee5\u4e3b\u52a8\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f,\u800c HTTP \u662f\u5355\u5411\u7684,\u53ea\u80fd\u7531\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket \u662f\u957f\u8fde\u63a5,\u5efa\u7acb\u8fde\u63a5\u540e\u53ef\u4ee5\u4fdd\u6301\u901a\u4fe1,\u800c HTTP \u662f\u77ed\u8fde\u63a5,\u6bcf\u6b21\u8bf7\u6c42\u90fd\u9700\u8981\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket \u66f4\u52a0\u5b9e\u65f6,\u5ef6\u8fdf\u66f4\u4f4e,\u800c HTTP \u6709\u4e00\u5b9a\u7684\u5ef6\u8fdf"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket \u66f4\u52a0\u8282\u7701\u8d44\u6e90,\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u4f20\u9012\u5b8c\u6574\u7684 HTTP \u5934"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5f53\u7136,WebSocket \u4e5f\u6709\u4e00\u4e9b\u5c40\u9650\u6027,\u6bd4\u5982\u4e0d\u652f\u6301 HTTP \u7684\u4e00\u4e9b\u7279\u6027,\u5982 Cookie\u3001HTTP \u8ba4\u8bc1\u7b49\u3002\u5728\u5b9e\u9645\u5e94\u7528\u4e2d,\u9700\u8981\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u6280\u672f\u65b9\u6848\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u5e0c\u671b\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u6218,\u80fd\u591f\u5e2e\u52a9\u4f60\u66f4\u597d\u5730\u7406\u89e3 WebSocket \u7684\u5de5\u4f5c\u539f\u7406\u548c\u4f7f\u7528\u65b9\u6cd5\u3002\u5982\u679c\u6709\u4efb\u4f55\u95ee\u9898,\u6b22\u8fce\u968f\u65f6\u4ea4\u6d41\u63a2\u8ba8\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u804a\u5929\u5ba4-demo",children:"\u804a\u5929\u5ba4 Demo"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/sumingcheng/NodeChat",children:"GitHub - sumingcheng/NodeChat: NodeChat"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var o=s(96540);const t={},i=o.createContext(t);function c(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);