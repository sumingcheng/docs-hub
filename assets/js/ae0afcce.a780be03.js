"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["10735"],{97432:function(n,e,s){s.r(e),s.d(e,{default:()=>u,frontMatter:()=>o,metadata:()=>d,assets:()=>a,toc:()=>t,contentTitle:()=>i});var d=JSON.parse('{"id":"Backend/MongoDB/MongoDB\u805A\u5408\u4E0E\u5EFA\u6A21","title":"MongoDB \u805A\u5408\u64CD\u4F5C\u4E0E\u6570\u636E\u5EFA\u6A21","description":"\u805A\u5408\u7BA1\u9053","source":"@site/docs/Backend/MongoDB/030-MongoDB\u805A\u5408\u4E0E\u5EFA\u6A21.md","sourceDirName":"Backend/MongoDB","slug":"/Backend/MongoDB/MongoDB\u805A\u5408\u4E0E\u5EFA\u6A21","permalink":"/docs-hub/Backend/MongoDB/MongoDB\u805A\u5408\u4E0E\u5EFA\u6A21","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/MongoDB/030-MongoDB\u805A\u5408\u4E0E\u5EFA\u6A21.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1734249440000,"sidebarPosition":30,"frontMatter":{},"sidebar":"mongodbSidebar","previous":{"title":"MongoDB \u7D22\u5F15\u4E0E\u67E5\u8BE2\u4F18\u5316","permalink":"/docs-hub/Backend/MongoDB/MongoDB\u7D22\u5F15\u4E0E\u67E5\u8BE2"},"next":{"title":"MongoDB \u5B89\u5168\u4E0E\u6743\u9650\u7BA1\u7406","permalink":"/docs-hub/Backend/MongoDB/MongoDB\u5B89\u5168\u4E0E\u6743\u9650"}}'),r=s("85893"),c=s("50065");let o={},i="MongoDB \u805A\u5408\u64CD\u4F5C\u4E0E\u6570\u636E\u5EFA\u6A21",a={},t=[{value:"\u805A\u5408\u7BA1\u9053",id:"\u805A\u5408\u7BA1\u9053",level:2},{value:"\u57FA\u7840\u64CD\u4F5C\u7B26",id:"\u57FA\u7840\u64CD\u4F5C\u7B26",level:3},{value:"\u9AD8\u7EA7\u64CD\u4F5C\u7B26",id:"\u9AD8\u7EA7\u64CD\u4F5C\u7B26",level:3},{value:"\u6570\u636E\u5EFA\u6A21",id:"\u6570\u636E\u5EFA\u6A21",level:2},{value:"\u5D4C\u5165\u5F0F\u6A21\u578B",id:"\u5D4C\u5165\u5F0F\u6A21\u578B",level:3},{value:"\u5F15\u7528\u5F0F\u6A21\u578B",id:"\u5F15\u7528\u5F0F\u6A21\u578B",level:3},{value:"\u6570\u636E\u4E00\u81F4\u6027",id:"\u6570\u636E\u4E00\u81F4\u6027",level:2},{value:"\u539F\u5B50\u64CD\u4F5C",id:"\u539F\u5B50\u64CD\u4F5C",level:3},{value:"\u4E8B\u52A1\u5904\u7406",id:"\u4E8B\u52A1\u5904\u7406",level:3},{value:"\u6027\u80FD\u4F18\u5316",id:"\u6027\u80FD\u4F18\u5316",level:2},{value:"\u6570\u636E\u5206\u7247",id:"\u6570\u636E\u5206\u7247",level:3},{value:"\u6570\u636E\u538B\u7F29",id:"\u6570\u636E\u538B\u7F29",level:3},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:2}];function l(n){let e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,c.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"mongodb-\u805A\u5408\u64CD\u4F5C\u4E0E\u6570\u636E\u5EFA\u6A21",children:"MongoDB \u805A\u5408\u64CD\u4F5C\u4E0E\u6570\u636E\u5EFA\u6A21"})}),"\n",(0,r.jsx)(e.h2,{id:"\u805A\u5408\u7BA1\u9053",children:"\u805A\u5408\u7BA1\u9053"}),"\n",(0,r.jsx)(e.h3,{id:"\u57FA\u7840\u64CD\u4F5C\u7B26",children:"\u57FA\u7840\u64CD\u4F5C\u7B26"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u7B14\u8005\u7ECF\u5E38\u4F7F\u7528\u805A\u5408\u7BA1\u9053\u5904\u7406\u590D\u6742\u7684\u6570\u636E\u5206\u6790\u9700\u6C42\u3002\u4EE5\u4E0B\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u4F7F\u7528\u805A\u5408\u7BA1\u9053\u5BF9\u8BA2\u5355\u8FDB\u884C\u5206\u7EC4\u548C\u7EDF\u8BA1\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"db.orders.aggregate([\n  { $match: { status: 'completed' } },\n  {\n    $group: {\n      _id: '$customerId',\n      totalAmount: { $sum: '$amount' },\n      orderCount: { $sum: 1 },\n    },\n  },\n]);\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u7B5B\u9009\u72B6\u6001\u4E3A\u201Ccompleted\u201D\u7684\u8BA2\u5355\uFF0C\u7136\u540E\u6309",(0,r.jsx)(e.code,{children:"customerId"}),"\u5206\u7EC4\uFF0C\u8BA1\u7B97\u6BCF\u4E2A\u5BA2\u6237\u7684\u603B\u8BA2\u5355\u91D1\u989D\u548C\u8BA2\u5355\u6570\u91CF\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"\u9AD8\u7EA7\u64CD\u4F5C\u7B26",children:"\u9AD8\u7EA7\u64CD\u4F5C\u7B26"}),"\n",(0,r.jsx)(e.p,{children:"\u5904\u7406\u590D\u6742\u7684\u6570\u636E\u8F6C\u6362\u548C\u8BA1\u7B97\u65F6\uFF0C\u7B14\u8005\u5E38\u4F7F\u7528\u9AD8\u7EA7\u64CD\u4F5C\u7B26\u3002\u4EE5\u4E0B\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u5C55\u5F00\u4EA7\u54C1\u6570\u7EC4\u5E76\u8BA1\u7B97\u6BCF\u4E2A\u4EA7\u54C1\u7684\u6536\u5165\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"db.sales.aggregate([\n  { $unwind: '$products' },\n  {\n    $project: {\n      productName: '$products.name',\n      revenue: { $multiply: ['$products.price', '$products.quantity'] },\n    },\n  },\n  { $sort: { revenue: -1 } },\n]);\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u8BE5\u805A\u5408\u7BA1\u9053\u9996\u5148\u4F7F\u7528",(0,r.jsx)(e.code,{children:"$unwind"}),"\u5C06",(0,r.jsx)(e.code,{children:"products"}),"\u6570\u7EC4\u62C6\u5206\u4E3A\u5355\u72EC\u7684\u6587\u6863\uFF0C\u7136\u540E\u4F7F\u7528",(0,r.jsx)(e.code,{children:"$project"}),"\u8BA1\u7B97\u6BCF\u4E2A\u4EA7\u54C1\u7684\u6536\u5165\uFF0C\u6700\u540E\u6309\u6536\u5165\u964D\u5E8F\u6392\u5E8F\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6570\u636E\u5EFA\u6A21",children:"\u6570\u636E\u5EFA\u6A21"}),"\n",(0,r.jsx)(e.h3,{id:"\u5D4C\u5165\u5F0F\u6A21\u578B",children:"\u5D4C\u5165\u5F0F\u6A21\u578B"}),"\n",(0,r.jsx)(e.p,{children:"\u5D4C\u5165\u5F0F\u6A21\u578B\u9002\u7528\u4E8E\u4E00\u5BF9\u4E00\u6216\u4E00\u5BF9\u5C11\u91CF\u5173\u7CFB\u7684\u573A\u666F\u3002\u7B14\u8005\u5728\u8BBE\u8BA1\u7528\u6237\u8D44\u6599\u65F6\uFF0C\u9009\u62E9\u5C06\u5730\u5740\u4FE1\u606F\u5D4C\u5165\u5230\u7528\u6237\u6587\u6863\u4E2D\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"db.users.insertOne({\n  username: 'userA',\n  profile: {\n    firstName: 'Zhang',\n    lastName: 'San',\n    address: {\n      city: 'Beijing',\n      street: 'Wangfujing',\n    },\n  },\n});\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u8FD9\u79CD\u8BBE\u8BA1\u7B80\u5316\u4E86\u6570\u636E\u7ED3\u6784\uFF0C\u51CF\u5C11\u4E86\u67E5\u8BE2\u6B21\u6570\uFF0C\u9002\u5408\u7528\u6237\u548C\u5176\u8D44\u6599\u4E4B\u95F4\u7684\u7D27\u5BC6\u5173\u8054\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u5F15\u7528\u5F0F\u6A21\u578B",children:"\u5F15\u7528\u5F0F\u6A21\u578B"}),"\n",(0,r.jsx)(e.p,{children:"\u5F15\u7528\u5F0F\u6A21\u578B\u9002\u7528\u4E8E\u4E00\u5BF9\u591A\u6216\u591A\u5BF9\u591A\u5173\u7CFB\u7684\u573A\u666F\u3002\u7B14\u8005\u5728\u7BA1\u7406\u8BA2\u5355\u548C\u4EA7\u54C1\u65F6\uFF0C\u91C7\u7528\u4E86\u5F15\u7528\u5F0F\u6A21\u578B\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"db.orders.insertOne({\n  orderId: 'ORD001',\n  userId: ObjectId('user123'),\n  products: [\n    { productId: ObjectId('prod456'), quantity: 2 },\n    { productId: ObjectId('prod789'), quantity: 1 },\n  ],\n});\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u901A\u8FC7\u5F15\u7528",(0,r.jsx)(e.code,{children:"userId"}),"\u548C",(0,r.jsx)(e.code,{children:"productId"}),"\uFF0C\u53EF\u4EE5\u6709\u6548\u7BA1\u7406\u7528\u6237\u4E0E\u8BA2\u5355\u3001\u8BA2\u5355\u4E0E\u4EA7\u54C1\u4E4B\u95F4\u7684\u5173\u7CFB\uFF0C\u9002\u7528\u4E8E\u6570\u636E\u91CF\u8F83\u5927\u4E14\u5173\u7CFB\u590D\u6742\u7684\u60C5\u51B5\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6570\u636E\u4E00\u81F4\u6027",children:"\u6570\u636E\u4E00\u81F4\u6027"}),"\n",(0,r.jsx)(e.h3,{id:"\u539F\u5B50\u64CD\u4F5C",children:"\u539F\u5B50\u64CD\u4F5C"}),"\n",(0,r.jsx)(e.p,{children:"\u4E3A\u4E86\u786E\u4FDD\u5355\u4E2A\u6587\u6863\u5185\u7684\u591A\u4E2A\u5B57\u6BB5\u66F4\u65B0\u64CD\u4F5C\u7684\u539F\u5B50\u6027\uFF0C\u7B14\u8005\u4F7F\u7528\u539F\u5B50\u64CD\u4F5C\u7B26\u3002\u4F8B\u5982\uFF0C\u4EE5\u4E0B\u64CD\u4F5C\u540C\u65F6\u51CF\u5C11\u8D26\u6237\u4F59\u989D\u5E76\u8BB0\u5F55\u4EA4\u6613\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"db.accounts.updateOne(\n  { accountId: 'ACC001', balance: { $gte: 100 } },\n  {\n    $inc: { balance: -100 },\n    $push: {\n      transactions: {\n        type: 'withdrawal',\n        amount: 100,\n        timestamp: new Date(),\n      },\n    },\n  }\n);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u8FD9\u79CD\u65B9\u6CD5\u786E\u4FDD\u4E86\u5728\u66F4\u65B0\u4F59\u989D\u7684\u540C\u65F6\uFF0C\u4EA4\u6613\u8BB0\u5F55\u88AB\u6B63\u786E\u6DFB\u52A0\uFF0C\u907F\u514D\u4E86\u6570\u636E\u4E0D\u4E00\u81F4\u7684\u95EE\u9898\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u4E8B\u52A1\u5904\u7406",children:"\u4E8B\u52A1\u5904\u7406"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u9700\u8981\u4FDD\u8BC1\u591A\u6587\u6863\u64CD\u4F5C\u4E00\u81F4\u6027\u65F6\uFF0C\u7B14\u8005\u4F7F\u7528\u4E8B\u52A1\u3002\u4EE5\u4E0B\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u5728\u4F1A\u8BDD\u4E2D\u6267\u884C\u4E8B\u52A1\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"const session = db.getMongo().startSession();\nsession.startTransaction();\n\ntry {\n  db.accounts.updateOne({ accountId: 'ACC001' }, { $inc: { balance: -100 } }, { session });\n\n  db.transactions.insertOne(\n    {\n      accountId: 'ACC001',\n      type: 'transfer',\n      amount: 100,\n    },\n    { session }\n  );\n\n  session.commitTransaction();\n} catch (error) {\n  session.abortTransaction();\n} finally {\n  session.endSession();\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u901A\u8FC7\u4E8B\u52A1\uFF0C\u7B14\u8005\u786E\u4FDD\u4E86\u8D26\u6237\u4F59\u989D\u7684\u66F4\u65B0\u548C\u4EA4\u6613\u8BB0\u5F55\u7684\u63D2\u5165\u8981\u4E48\u540C\u65F6\u6210\u529F\uFF0C\u8981\u4E48\u540C\u65F6\u5931\u8D25\uFF0C\u7EF4\u62A4\u4E86\u6570\u636E\u7684\u4E00\u81F4\u6027\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u6027\u80FD\u4F18\u5316",children:"\u6027\u80FD\u4F18\u5316"}),"\n",(0,r.jsx)(e.h3,{id:"\u6570\u636E\u5206\u7247",children:"\u6570\u636E\u5206\u7247"}),"\n",(0,r.jsxs)(e.p,{children:["\u5BF9\u4E8E\u5927\u89C4\u6A21\u6570\u636E\u96C6\uFF0C\u7B14\u8005\u91C7\u7528\u5206\u7247\u7B56\u7565\u6765\u63D0\u5347\u6027\u80FD\u548C\u6269\u5C55\u6027\u3002\u4EE5\u4E0B\u547D\u4EE4\u542F\u7528\u6570\u636E\u5E93\u5206\u7247\u5E76\u5BF9",(0,r.jsx)(e.code,{children:"users"}),"\u96C6\u5408\u8FDB\u884C\u54C8\u5E0C\u5206\u7247\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"sh.enableSharding('myDatabase');\nsh.shardCollection('myDatabase.users', { userId: 'hashed' });\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5206\u7247\u80FD\u591F\u5C06\u6570\u636E\u5206\u5E03\u5230\u591A\u4E2A\u670D\u52A1\u5668\u4E0A\uFF0C\u5747\u8861\u8D1F\u8F7D\uFF0C\u63D0\u5347\u67E5\u8BE2\u548C\u5199\u5165\u6027\u80FD\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u6570\u636E\u538B\u7F29",children:"\u6570\u636E\u538B\u7F29"}),"\n",(0,r.jsxs)(e.p,{children:["\u4E3A\u4E86\u964D\u4F4E\u5B58\u50A8\u6210\u672C\uFF0C\u7B14\u8005\u914D\u7F6E\u4E86\u9002\u5F53\u7684\u538B\u7F29\u9009\u9879\u3002\u4EE5\u4E0B\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u5728\u521B\u5EFA\u96C6\u5408\u65F6\u542F\u7528",(0,r.jsx)(e.code,{children:"zlib"}),"\u538B\u7F29\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"db.createCollection('logs', {\n  storageEngine: {\n    wiredTiger: {\n      configString: 'block_compressor=zlib',\n    },\n  },\n});\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u4F7F\u7528\u6570\u636E\u538B\u7F29\u4E0D\u4EC5\u8282\u7701\u4E86\u5B58\u50A8\u7A7A\u95F4\uFF0C\u8FD8\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u63D0\u9AD8\u4E86 I/O \u6027\u80FD\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u8BBE\u8BA1\u805A\u5408\u7BA1\u9053\u548C\u6570\u636E\u6A21\u578B\u65F6\uFF0C\u9700\u6743\u8861\u67E5\u8BE2\u6027\u80FD\u4E0E\u6570\u636E\u5197\u4F59\uFF0C\u5408\u7406\u9009\u62E9\u5D4C\u5165\u5F0F\u6216\u5F15\u7528\u5F0F\u6A21\u578B\u4EE5\u6EE1\u8DB3\u4E1A\u52A1\u9700\u6C42\u3002"})]})}function u(n={}){let{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(l,{...n})}):l(n)}},50065:function(n,e,s){s.d(e,{Z:function(){return i},a:function(){return o}});var d=s(67294);let r={},c=d.createContext(r);function o(n){let e=d.useContext(c);return d.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),d.createElement(c.Provider,{value:e},n.children)}}}]);