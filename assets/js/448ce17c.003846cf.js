"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([[85432],{59965:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"Backend/Go/Protobuf/grpc-\u6570\u7ec4\u548c-map","title":"\u4f7f\u7528 Protocol Buffers \u548c gRPC \u6784\u5efa\u8bfe\u7a0b\u670d\u52a1","description":"\u5b9a\u4e49 .proto \u6587\u4ef6","source":"@site/docs/Backend/Go/Protobuf/40.grpc-\u6570\u7ec4\u548c-map.md","sourceDirName":"Backend/Go/Protobuf","slug":"/Backend/Go/Protobuf/grpc-\u6570\u7ec4\u548c-map","permalink":"/docs-hub/Backend/Go/Protobuf/grpc-\u6570\u7ec4\u548c-map","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/Go/Protobuf/40.grpc-\u6570\u7ec4\u548c-map.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1733910367000,"sidebarPosition":40,"frontMatter":{},"sidebar":"goSidebar","previous":{"title":"\u4f7f\u7528 Protocol Buffers \u5b9a\u4e49\u548c\u8bbf\u95ee\u5d4c\u5957\u6d88\u606f","permalink":"/docs-hub/Backend/Go/Protobuf/\u5d4c\u5957\u7684-message"},"next":{"title":"\u4f7f\u7528 Go \u5b9e\u73b0 gRPC \u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef","permalink":"/docs-hub/Backend/Go/Protobuf/gRPC-\u5b9e\u73b0\u6d41\u7a0b"}}');var s=r(74848),t=r(28453);const c={},i="\u4f7f\u7528 Protocol Buffers \u548c gRPC \u6784\u5efa\u8bfe\u7a0b\u670d\u52a1",a={},d=[{value:"\u5b9a\u4e49 <code>.proto</code> \u6587\u4ef6",id:"\u5b9a\u4e49-proto-\u6587\u4ef6",level:2},{value:"\u7f16\u8bd1 <code>.proto</code> \u6587\u4ef6",id:"\u7f16\u8bd1-proto-\u6587\u4ef6",level:2},{value:"\u7f16\u5199\u6570\u636e\u6587\u4ef6",id:"\u7f16\u5199\u6570\u636e\u6587\u4ef6",level:2},{value:"\u5b9e\u73b0\u670d\u52a1\u7aef",id:"\u5b9e\u73b0\u670d\u52a1\u7aef",level:2},{value:"\u5b9e\u73b0\u5ba2\u6237\u7aef",id:"\u5b9e\u73b0\u5ba2\u6237\u7aef",level:2},{value:"\u9879\u76ee\u76ee\u5f55\u7ed3\u6784",id:"\u9879\u76ee\u76ee\u5f55\u7ed3\u6784",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u4f7f\u7528-protocol-buffers-\u548c-grpc-\u6784\u5efa\u8bfe\u7a0b\u670d\u52a1",children:"\u4f7f\u7528 Protocol Buffers \u548c gRPC \u6784\u5efa\u8bfe\u7a0b\u670d\u52a1"})}),"\n",(0,s.jsxs)(n.h2,{id:"\u5b9a\u4e49-proto-\u6587\u4ef6",children:["\u5b9a\u4e49 ",(0,s.jsx)(n.code,{children:".proto"})," \u6587\u4ef6"]}),"\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u6211\u7f16\u5199\u4e86\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"course.proto"})," \u6587\u4ef6\uff0c\u5b9a\u4e49\u4e86\u8bfe\u7a0b\u4fe1\u606f\u7684\u6d88\u606f\u7c7b\u578b\u548c\u670d\u52a1\u63a5\u53e3\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-protobuf",children:'syntax = "proto3";\n\noption go_package = "./;proto";\n\nmessage CourseInfo {\n  int32 cid = 1;\n  string cname = 2;\n  string teacher = 3;\n}\n\nmessage CourseResponse {\n  int32 code = 1;\n  string msg = 2;\n  repeated CourseInfo data = 3;\n  map<string, string> extra = 4; // \u9644\u52a0\u4fe1\u606f\n}\n\nmessage CourseRequest {\n  string type = 1;\n}\n\nservice Course {\n  rpc GetCourseList (CourseRequest) returns (CourseResponse);\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"\u7f16\u8bd1-proto-\u6587\u4ef6",children:["\u7f16\u8bd1 ",(0,s.jsx)(n.code,{children:".proto"})," \u6587\u4ef6"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u7f16\u8bd1\u751f\u6210 Go \u4ee3\u7801\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"protoc -I . course.proto --go_out=. --go-grpc_out=.\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u7f16\u5199\u6570\u636e\u6587\u4ef6",children:"\u7f16\u5199\u6570\u636e\u6587\u4ef6"}),"\n",(0,s.jsxs)(n.p,{children:["\u521b\u5efa\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"data.go"})," \u6587\u4ef6\uff0c\u7528\u4e8e\u5b58\u50a8\u8bfe\u7a0b\u4fe1\u606f\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package data\n\nimport "your_project_path/proto"\n\nvar LanguageCourses = []*proto.CourseInfo{\n  {Cid: 1, Cname: "Go", Teacher: "\u5f20\u4e09"},\n  {Cid: 2, Cname: "Python", Teacher: "\u674e\u56db"},\n  {Cid: 3, Cname: "Java", Teacher: "\u738b\u4e94"},\n}\n\nvar ComputerCourses = []*proto.CourseInfo{\n  {Cid: 4, Cname: "\u8ba1\u7b97\u673a\u57fa\u7840", Teacher: "\u8d75\u516d"},\n  {Cid: 5, Cname: "\u6570\u636e\u7ed3\u6784", Teacher: "\u5b59\u4e03"},\n  {Cid: 6, Cname: "\u7b97\u6cd5", Teacher: "\u5468\u516b"},\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u5b9e\u73b0\u670d\u52a1\u7aef",children:"\u5b9e\u73b0\u670d\u52a1\u7aef"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u670d\u52a1\u7aef\u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"GetCourseList"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n  "context"\n  "your_project_path/data"\n  "your_project_path/proto"\n  "google.golang.org/grpc"\n  "net"\n)\n\ntype CourseService struct {\n  proto.UnimplementedCourseServer\n}\n\nfunc (s *CourseService) GetCourseList(ctx context.Context, req *proto.CourseRequest) (*proto.CourseResponse, error) {\n  switch req.Type {\n  case "language":\n    return &proto.CourseResponse{\n      Code: 0,\n      Msg:  "success",\n      Data: data.LanguageCourses,\n      Extra: map[string]string{\n        "note": "\u8bed\u8a00\u8bfe\u7a0b\u5217\u8868",\n      },\n    }, nil\n  case "computer":\n    return &proto.CourseResponse{\n      Code: 0,\n      Msg:  "success",\n      Data: data.ComputerCourses,\n    }, nil\n  default:\n    return &proto.CourseResponse{\n      Code: 1,\n      Msg:  "invalid course type",\n    }, nil\n  }\n}\n\nfunc main() {\n  server := grpc.NewServer()\n  proto.RegisterCourseServer(server, &CourseService{})\n  listener, err := net.Listen("tcp", ":8080")\n  if err != nil {\n    panic(err)\n  }\n  if err := server.Serve(listener); err != nil {\n    panic(err)\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u5b9e\u73b0\u5ba2\u6237\u7aef",children:"\u5b9e\u73b0\u5ba2\u6237\u7aef"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u5ba2\u6237\u7aef\u8c03\u7528\u670d\u52a1\u7aef\u7684 ",(0,s.jsx)(n.code,{children:"GetCourseList"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n  "context"\n  "encoding/json"\n  "fmt"\n  "your_project_path/proto"\n  "google.golang.org/grpc"\n  "google.golang.org/grpc/credentials/insecure"\n)\n\nfunc main() {\n  conn, err := grpc.Dial(":8080", grpc.WithTransportCredentials(insecure.NewCredentials()))\n  if err != nil {\n    panic(err)\n  }\n  defer conn.Close()\n\n  client := proto.NewCourseClient(conn)\n  response, err := client.GetCourseList(context.Background(), &proto.CourseRequest{\n    Type: "language",\n  })\n  if err != nil {\n    panic(err)\n  }\n\n  jsonData, err := json.Marshal(response)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Println(string(jsonData))\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u9879\u76ee\u76ee\u5f55\u7ed3\u6784",children:"\u9879\u76ee\u76ee\u5f55\u7ed3\u6784"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"\u9879\u76ee\u76ee\u5f55\u7ed3\u6784",src:r(23375).A+"",width:"350",height:"339"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5305\u8def\u5f84\u66ff\u6362"}),"\uff1a\u5728\u4ee3\u7801\u4e2d\uff0c\u5c06 ",(0,s.jsx)(n.code,{children:"your_project_path"})," \u66ff\u6362\u4e3a\u5b9e\u9645\u7684\u9879\u76ee\u8def\u5f84\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9519\u8bef\u5904\u7406"}),"\uff1a\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5e94\u5b8c\u5584\u9519\u8bef\u5904\u7406\u903b\u8f91\uff0c\u907f\u514d\u7a0b\u5e8f\u5d29\u6e83\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u4ee3\u7801\u4f18\u5316"}),"\uff1a\u4f7f\u7528\u6613\u8bfb\u7684\u53d8\u91cf\u540d\uff0c\u5982\u5c06 ",(0,s.jsx)(n.code,{children:"Course"})," \u6539\u4e3a ",(0,s.jsx)(n.code,{children:"CourseService"}),"\uff0c\u63d0\u9ad8\u4ee3\u7801\u53ef\u8bfb\u6027\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7248\u672c\u7ba1\u7406"}),"\uff1a\u4f7f\u7528 Go Modules \u7ba1\u7406\u4f9d\u8d56\uff0c\u786e\u4fdd\u5305\u7248\u672c\u7684\u7a33\u5b9a\u6027\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u534f\u8bae\u7f16\u8bd1"}),"\uff1a\u5efa\u8bae\u5c06\u7f16\u8bd1\u547d\u4ee4\u5199\u5165\u811a\u672c\u6216 Makefile\uff0c\u65b9\u4fbf\u540e\u7eed\u7ef4\u62a4\u3002"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},23375:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/ce1aff9a2ec262a8d2bb632e3c478a81-0d5de889eb0470368a11f954f1819a54.png"},28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>i});var o=r(96540);const s={},t=o.createContext(s);function c(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);