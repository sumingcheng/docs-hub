"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([[31735],{81349:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Frontend/HTML/history-worker","title":"History \u5bf9\u8c61\u4e0e Web Worker","description":"History \u5bf9\u8c61","source":"@site/docs/Frontend/HTML/60.history-worker.md","sourceDirName":"Frontend/HTML","slug":"/Frontend/HTML/history-worker","permalink":"/docs-hub/Frontend/HTML/history-worker","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Frontend/HTML/60.history-worker.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1733910367000,"sidebarPosition":60,"frontMatter":{},"sidebar":"htmlSidebar","previous":{"title":"\u97f3\u89c6\u9891\u6807\u7b7e audio \u548c video","permalink":"/docs-hub/Frontend/HTML/audio\u6807\u7b7e\u4e0evideo\u6807\u7b7e\u53ca\u57fa\u672c\u5e94\u7528"},"next":{"title":"\u6d4f\u89c8\u5668\u672c\u5730\u5b58\u50a8\u65b9\u5f0f\u5bf9\u6bd4","permalink":"/docs-hub/Frontend/HTML/localStorage-sessionStorage-cookies"}}');var s=r(74848),o=r(28453);const i={},d="History \u5bf9\u8c61\u4e0e Web Worker",a={},l=[{value:"History \u5bf9\u8c61",id:"history-\u5bf9\u8c61",level:2},{value:"\u540e\u9000",id:"\u540e\u9000",level:3},{value:"History.pushState()",id:"historypushstate",level:3},{value:"popstate \u4e8b\u4ef6",id:"popstate-\u4e8b\u4ef6",level:3},{value:"HashChangeEvent",id:"hashchangeevent",level:2},{value:"Web Worker",id:"web-worker",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u591a\u4e2a Worker",id:"\u591a\u4e2a-worker",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"history-\u5bf9\u8c61\u4e0e-web-worker",children:"History \u5bf9\u8c61\u4e0e Web Worker"})}),"\n",(0,s.jsx)(n.h2,{id:"history-\u5bf9\u8c61",children:"History \u5bf9\u8c61"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"window.history"}),"\u5c5e\u6027\u6307\u5411",(0,s.jsx)(n.code,{children:"History"}),"\u5bf9\u8c61,\u8868\u793a\u5f53\u524d\u7a97\u53e3\u7684\u6d4f\u89c8\u5386\u53f2\u3002\u4f8b\u5982:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"window.history.length; // 3\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"History"}),"\u5bf9\u8c61\u4e3b\u8981\u6709\u4e24\u4e2a\u5c5e\u6027:"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"History.length"}),":\u5f53\u524d\u7a97\u53e3\u8bbf\u95ee\u8fc7\u7684\u7f51\u5740\u6570\u91cf(\u5305\u62ec\u5f53\u524d\u7f51\u9875)\n",(0,s.jsx)(n.code,{children:"History.state"}),":History"," \u5806\u6808\u6700\u4e0a\u5c42\u7684\u72b6\u6001\u503c"]}),"\n",(0,s.jsx)(n.h3,{id:"\u540e\u9000",children:"\u540e\u9000"}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u5b9e\u73b0\u540e\u9000\u5230\u524d\u4e00\u4e2a\u7f51\u5740:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"history.back();\n\n// \u7b49\u540c\u4e8e\nhistory.go(-1);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"historypushstate",children:"History.pushState()"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"History.pushState()"}),"\u65b9\u6cd5\u7528\u4e8e\u5728\u5386\u53f2\u4e2d\u6dfb\u52a0\u4e00\u6761\u8bb0\u5f55,\u8bed\u6cd5\u5982\u4e0b:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"window.history.pushState(state, title, url);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"popstate-\u4e8b\u4ef6",children:"popstate \u4e8b\u4ef6"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u6bcf\u4e00\u6b21\u6d3b\u52a8\u7684\u5386\u53f2\u6761\u76ee\u53d1\u751f\u6539\u53d8\u65f6,\u5c31\u4f1a\u6709\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"popstate"}),"\u4e8b\u4ef6\u6d3e\u53d1\u7ed9",(0,s.jsx)(n.code,{children:"window"}),"\u5bf9\u8c61\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0b\u9762\u662f\u4e00\u4e2a\u901a\u8fc7",(0,s.jsx)(n.code,{children:"popstate"}),"\u4e8b\u4ef6\u5b9e\u73b0\u5386\u53f2\u8bb0\u5f55\u7684\u793a\u4f8b"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<style>\n  div {\n    box-sizing: border-box;\n  }\n\n  .container {\n    width: 800px;\n    height: 200px;\n  }\n\n  .box {\n    float: left;\n    margin: 20px;\n    color: #fff;\n    font-size: 30px;\n    font-weight: bold;\n    line-height: 150px;\n    text-align: center;\n    cursor: pointer;\n    width: 150px;\n    height: 150px;\n    transition: all 0.2s ease-out;\n  }\n\n  .box:hover {\n    background-color: #fff;\n    color: #000;\n  }\n\n  .red {\n    background-color: red;\n    border: 5px solid red;\n  }\n\n  .green {\n    background-color: green;\n    border: 5px solid green;\n  }\n\n  .blue {\n    background-color: blue;\n    border: 5px solid blue;\n  }\n\n  .black {\n    background-color: black;\n    border: 5px solid black;\n  }\n\n  .box.selected {\n    transform: scale(1.2);\n  }\n</style>\n\n<body>\n  <div class="container">\n    <div class="box red" id="box-1">1</div>\n    <div class="box green" id="box-2">2</div>\n    <div class="box blue" id="box-3">3</div>\n    <div class="box black" id="box-4">4</div>\n  </div>\n  <script>\n    let boxes = Array.from(document.getElementsByClassName(\'box\'));\n    function selectBox(id) {\n      boxes.forEach((item) => {\n        item.classList.toggle(\'selected\', item.id === id);\n      });\n    }\n    boxes.forEach((item) => {\n      item.addEventListener(\'click\', (e) => {\n        let id = item.id;\n        history.pushState({ id }, null, `selected=${id}`);\n        selectBox(id);\n      });\n    });\n    window.addEventListener(\'popstate\', (e) => {\n      let id = e.state.id;\n      selectBox(id);\n    });\n  <\/script>\n</body>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u53e6\u4e00\u4e2a\u901a\u8fc7",(0,s.jsx)(n.code,{children:"popstate"}),"\u4e8b\u4ef6\u5b9e\u73b0\u8fc7\u6ee4\u529f\u80fd\u7684\u793a\u4f8b"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<body>\n  <input type=\"text\" id=\"inputKwd\" />\n  <button id=\"btn\">\u67e5\u8be2</button>\n  <div class=\"output\"></div>\n  <script>\n    var data = [{ name: 'VueJS0' }, { name: 'VueJS1' }, { name: 'VueJS2' }, { name: 'VueJS3' }, { name: 'VueJS4' }, { name: 'VueJS5' }];\n    var outputArea = document.getElementsByClassName('output')[0],\n      btn = document.getElementById('btn'),\n      inputKwd = document.getElementById('inputKwd');\n\n    btn.addEventListener('click', function () {\n      var keyword = inputKwd.value;\n      var filteredData = data.filter(function (item) {\n        return item.name.indexOf(keyword) !== -1;\n      });\n      renderDom(filteredData);\n      history.pushState({ keyword }, null, '#' + keyword);\n    });\n\n    function renderDom(data) {\n      var html = data.map((item) => `<p>${item.name}</p>`).join('');\n      outputArea.innerHTML = html;\n    }\n\n    renderDom(data);\n\n    window.addEventListener(\n      'popstate',\n      function (e) {\n        var keyword = e.state ? e.state.keyword : '';\n        var filteredData = data.filter(function (item) {\n          return item.name.indexOf(keyword) !== -1;\n        });\n\n        inputKwd.value = keyword;\n        renderDom(filteredData);\n      },\n      false\n    );\n  <\/script>\n</body>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"hashchangeevent",children:"HashChangeEvent"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HashChangeEvent"}),"\u63a5\u53e3\u8868\u793a\u4e00\u4e2a\u53d8\u5316\u4e8b\u4ef6,\u5f53 URL \u4e2d\u7684\u7247\u6bb5\u6807\u8bc6\u7b26(\u5373",(0,s.jsx)(n.code,{children:"#"}),"\u53f7\u540e\u9762\u7684\u90e8\u5206)\u53d1\u751f\u6539\u53d8\u65f6,\u4f1a\u89e6\u53d1\u6b64\u4e8b\u4ef6\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"web-worker",children:"Web Worker"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Worker",children:"Worker"})," \u662f\u4e00\u4e2a\u53ef\u4ee5\u5728\u540e\u53f0\u8fd0\u884c\u811a\u672c\u800c\u4e0d\u5f71\u54cd\u9875\u9762\u6027\u80fd\u7684 JavaScript \u63a5\u53e3\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"Web Worker \u6709\u4ee5\u4e0b\u7279\u70b9:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:"postMessage"}),"\u548c",(0,s.jsx)(n.code,{children:"onmessage"}),"\u8fdb\u884c\u4fe1\u606f\u7684\u4f20\u9012\u548c\u63a5\u6536,\u4e0d\u652f\u6301\u8de8\u57df\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["Worker \u7ebf\u7a0b\u4e0d\u80fd\u76f4\u63a5\u64cd\u4f5c DOM,\u4f46\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"postMessage"}),"\u4e0e\u4e3b\u7ebf\u7a0b\u901a\u4fe1,\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u64cd\u4f5c DOM\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["Worker \u4e0d\u80fd\u8bbf\u95ee",(0,s.jsx)(n.code,{children:"window"}),"\u5bf9\u8c61,\u4f46\u53ef\u4ee5\u8bbf\u95ee",(0,s.jsx)(n.code,{children:"navigator"}),"\u5bf9\u8c61\u7684\u90e8\u5206\u5c5e\u6027,\u5982",(0,s.jsx)(n.code,{children:"onLine"}),",",(0,s.jsx)(n.code,{children:"appName"}),",",(0,s.jsx)(n.code,{children:"platform"}),",",(0,s.jsx)(n.code,{children:"userAgent"}),"\u7b49\u3002"]}),"\n",(0,s.jsx)(n.li,{children:"Worker \u53ef\u4ee5\u53d1\u8d77 AJAX \u8bf7\u6c42\u3002"}),"\n",(0,s.jsxs)(n.li,{children:["Worker \u7684\u8fd0\u884c\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b,\u4f46\u662f\u4e5f\u4e0d\u662f\u5b8c\u5168\u72ec\u7acb\u7684,\u5b83\u4eec\u4e4b\u95f4\u901a\u8fc7",(0,s.jsx)(n.code,{children:"postMessage"}),"\u8fdb\u884c\u901a\u4fe1\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684 Web Worker \u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<body>\n  <script>\n    if (window.Worker) {\n      var myWorker = new Worker('worker.js');\n      var message = {\n        addThis: { num1: 1, num2: 1 },\n      };\n      myWorker.postMessage(message);\n      myWorker.onmessage = function (e) {\n        console.log(e.data); // {result: 2}\n      };\n    }\n  <\/script>\n</body>\n"})}),"\n",(0,s.jsx)(n.p,{children:"worker.js:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"onmessage = function (e) {\n  if (e.data.addThis !== undefined) {\n    var result = e.data.addThis.num1 + e.data.addThis.num2;\n    postMessage({ result });\n  }\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u591a\u4e2a-worker",children:"\u591a\u4e2a Worker"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e00\u4e2a Worker \u53ef\u4ee5\u542f\u52a8\u591a\u4e2a Worker,\u901a\u8fc7",(0,s.jsx)(n.code,{children:"importScripts()"}),"\u65b9\u6cd5\u52a0\u8f7d\u5176\u4ed6 Worker \u811a\u672c:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"importScripts('worker1.js', 'worker2.js');\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528",(0,s.jsx)(n.code,{children:"terminate()"}),"\u65b9\u6cd5\u7ec8\u6b62\u4e00\u4e2a Worker \u7684\u6267\u884c:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u7ec8\u6b62\u5f53\u524d worker\nself.close();\n\n// \u7ec8\u6b62\u5176\u4ed6 worker\nworker.terminate();\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d,\u6211\u4eec\u53ef\u4ee5\u5229\u7528 Web Worker \u5b9e\u73b0\u4e00\u4e9b\u8017\u65f6\u7684\u8ba1\u7b97\u6216\u8005\u6570\u636e\u5904\u7406,\u4ece\u800c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b,\u63d0\u9ad8\u9875\u9762\u6027\u80fd\u3002\u4f46\u4e5f\u8981\u6ce8\u610f Worker \u7684\u517c\u5bb9\u6027\u95ee\u9898,\u76ee\u524d\u4e3b\u6d41\u6d4f\u89c8\u5668\u90fd\u5df2\u7ecf\u652f\u6301 Web Worker,\u4f46\u5728\u4f7f\u7528\u65f6\u8fd8\u662f\u8981\u505a\u597d\u964d\u7ea7\u5904\u7406\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>d});var t=r(96540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);