"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["13445"],{8952:function(e,n,o){o.r(n),o.d(n,{default:()=>a,frontMatter:()=>d,metadata:()=>r,assets:()=>c,toc:()=>l,contentTitle:()=>i});var r=JSON.parse('{"id":"Backend/Go/\u63A5\u53E3/Node-gRPC\u901A\u4FE1","title":"gRPC \u5728 Node.js \u5BA2\u6237\u7AEF\u548C Go \u670D\u52A1\u7AEF\u901A\u4FE1","description":"\u9879\u76EE\u6E90\u7801\u94FE\u63A5","source":"@site/docs/Backend/Go/\u63A5\u53E3/3.Node-gRPC\u901A\u4FE1.md","sourceDirName":"Backend/Go/\u63A5\u53E3","slug":"/Backend/Go/\u63A5\u53E3/Node-gRPC\u901A\u4FE1","permalink":"/docs-hub/Backend/Go/\u63A5\u53E3/Node-gRPC\u901A\u4FE1","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/Go/\u63A5\u53E3/3.Node-gRPC\u901A\u4FE1.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1739167030000,"sidebarPosition":3,"frontMatter":{},"sidebar":"goSidebar","previous":{"title":"Go \u9E2D\u5B50\u7C7B\u578B\u548C\u7C7B\u578B\u7EA6\u675F","permalink":"/docs-hub/Backend/Go/\u63A5\u53E3/\u9E2D\u5B50\u7C7B\u578B"},"next":{"title":"\u96C6\u5408","permalink":"/docs-hub/category/\u96C6\u5408"}}'),s=o("85893"),t=o("50065");let d={},i="gRPC \u5728 Node.js \u5BA2\u6237\u7AEF\u548C Go \u670D\u52A1\u7AEF\u901A\u4FE1",c={},l=[{value:"\u5B9A\u4E49 Proto \u6587\u4EF6",id:"\u5B9A\u4E49-proto-\u6587\u4EF6",level:2},{value:"Go \u670D\u52A1\u7AEF\u5B9E\u73B0",id:"go-\u670D\u52A1\u7AEF\u5B9E\u73B0",level:2},{value:"Node.js \u5BA2\u6237\u7AEF\u5B9E\u73B0",id:"nodejs-\u5BA2\u6237\u7AEF\u5B9E\u73B0",level:2},{value:"gRPC \u5BA2\u6237\u7AEF\u914D\u7F6E",id:"grpc-\u5BA2\u6237\u7AEF\u914D\u7F6E",level:3},{value:"Express \u670D\u52A1",id:"express-\u670D\u52A1",level:3},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:2}];function p(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"grpc-\u5728-nodejs-\u5BA2\u6237\u7AEF\u548C-go-\u670D\u52A1\u7AEF\u901A\u4FE1",children:"gRPC \u5728 Node.js \u5BA2\u6237\u7AEF\u548C Go \u670D\u52A1\u7AEF\u901A\u4FE1"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/sumingcheng/go-Learning/tree/main/gRPC/basic1",children:"\u9879\u76EE\u6E90\u7801\u94FE\u63A5"})}),"\n",(0,s.jsx)(n.h2,{id:"\u5B9A\u4E49-proto-\u6587\u4EF6",children:"\u5B9A\u4E49 Proto \u6587\u4EF6"}),"\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\uFF0C\u9700\u8981\u5B9A\u4E49\u4E00\u4E2A ",(0,s.jsx)(n.code,{children:".proto"})," \u6587\u4EF6\u6765\u63CF\u8FF0\u670D\u52A1\u548C\u6D88\u606F\u683C\u5F0F\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-proto",children:'syntax = "proto3";\n\npackage proto;\n\n// \u5B9A\u4E49 TodoList \u670D\u52A1\nservice TodoList {\n  rpc AddTodo (AddingTodoRequest) returns (TodoResponse);\n  rpc ToggleTodo (TogglingTodoRequest) returns (TodoResponse);\n  rpc RemoveTodo (RemovingTodoRequest) returns (TodoResponse);\n}\n\n// \u8BF7\u6C42\u548C\u54CD\u5E94\u6D88\u606F\nmessage AddingTodoRequest {\n  string content = 1;\n}\n\nmessage TogglingTodoRequest {\n  int64 id = 1;\n}\n\nmessage RemovingTodoRequest {\n  int64 id = 1;\n}\n\nmessage TodoResponse {\n  int64 id = 1;\n  string content = 2;\n  bool completed = 3;\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"go-\u670D\u52A1\u7AEF\u5B9E\u73B0",children:"Go \u670D\u52A1\u7AEF\u5B9E\u73B0"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u670D\u52A1\u7AEF\uFF0C\u6211\u4F7F\u7528 Go \u8BED\u8A00\u5B9E\u73B0\u4E86\u5B9A\u4E49\u7684 gRPC \u670D\u52A1\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "fmt"\n    "goLearning/gRPC/basic1/proto"\n    "google.golang.org/grpc"\n    "net"\n    "time"\n)\n\ntype Todo struct {\n    ID        int64\n    Content   string\n    Completed bool\n}\n\ntype TodoListServer struct {\n    proto.UnimplementedTodoListServer\n    todos []Todo\n}\n\nfunc (s *TodoListServer) AddTodo(ctx context.Context, req *proto.AddingTodoRequest) (*proto.TodoResponse, error) {\n    todo := Todo{\n        ID:        time.Now().Unix(),\n        Content:   req.Content,\n        Completed: false,\n    }\n    s.todos = append(s.todos, todo)\n\n    return &proto.TodoResponse{\n        Id:        todo.ID,\n        Content:   todo.Content,\n        Completed: todo.Completed,\n    }, nil\n}\n\nfunc (s *TodoListServer) ToggleTodo(ctx context.Context, req *proto.TogglingTodoRequest) (*proto.TodoResponse, error) {\n    var updatedTodo *Todo\n    for i := range s.todos {\n        if s.todos[i].ID == req.Id {\n            s.todos[i].Completed = !s.todos[i].Completed\n            updatedTodo = &s.todos[i]\n            break\n        }\n    }\n    if updatedTodo == nil {\n        return nil, fmt.Errorf("Todo not found")\n    }\n    return &proto.TodoResponse{\n        Id:        updatedTodo.ID,\n        Content:   updatedTodo.Content,\n        Completed: updatedTodo.Completed,\n    }, nil\n}\n\nfunc (s *TodoListServer) RemoveTodo(ctx context.Context, req *proto.RemovingTodoRequest) (*proto.TodoResponse, error) {\n    var removedTodo Todo\n    for i, todo := range s.todos {\n        if todo.ID == req.Id {\n            removedTodo = todo\n            s.todos = append(s.todos[:i], s.todos[i+1:]...)\n            break\n        }\n    }\n    return &proto.TodoResponse{\n        Id:        removedTodo.ID,\n        Content:   removedTodo.Content,\n        Completed: removedTodo.Completed,\n    }, nil\n}\n\nfunc main() {\n    server := grpc.NewServer()\n    proto.RegisterTodoListServer(server, &TodoListServer{\n        todos: make([]Todo, 0),\n    })\n    listener, err := net.Listen("tcp", ":8080")\n    if err != nil {\n        panic(err.Error())\n    }\n    if err := server.Serve(listener); err != nil {\n        panic(err.Error())\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u6211\u5B9E\u73B0\u4E86 ",(0,s.jsx)(n.code,{children:"AddTodo"}),"\u3001",(0,s.jsx)(n.code,{children:"ToggleTodo"})," \u548C ",(0,s.jsx)(n.code,{children:"RemoveTodo"})," \u65B9\u6CD5\uFF0C\u7528\u4E8E\u6DFB\u52A0\u3001\u5207\u6362\u72B6\u6001\u548C\u5220\u9664\u5F85\u529E\u4E8B\u9879\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"nodejs-\u5BA2\u6237\u7AEF\u5B9E\u73B0",children:"Node.js \u5BA2\u6237\u7AEF\u5B9E\u73B0"}),"\n",(0,s.jsx)(n.h3,{id:"grpc-\u5BA2\u6237\u7AEF\u914D\u7F6E",children:"gRPC \u5BA2\u6237\u7AEF\u914D\u7F6E"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// grpcClient.js\n\nconst grpc = require("@grpc/grpc-js");\nconst protoLoader = require("@grpc/proto-loader");\nconst PROTO_PATH = "../proto/todolist.proto";\n\n// \u52A0\u8F7D .proto \u6587\u4EF6\nconst packageDefinition = protoLoader.loadSync(PROTO_PATH, {\n  keepCase: true,\n  longs: String,\n  enums: String,\n  defaults: true,\n  oneofs: true,\n});\n\n// \u521B\u5EFA gRPC \u5BA2\u6237\u7AEF\nconst protoDescriptor = grpc.loadPackageDefinition(packageDefinition).proto;\nconst client = new protoDescriptor.TodoList(\n  "localhost:8080",\n  grpc.credentials.createInsecure()\n);\n\nmodule.exports = client;\n'})}),"\n",(0,s.jsx)(n.h3,{id:"express-\u670D\u52A1",children:"Express \u670D\u52A1"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// app.js\n\nconst express = require("express");\nconst bodyParser = require("body-parser");\nconst grpcClient = require("./grpcClient");\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\n\n// \u8DE8\u57DF\u8BBE\u7F6E\napp.all("*", (req, res, next) => {\n  res.header("Access-Control-Allow-Origin", "*");\n  res.header("Access-Control-Allow-Headers", "X-Requested-With, Content-Type");\n  res.header("Access-Control-Allow-Methods", "PUT, POST, GET, DELETE, OPTIONS");\n  next();\n});\n\n// \u6DFB\u52A0\u5F85\u529E\u4E8B\u9879\napp.post("/add_todo", (req, res) => {\n  const { content } = req.body;\n\n  grpcClient.AddTodo({ content }, (err, response) => {\n    if (err) {\n      res.status(500).json({ error: err.details });\n    } else {\n      res.json(response);\n    }\n  });\n});\n\n// \u5207\u6362\u5F85\u529E\u4E8B\u9879\u72B6\u6001\napp.post("/toggle_todo", (req, res) => {\n  const { id } = req.body;\n\n  grpcClient.ToggleTodo({ id }, (err, response) => {\n    if (err) {\n      res.status(500).json({ error: err.details });\n    } else {\n      res.json(response);\n    }\n  });\n});\n\n// \u5220\u9664\u5F85\u529E\u4E8B\u9879\napp.post("/remove_todo", (req, res) => {\n  const { id } = req.body;\n\n  grpcClient.RemoveTodo({ id }, (err, response) => {\n    if (err) {\n      res.status(500).json({ error: err.details });\n    } else {\n      res.json(response);\n    }\n  });\n});\n\napp.listen(3000, () => {\n  console.log("Server is running on http://localhost:3000");\n});\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u5BA2\u6237\u7AEF\uFF0C\u6211\u4F7F\u7528 Express \u6846\u67B6\u521B\u5EFA\u4E86\u4E00\u4E2A\u7B80\u5355\u7684 HTTP \u670D\u52A1\u5668\uFF0C\u901A\u8FC7\u8C03\u7528 gRPC \u5BA2\u6237\u7AEF\u7684\u65B9\u6CD5\u4E0E Go \u670D\u52A1\u7AEF\u901A\u4FE1\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u53D8\u91CF\u547D\u540D"}),"\uFF1A\u4E3A\u4E86\u63D0\u9AD8\u4EE3\u7801\u53EF\u8BFB\u6027\uFF0C\u6211\u5C06\u53D8\u91CF\u540D\u4F18\u5316\u4E3A\u66F4\u5177\u63CF\u8FF0\u6027\u7684\u540D\u79F0\uFF0C\u4F8B\u5982\u5C06 ",(0,s.jsx)(n.code,{children:"gClient"})," \u6539\u4E3A ",(0,s.jsx)(n.code,{children:"grpcClient"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u9519\u8BEF\u5904\u7406"}),"\uFF1A\u5728 Node.js \u5BA2\u6237\u7AEF\u4E2D\uFF0C\u6DFB\u52A0\u4E86\u9519\u8BEF\u5904\u7406\uFF0C\u786E\u4FDD\u5728\u53D1\u751F\u9519\u8BEF\u65F6\u8FD4\u56DE\u8BE6\u7EC6\u7684\u9519\u8BEF\u4FE1\u606F\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8DE8\u57DF\u914D\u7F6E"}),"\uFF1A\u4FEE\u6B63\u4E86\u8DE8\u57DF\u5934\u90E8\u7684\u8BBE\u7F6E\uFF0C\u6DFB\u52A0\u4E86\u7F3A\u5C11\u7684 ",(0,s.jsx)(n.code,{children:"Content-Type"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Proto \u6587\u4EF6"}),"\uFF1A\u786E\u4FDD ",(0,s.jsx)(n.code,{children:".proto"})," \u6587\u4EF6\u4E2D\u7684\u670D\u52A1\u548C\u6D88\u606F\u5B9A\u4E49\u51C6\u786E\uFF0C\u4EE5\u4FBF\u6B63\u786E\u751F\u6210\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u4EE3\u7801\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u7248\u672C\u517C\u5BB9\u6027"}),"\uFF1A\u5728\u4FEE\u6539\u5185\u5BB9\u65F6\uFF0C\u4FDD\u6301\u4E86\u4F7F\u7528\u7684\u5305\u7684\u7248\u672C\u4E0D\u53D8\uFF0C\u9488\u5BF9\u73B0\u6709\u7248\u672C\u8FDB\u884C\u4E86\u4F18\u5316\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u4EE3\u7801\u5757\u6807\u6CE8"}),"\uFF1A\u6240\u6709\u4EE3\u7801\u5757\u5747\u6807\u660E\u4E86\u8BED\u8A00\u7C7B\u578B\uFF0C\u4FBF\u4E8E\u9605\u8BFB\u548C\u8BED\u6CD5\u9AD8\u4EAE\u3002"]}),"\n"]}),"\n"]})]})}function a(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},50065:function(e,n,o){o.d(n,{Z:function(){return i},a:function(){return d}});var r=o(67294);let s={},t=r.createContext(s);function d(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);