"use strict";(self.webpackChunknote_book=self.webpackChunknote_book||[]).push([["74456"],{56576:function(e,n,i){i.r(n),i.d(n,{default:()=>p,frontMatter:()=>t,metadata:()=>l,assets:()=>s,toc:()=>c,contentTitle:()=>r});var l=JSON.parse('{"id":"Backend/Nginx/Nginx\u9AD8\u53EF\u7528\u90E8\u7F72","title":"Nginx \u9AD8\u53EF\u7528\u90E8\u7F72","description":"\u9AD8\u53EF\u7528\u6027\u6982\u8FF0","source":"@site/docs/Backend/Nginx/40.Nginx\u9AD8\u53EF\u7528\u90E8\u7F72.md","sourceDirName":"Backend/Nginx","slug":"/Backend/Nginx/Nginx\u9AD8\u53EF\u7528\u90E8\u7F72","permalink":"/docs-hub/Backend/Nginx/Nginx\u9AD8\u53EF\u7528\u90E8\u7F72","draft":false,"unlisted":false,"editUrl":"https://github.com/sumingcheng/docs-hub/edit/main/docs/Backend/Nginx/40.Nginx\u9AD8\u53EF\u7528\u90E8\u7F72.md","tags":[],"version":"current","lastUpdatedBy":"sumingcheng","lastUpdatedAt":1733834339000,"sidebarPosition":40,"frontMatter":{},"sidebar":"nginxSidebar","previous":{"title":"Nginx \u5B89\u5168\u4E0E\u6027\u80FD\u4F18\u5316","permalink":"/docs-hub/Backend/Nginx/Nginx\u5B89\u5168\u4E0E\u6027\u80FD\u4F18\u5316"},"next":{"title":"Nginx \u914D\u7F6E\u4E0E\u4F18\u5316","permalink":"/docs-hub/Backend/Nginx/\u914D\u7F6E\u4E0E\u4F18\u5316"}}'),a=i("85893"),d=i("50065");let t={},r="Nginx \u9AD8\u53EF\u7528\u90E8\u7F72",s={},c=[{value:"\u9AD8\u53EF\u7528\u6027\u6982\u8FF0",id:"\u9AD8\u53EF\u7528\u6027\u6982\u8FF0",level:2},{value:"\u6784\u5EFA\u9AD8\u53EF\u7528 Nginx \u67B6\u6784",id:"\u6784\u5EFA\u9AD8\u53EF\u7528-nginx-\u67B6\u6784",level:2},{value:"\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861",id:"\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861",level:3},{value:"\u914D\u7F6E\u4E3B\u4ECE\u670D\u52A1\u5668",id:"\u914D\u7F6E\u4E3B\u4ECE\u670D\u52A1\u5668",level:3},{value:"\u4F7F\u7528 Keepalived \u5B9E\u73B0 Nginx \u9AD8\u53EF\u7528",id:"\u4F7F\u7528-keepalived-\u5B9E\u73B0-nginx-\u9AD8\u53EF\u7528",level:2},{value:"\u5B89\u88C5 Keepalived",id:"\u5B89\u88C5-keepalived",level:3},{value:"\u914D\u7F6E Keepalived",id:"\u914D\u7F6E-keepalived",level:3},{value:"\u542F\u52A8 Keepalived",id:"\u542F\u52A8-keepalived",level:3},{value:"\u4F7F\u7528 DNS \u8F6E\u8BE2\u63D0\u9AD8\u53EF\u7528\u6027",id:"\u4F7F\u7528-dns-\u8F6E\u8BE2\u63D0\u9AD8\u53EF\u7528\u6027",level:2},{value:"\u4F7F\u7528\u4E91\u670D\u52A1\u7684\u8D1F\u8F7D\u5747\u8861\u5668",id:"\u4F7F\u7528\u4E91\u670D\u52A1\u7684\u8D1F\u8F7D\u5747\u8861\u5668",level:2},{value:"\u76D1\u63A7\u548C\u7EF4\u62A4",id:"\u76D1\u63A7\u548C\u7EF4\u62A4",level:2}];function o(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,d.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"nginx-\u9AD8\u53EF\u7528\u90E8\u7F72",children:"Nginx \u9AD8\u53EF\u7528\u90E8\u7F72"})}),"\n",(0,a.jsx)(n.h2,{id:"\u9AD8\u53EF\u7528\u6027\u6982\u8FF0",children:"\u9AD8\u53EF\u7528\u6027\u6982\u8FF0"}),"\n",(0,a.jsx)(n.p,{children:"\u9AD8\u53EF\u7528\u6027\u65E8\u5728\u786E\u4FDD\u7CFB\u7EDF\u5728\u51FA\u73B0\u6545\u969C\u65F6\u4ECD\u80FD\u6301\u7EED\u63D0\u4F9B\u670D\u52A1\u3002\u5BF9\u4E8E Nginx\uFF0C\u6784\u5EFA\u9AD8\u53EF\u7528\u67B6\u6784\u53EF\u4EE5\u907F\u514D\u5355\u70B9\u6545\u969C\uFF0C\u63D0\u9AD8\u7F51\u7AD9\u6216\u5E94\u7528\u7684\u53EF\u9760\u6027\u548C\u7A33\u5B9A\u6027\u3002\u7B14\u8005\u8BA4\u4E3A\uFF0C\u5B9E\u73B0 Nginx \u9AD8\u53EF\u7528\u6027\u7684\u6700\u7EC8\u76EE\u6807\u662F\u786E\u4FDD\u670D\u52A1\u7684\u6301\u7EED\u53EF\u7528\u6027\u548C\u5FEB\u901F\u6062\u590D\u80FD\u529B\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u6784\u5EFA\u9AD8\u53EF\u7528-nginx-\u67B6\u6784",children:"\u6784\u5EFA\u9AD8\u53EF\u7528 Nginx \u67B6\u6784"}),"\n",(0,a.jsx)(n.h3,{id:"\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861",children:"\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861"}),"\n",(0,a.jsx)(n.p,{children:"\u8D1F\u8F7D\u5747\u8861\u5C06\u6D41\u91CF\u5206\u914D\u5230\u591A\u53F0 Nginx \u670D\u52A1\u5668\uFF0C\u9632\u6B62\u4EFB\u4F55\u5355\u4E00\u670D\u52A1\u5668\u8FC7\u8F7D\u3002\u53EF\u4EE5\u4F7F\u7528\u786C\u4EF6\u8D1F\u8F7D\u5747\u8861\u5668\u6216\u8F6F\u4EF6\u89E3\u51B3\u65B9\u6848\u5982 Nginx \u81EA\u8EAB\u7684\u8D1F\u8F7D\u5747\u8861\u529F\u80FD\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-nginx",children:"http {\n    upstream backend {\n        server nginx1.example.com;\n        server nginx2.example.com;\n    }\n\n    server {\n        listen 80;\n        server_name example.com;\n\n        location / {\n            proxy_pass http://backend;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u914D\u7F6E\u4E3B\u4ECE\u670D\u52A1\u5668",children:"\u914D\u7F6E\u4E3B\u4ECE\u670D\u52A1\u5668"}),"\n",(0,a.jsx)(n.p,{children:"\u914D\u7F6E\u4E3B\u4ECE\u670D\u52A1\u5668\u53EF\u4EE5\u5728\u4E3B\u670D\u52A1\u5668\u51FA\u73B0\u6545\u969C\u65F6\uFF0C\u7531\u4ECE\u670D\u52A1\u5668\u63A5\u7BA1\u670D\u52A1\u3002\u901A\u5E38\u4F7F\u7528 Keepalived \u6216 Heartbeat \u6765\u7BA1\u7406\u4E3B\u4ECE\u5207\u6362\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u4F7F\u7528-keepalived-\u5B9E\u73B0-nginx-\u9AD8\u53EF\u7528",children:"\u4F7F\u7528 Keepalived \u5B9E\u73B0 Nginx \u9AD8\u53EF\u7528"}),"\n",(0,a.jsx)(n.h3,{id:"\u5B89\u88C5-keepalived",children:"\u5B89\u88C5 Keepalived"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u6240\u6709 Nginx \u670D\u52A1\u5668\u4E0A\u5B89\u88C5 Keepalived\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install keepalived\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u914D\u7F6E-keepalived",children:"\u914D\u7F6E Keepalived"}),"\n",(0,a.jsxs)(n.p,{children:["\u7F16\u8F91",(0,a.jsx)(n.code,{children:"/etc/keepalived/keepalived.conf"}),"\u6587\u4EF6\uFF0C\u914D\u7F6E\u865A\u62DF IP \u548C\u5065\u5EB7\u68C0\u67E5\uFF1A"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-conf",children:"vrrp_instance VI_1 {\n    state MASTER\n    interface eth0\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n    nopreempt          # \u4E0D\u62A2\u5360\n    preempt_delay 300  # \u5EF6\u8FDF\u62A2\u5360\n    authentication {\n        auth_type PASS\n        auth_pass secret\n    }\n    virtual_ipaddress {\n        192.168.1.100\n    }\n}\n\nvirtual_server 192.168.1.100 80 {\n    delay_loop 6\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout 50\n    protocol TCP\n\n    real_server 192.168.1.101 80 {\n        TCP_CHECK {\n            connect_timeout 10\n            nb_get_retry 3\n            delay_before_retry 3\n        }\n    }\n\n    real_server 192.168.1.102 80 {\n        TCP_CHECK {\n            connect_timeout 10\n            nb_get_retry 3\n            delay_before_retry 3\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u542F\u52A8-keepalived",children:"\u542F\u52A8 Keepalived"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start keepalived\nsudo systemctl enable keepalived\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u4F7F\u7528-dns-\u8F6E\u8BE2\u63D0\u9AD8\u53EF\u7528\u6027",children:"\u4F7F\u7528 DNS \u8F6E\u8BE2\u63D0\u9AD8\u53EF\u7528\u6027"}),"\n",(0,a.jsx)(n.p,{children:"DNS \u8F6E\u8BE2\u901A\u8FC7\u914D\u7F6E\u591A\u4E2A A \u8BB0\u5F55\uFF0C\u5C06\u8BF7\u6C42\u5206\u914D\u5230\u4E0D\u540C\u7684 Nginx \u670D\u52A1\u5668\u3002\u867D\u7136\u914D\u7F6E\u7B80\u5355\uFF0C\u4F46\u7F3A\u4E4F\u5065\u5EB7\u68C0\u67E5\u548C\u6545\u969C\u8F6C\u79FB\u673A\u5236\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u4F7F\u7528\u4E91\u670D\u52A1\u7684\u8D1F\u8F7D\u5747\u8861\u5668",children:"\u4F7F\u7528\u4E91\u670D\u52A1\u7684\u8D1F\u8F7D\u5747\u8861\u5668"}),"\n",(0,a.jsx)(n.p,{children:"\u5229\u7528\u4E91\u63D0\u4F9B\u5546\u7684\u8D1F\u8F7D\u5747\u8861\u5668\uFF0C\u5982 AWS ELB \u6216 Azure Load Balancer\uFF0C\u53EF\u4EE5\u7B80\u5316\u9AD8\u53EF\u7528\u6027\u90E8\u7F72\uFF0C\u5E76\u96C6\u6210\u81EA\u52A8\u6269\u5C55\u548C\u5065\u5EB7\u76D1\u63A7\u529F\u80FD\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u76D1\u63A7\u548C\u7EF4\u62A4",children:"\u76D1\u63A7\u548C\u7EF4\u62A4"}),"\n",(0,a.jsx)(n.p,{children:"\u5B9A\u671F\u76D1\u63A7 Nginx \u670D\u52A1\u5668\u7684\u6027\u80FD\u548C\u5065\u5EB7\u72B6\u6001\uFF0C\u4F7F\u7528\u5DE5\u5177\u5982 Prometheus \u548C Grafana \u8FDB\u884C\u5B9E\u65F6\u76D1\u63A7\u3002\u53CA\u65F6\u66F4\u65B0\u548C\u7EF4\u62A4\u914D\u7F6E\uFF0C\u786E\u4FDD\u9AD8\u53EF\u7528\u67B6\u6784\u7684\u7A33\u5B9A\u8FD0\u884C\u3002"})]})}function p(e={}){let{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},50065:function(e,n,i){i.d(n,{Z:function(){return r},a:function(){return t}});var l=i(67294);let a={},d=l.createContext(a);function t(e){let n=l.useContext(d);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),l.createElement(d.Provider,{value:n},e.children)}}}]);