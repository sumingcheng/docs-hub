# Gin æ¡†æ¶ä¸­çš„ä¸­é—´ä»¶å’Œè·¯ç”±åˆ†ç»„

## ä¸­é—´ä»¶çš„ä½¿ç”¨

åœ¨ä½¿ç”¨ Gin æ¡†æ¶è¿›è¡Œ Web å¼€å‘æ—¶ï¼Œä¸­é—´ä»¶æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚ä¸­é—´ä»¶å¯ä»¥åœ¨è¯·æ±‚å¤„ç†çš„å‰åæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€èº«ä»½éªŒè¯ç­‰ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Gin ä¸­ä½¿ç”¨ä¸­é—´ä»¶çš„ç¤ºä¾‹ï¼š

```go
package main

import (
    "fmt"
    "github.com/gin-gonic/gin"
    "net/http"
)

// GlobalMiddleware å…¨å±€ä¸­é—´ä»¶
func GlobalMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        fmt.Println("å…¨å±€ä¸­é—´ä»¶ï¼šå¤„ç†æ¯ä¸ªè¯·æ±‚")
        c.Next()
    }
}

// CORSMiddleware è·¨åŸŸä¸­é—´ä»¶
func CORSMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
        c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")
        c.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Content-Length, Accept-Encoding, Authorization, Origin, Cache-Control, X-Requested-With")
        c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, OPTIONS, GET, PUT, DELETE")

        if c.Request.Method == "OPTIONS" {
            c.AbortWithStatus(http.StatusNoContent)
            return
        }

        c.Next()
    }
}

// LocalMiddleware å±€éƒ¨ä¸­é—´ä»¶
func LocalMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        fmt.Println("å±€éƒ¨ä¸­é—´ä»¶ï¼šä»…åœ¨ç‰¹å®šè·¯ç”±è§¦å‘")
        c.Next()
    }
}

func main() {
    router := gin.Default()

    // åº”ç”¨å…¨å±€ä¸­é—´ä»¶
    router.Use(GlobalMiddleware())

    // åº”ç”¨è·¨åŸŸä¸­é—´ä»¶
    router.Use(CORSMiddleware())

    // æ— ä¸­é—´ä»¶çš„è·¯ç”±
    router.GET("/", func(c *gin.Context) {
        c.JSON(http.StatusOK, gin.H{"message": "æ— ä¸­é—´ä»¶"})
    })

    // åº”ç”¨å±€éƒ¨ä¸­é—´ä»¶çš„è·¯ç”±
    router.GET("/local", LocalMiddleware(), func(c *gin.Context) {
        c.JSON(http.StatusOK, gin.H{"message": "å±€éƒ¨ä¸­é—´ä»¶"})
    })

    // å¯åŠ¨æœåŠ¡å™¨
    router.Run(":8080")
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼š

- `GlobalMiddleware` æ˜¯å…¨å±€ä¸­é—´ä»¶ï¼Œä¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†å‰æ‰§è¡Œã€‚
- `CORSMiddleware` å¤„ç†è·¨åŸŸè¯·æ±‚ï¼Œè®¾ç½®äº†ç›¸å…³çš„å“åº”å¤´ã€‚
- `LocalMiddleware` æ˜¯å±€éƒ¨ä¸­é—´ä»¶ï¼Œä»…åœ¨ç‰¹å®šè·¯ç”±ä¸­ä½¿ç”¨ã€‚

é€šè¿‡ `router.Use()` æ–¹æ³•ï¼Œå¯ä»¥å°†ä¸­é—´ä»¶åº”ç”¨äºå…¨å±€ã€‚ğŸ˜Š

## è·¯ç”±åˆ†ç»„

Gin æ”¯æŒå¯¹è·¯ç”±è¿›è¡Œåˆ†ç»„ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè·¯ç”±åˆ†ç»„çš„ç¤ºä¾‹ï¼š

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

func main() {
    router := gin.Default()

    // åˆ›å»ºç”¨æˆ·ç›¸å…³çš„è·¯ç”±åˆ†ç»„
    userGroup := router.Group("/user")
    {
        userGroup.POST("/", addUser)         // æ·»åŠ ç”¨æˆ·
        userGroup.DELETE("/:id", deleteUser) // åˆ é™¤ç”¨æˆ·
        userGroup.PUT("/:id", updateUser)    // æ›´æ–°ç”¨æˆ·
    }

    // å¯åŠ¨æœåŠ¡å™¨
    router.Run(":8080")
}

// æ·»åŠ ç”¨æˆ·çš„å¤„ç†å‡½æ•°
func addUser(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{"message": "ç”¨æˆ·æ·»åŠ æˆåŠŸ"})
}

// åˆ é™¤ç”¨æˆ·çš„å¤„ç†å‡½æ•°
func deleteUser(c *gin.Context) {
    userID := c.Param("id")
    c.JSON(http.StatusOK, gin.H{"message": "æˆåŠŸåˆ é™¤ç”¨æˆ·", "userID": userID})
}

// æ›´æ–°ç”¨æˆ·çš„å¤„ç†å‡½æ•°
func updateUser(c *gin.Context) {
    userID := c.Param("id")
    c.JSON(http.StatusOK, gin.H{"message": "ç”¨æˆ·æ›´æ–°æˆåŠŸ", "userID": userID})
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªä»¥ `/user` ä¸ºå‰ç¼€çš„è·¯ç”±ç»„ `userGroup`ï¼Œå°†ç”¨æˆ·ç›¸å…³çš„æ“ä½œéƒ½æ”¾åœ¨è¿™ä¸ªç»„å†…ï¼Œä¾¿äºç®¡ç†ã€‚

## æ³¨æ„äº‹é¡¹

- ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºä¸æ³¨å†Œé¡ºåºä¸€è‡´ï¼Œéœ€æ³¨æ„å…¨å±€ä¸­é—´ä»¶å’Œå±€éƒ¨ä¸­é—´ä»¶çš„å…ˆåå…³ç³»ã€‚
- åœ¨å¤„ç†è·¨åŸŸè¯·æ±‚æ—¶ï¼Œéœ€æ­£ç¡®è®¾ç½®å“åº”å¤´ï¼Œç‰¹åˆ«æ˜¯ `Access-Control-Allow-Origin` å’Œ `Access-Control-Allow-Methods`ã€‚

## æœ€ä½³å®è·µ

- åˆç†ä½¿ç”¨ä¸­é—´ä»¶ï¼Œå°†é€šç”¨åŠŸèƒ½æŠ½è±¡å‡ºæ¥ï¼Œæå‡ä»£ç å¤ç”¨æ€§ã€‚
- å¯¹åŠŸèƒ½ç›¸ä¼¼çš„è·¯ç”±è¿›è¡Œåˆ†ç»„ï¼Œæ¸…æ™°æ˜äº†ã€‚
- å˜é‡ååº”æ˜“äºç†è§£ï¼Œæå‡ä»£ç å¯è¯»æ€§ã€‚
