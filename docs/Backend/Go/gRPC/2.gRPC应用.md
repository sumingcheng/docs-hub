# åœ¨ Windows ä¸Šä½¿ç”¨ Go è¯­è¨€å¼€å‘ gRPC åº”ç”¨

## å®‰è£…å¿…è¦çš„å·¥å…·

### åˆå§‹åŒ– Go æ¨¡å—

```go
go mod init proto
go get -u google.golang.org/grpc
```

### ä¸‹è½½ Protocol Buffers

å‰å¾€ [https://github.com/protocolbuffers/protobuf/releases/tag/v25.2](https://github.com/protocolbuffers/protobuf/releases/tag/v25.2) ä¸‹è½½é€‚ç”¨äºå½“å‰ç³»ç»Ÿçš„ Protocol Buffers äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

### é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ Path

å°† Protocol Buffers çš„ `bin` ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ `Path` ä¸­ã€‚

![](../images/6c1d4df00258b69da6f4743bf0603623.png)

### éªŒè¯å®‰è£…

```go
protoc --version
```

åº”è¾“å‡º `libprotoc 25.2`ã€‚

![](../images/4dbcf9c369e3d20b05291df6e6752669.png)

### å®‰è£… Go çš„ Protocol Buffers æ’ä»¶

```go
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

## ç¼–å†™ .proto æ–‡ä»¶

åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º `hello.proto`ï¼š

```protobuf
syntax = "proto3";
package proto;
option go_package = "./;proto";

message HelloRequest {
  string greeting = 1;
}

message HelloResponse {
  string reply = 1;
}

service Greeter {
  rpc SayHello (HelloRequest) returns (HelloResponse);
}
```

## ç”Ÿæˆ Go ä»£ç 

åœ¨ `proto` ç›®å½•ä¸‹æ‰§è¡Œï¼š

```go
protoc --go_out=. --go-grpc_out=. hello.proto
```

ç”Ÿæˆ `hello.pb.go` å’Œ `hello_grpc.pb.go` æ–‡ä»¶ã€‚

### ç›®å½•ç»“æ„

```plaintext
go-Learning/
â”‚
â””â”€â”€â”€RPC/
    â”‚   go.mod
    â”‚
    â”œâ”€â”€â”€client/
    â”‚       main.go
    â”‚
    â”œâ”€â”€â”€server/
    â”‚       main.go
    â”‚
    â””â”€â”€â”€proto/
            hello.proto
            hello.pb.go
            hello_grpc.pb.go
```

![](../images/a6c4b857892a6f2bc6dceb2040aec6be.png)

## ç¼–å†™æœåŠ¡ç«¯ä»£ç 

åœ¨ `server/main.go` ä¸­ï¼š

```go
package main

import (
	"context"
	"log"
	"net"

	"google.golang.org/grpc"
	pb "hello/proto"
)

type server struct {
	pb.UnimplementedGreeterServer
}

func (s *server) SayHello(ctx context.Context, req *pb.HelloRequest) (*pb.HelloResponse, error) {
	reply := "Hello " + req.Greeting
	return &pb.HelloResponse{Reply: reply}, nil
}

func main() {
	listener, err := net.Listen("tcp", ":50051")
	if err != nil {
		log.Fatalf("ç›‘å¬ç«¯å£å¤±è´¥ %v", err)
	}

	grpcServer := grpc.NewServer()
	pb.RegisterGreeterServer(grpcServer, &server{})

	log.Println("æœåŠ¡ç«¯æ­£åœ¨ç›‘å¬ç«¯å£ 50051...")
	if err := grpcServer.Serve(listener); err != nil {
		log.Fatalf("å¯åŠ¨æœåŠ¡ç«¯å¤±è´¥ %v", err)
	}
}
```

## ç¼–å†™å®¢æˆ·ç«¯ä»£ç 

åœ¨ `client/main.go` ä¸­ï¼š

```go
package main

import (
	"context"
	"log"
	"time"

	"google.golang.org/grpc"
	pb "hello/proto"
)

func main() {
	conn, err := grpc.Dial("localhost:50051", grpc.WithInsecure(), grpc.WithBlock())
	if err != nil {
		log.Fatalf("è¿æ¥æœåŠ¡ç«¯å¤±è´¥ %v", err)
	}
	defer conn.Close()

	client := pb.NewGreeterClient(conn)

	ctx, cancel := context.WithTimeout(context.Background(), time.Second)
	defer cancel()

	response, err := client.SayHello(ctx, &pb.HelloRequest{Greeting: "sumingcheng"})
	if err != nil {
		log.Fatalf("è°ƒç”¨ SayHello æ–¹æ³•å¤±è´¥ %v", err)
	}

	log.Printf("æœåŠ¡ç«¯å›å¤ %s", response.GetReply())
}
```

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿ `protoc` å’Œ Go æ’ä»¶å·²æ­£ç¡®å®‰è£…ï¼Œå¹¶åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®ã€‚

- åœ¨ç”Ÿæˆ Go ä»£ç æ—¶ï¼Œç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ã€‚

- æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·å’Œåœ°å€éœ€ä¿æŒä¸€è‡´ã€‚

- åœ¨ä»£ç ä¸­æ›¿æ¢æµ‹è¯•å†…å®¹ä¸º `sumingcheng`ã€‚

- å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºèµ„æºè¿›è¡Œæ’æŸ¥ã€‚

ğŸ’¡ ä½¿ç”¨æ˜“äºç†è§£çš„å˜é‡åå’Œæ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚
