# æ­£åˆ™è¡¨è¾¾å¼

## ä¿®é¥°ç¬¦

å…¨å±€ `global` -g  
å¿½ç•¥å¤§å°å†™ `ignoreCase` -i  
å¤šè¡Œæ¨¡å¼ `multi-line` -m

![](../images/089d1e1ff93bfb13712e18347d2f1d09.png)

## ES6 æ­£åˆ™å¢å¼º

### å£°æ˜æ­£åˆ™çš„æ–¹å¼å˜åŒ–

åœ¨ ES6 ä¸­ï¼Œå£°æ˜æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼æœ‰æ‰€å˜åŒ–ï¼Œæ”¯æŒè¡¨è¾¾å¼å’Œä¿®é¥°ç¬¦åˆ†å¼€ä¼ å…¥ã€‚è¿™ä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼çš„åˆ›å»ºæ›´åŠ çµæ´»ã€‚

```javascript
// ES5 å­—é¢é‡å®šä¹‰æ­£åˆ™
var regexLiteral = /xyz/i;

// ES5 ä½¿ç”¨æ„é€ å‡½æ•°å£°æ˜æ­£åˆ™
var regexConstructor = new RegExp('xyz', 'i');

// ES5 ä¼ å…¥æ­£åˆ™å¯¹è±¡
var regexFromRegex = new RegExp(/xyz/i);

// ES6 æ”¯æŒåˆ†å¼€ä¼ å…¥è¡¨è¾¾å¼å’Œä¿®é¥°ç¬¦
var regexES6 = new RegExp(/xyz/, 'i');
```

### å­—ç¬¦ä¸²ä¸Šçš„æ­£åˆ™æ–¹æ³•è°ƒæ•´

ES6 å°†å­—ç¬¦ä¸²ä¸Šçš„æ­£åˆ™æ–¹æ³•è°ƒæ•´åˆ°äº†æ­£åˆ™è¡¨è¾¾å¼çš„åŸå‹ä¸Šï¼Œä½¿å¾—æ–¹æ³•è°ƒç”¨æ›´åŠ ç›´è§‚å’Œç»Ÿä¸€ã€‚

```javascript
console.log(RegExp.prototype);
```

![](../images/c41b293e2caf814b3faa5dfaed45e5b1.png)

### æ–°å¢ä¿®é¥°ç¬¦ `u`ã€`y` å’Œ `s`

#### `y` ä¿®é¥°ç¬¦

`y` ä¿®é¥°ç¬¦ç”¨äºæ‰§è¡Œâ€œç²˜æ€§â€åŒ¹é…ï¼Œè¦æ±‚åŒ¹é…å¿…é¡»ä»å½“å‰ `lastIndex` ä½ç½®å¼€å§‹ã€‚è¿™åœ¨å¤„ç†è¿ç»­çš„åŒ¹é…æ—¶å°¤ä¸ºæœ‰ç”¨ã€‚

```javascript
var str = 'aaa_aa_a';
var globalRegex = /a+/g;
var stickyRegex = /a+/y;

console.log(globalRegex.exec(str)); // ["aaa"]
console.log(stickyRegex.exec(str)); // ["aaa"]
console.log(globalRegex.exec(str)); // ["aa"]
console.log(stickyRegex.exec(str)); // null
```

#### `source` å’Œ `flags`

`source` å±æ€§è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬éƒ¨åˆ†ï¼Œ`flags` å±æ€§è¿”å›ä¿®é¥°ç¬¦ã€‚

```javascript
var regex = /\wabed/giy;
console.log(regex.source); // \wabed
console.log(regex.flags); // giy
```

#### ç ç‚¹

[Unicode - æœ¯è¯­è¡¨ | MDN](https://developer.mozilla.org/zh-CN/docs/Glossary/Unicode)

### Unicode åˆ†åŒºå®šä¹‰

1. `Unicode` åˆ†åŒºå®šä¹‰åŒ…æ‹¬ `BMP` å’Œå¦å¤– 16 ä¸ªå¹³é¢ï¼Œå…± 17 ä¸ªå¹³é¢ã€‚
2. `JavaScript` å¼•æ“ä½¿ç”¨ `UTF-16` ç¼–ç ã€‚
3. ä»£ç ç‚¹ `U+0000~U+FFFF` ç”¨äºæ ‡è¯†åŸºæœ¬å¤šæ–‡ç§å¹³é¢ä¸­çš„å­—ç¬¦ã€‚
4. å¯¹äºä¸åœ¨ `Unicode` ä¸­çš„ç¼–ç ï¼Œé‡‡ç”¨å››ä¸ªå­—èŠ‚çš„è¡¨ç¤ºæ–¹æ³•ã€‚
5. `U+D8000~U+FFFF` èŒƒå›´ç”¨äºä»£ç†å¯¹ï¼Œå…è®¸é€šè¿‡å››ä¸ªå­—èŠ‚æ ‡è¯†ä¸€ä¸ªå­—ç¬¦ã€‚

```javascript
// UTF-16 ç¼–ç 
console.log('\u20bb7'); // è¾“å‡º: \u20bb7

// ä½¿ç”¨ä»£ç†å¯¹è¡¨ç¤ºå››å­—èŠ‚å­—ç¬¦ï¼ŒES5 ä¸æ”¯æŒ
console.log('\uD842\uDFB7'); // è¾“å‡º: ğ ®·

// ES6 æ”¯æŒä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤ºå››å­—èŠ‚å­—ç¬¦
console.log('\u{20bb7}'); // è¾“å‡º: ğ ®·
```

### `u` ä¿®é¥°ç¬¦

`u` ä¿®é¥°ç¬¦å¢å¼ºäº†æ­£åˆ™è¡¨è¾¾å¼å¯¹ Unicode å­—ç¬¦çš„æ”¯æŒï¼Œä½¿å…¶èƒ½å¤Ÿæ­£ç¡®å¤„ç†å››å­—èŠ‚å­—ç¬¦ã€‚

#### ES6 ç¼–ç è¯†åˆ«ä¼˜åŒ–

```javascript
// ä»…åŒ¹é…é«˜ä½ä»£ç†
console.log(/^\uD83D/.test('\uD83D\uDC2A')); // true

// ä½¿ç”¨ u ä¿®é¥°ç¬¦åï¼Œä¸åŒ¹é…å››å­—èŠ‚å­—ç¬¦
console.log(/^\uD83D/u.test('\uD83D\uDC2A')); // false
```

#### ä½¿ç”¨ç‚¹åŒ¹é…

```javascript
var surrogatePair = '\uD842\uDFB7';
console.log(surrogatePair); // è¾“å‡º: ğ ®·

// ES5 ä¸­ç‚¹åŒ¹é…ä¸åˆ°å››å­—èŠ‚å­—ç¬¦
console.log(/^.$/.test(surrogatePair)); // false

// ES6 ä¸­ä½¿ç”¨ u ä¿®é¥°ç¬¦å¯ä»¥åŒ¹é…
console.log(/^.$/u.test(surrogatePair)); // true
```

### åŒºåˆ†é‡è¯å’Œç¼–ç 

```javascript
// ä½¿ç”¨é‡è¯åŒ¹é…
console.log(/a{2}/.test('aa')); // true

// ä½¿ç”¨ u ä¿®é¥°ç¬¦åŒ¹é…ç¼–ç 
console.log(/\u{20bb7}/u.test('ğ ®·')); // true
```

### `s` ä¿®é¥°ç¬¦

`s` ä¿®é¥°ç¬¦ï¼ˆ`dotAll`ï¼‰ä½¿å¾—ç‚¹å· `.` èƒ½åŒ¹é…åŒ…æ‹¬æ¢è¡Œç¬¦åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ã€‚

1. å¢åŠ äº† `s` ä¿®é¥°ç¬¦ï¼Œä½¿å¾— `.` å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬æ¢è¡Œç¬¦ã€‚
2. ä½¿ç”¨ `s` ä¿®é¥°ç¬¦æ—¶ï¼Œ`dotAll` å±æ€§è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚

```javascript
console.log(/foo.bar/.test('foo\nbar')); // false

// ä½¿ç”¨ s ä¿®é¥°ç¬¦åï¼Œç‚¹å·åŒ¹é…æ¢è¡Œç¬¦
console.log(/foo.bar/s.test('foo\nbar')); // true

console.log(/foo.bar/s.dotAll); // true
```

[RegExp.prototype.dotAll - JavaScript | MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/dotAll)

## å®æˆ˜ç¤ºä¾‹

### ä½¿ç”¨ `y` ä¿®é¥°ç¬¦è¿›è¡Œè¿ç»­åŒ¹é…

```javascript
var text = 'apple banana apple';
var regex = /apple/y;
var match;

while ((match = regex.exec(text)) !== null) {
  console.log(`Found ${match[0]} at position ${match.index}`);
  regex.lastIndex += 1; // ç§»åŠ¨ç´¢å¼•ä»¥é¿å…æ­»å¾ªç¯
}
```

### ä½¿ç”¨ `u` ä¿®é¥°ç¬¦å¤„ç† Emoji å­—ç¬¦

```javascript
var emoji = 'ğŸ˜Š';
var regex = /\u{1F60A}/u;

console.log(regex.test(emoji)); // true
```

### ä½¿ç”¨ `s` ä¿®é¥°ç¬¦åŒ¹é…å¤šè¡Œå­—ç¬¦ä¸²

```javascript
var multiLine = `Hello
World`;
var regex = /Hello.World/s;

console.log(regex.test(multiLine)); // true
```
